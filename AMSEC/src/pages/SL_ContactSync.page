<apex:page showHeader="false" controller="SL_ContactSyncController" sidebar="false">
    <apex:includeScript value="{!$Resource.SL_TimeEntryJquery}" />
    <apex:includeScript value="{!URLFOR($Resource.bootstrap, 'dist/js/sl-bootstrap.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.SL_FixedHeader)}" />
    <apex:stylesheet value="{!URLFOR($Resource.bootstrap, 'dist/css/sl-bootstrap.min.css')}" />
    <style>
        .header-fixed {
            width: 100%
        }
        .header-fixed > thead,
        .header-fixed > tbody,
        .header-fixed > thead > tr,
        .header-fixed > tbody > tr,
        .header-fixed > thead > tr > th,
        .header-fixed > tbody > tr > td {
            display: block;
        }
        .header-fixed > tbody > tr:after,
        .header-fixed > thead > tr:after {
            content: ' ';
            display: block;
            visibility: hidden;
            clear: both;
        }
        .header-fixed > tbody {
            overflow-y: auto;
            height: 400px;
        }
        .header-fixed > tbody > tr > td,
        .header-fixed > thead > tr > th {
            width: 20%;
            float: left;
        }
    </style>
    <script>
        $(document).ready(function() {
            $("#delegateSelect").val("{!currentSelectedUser}");
            (function($) {

                $('#firstfilter').keyup(function() {
                    var rex = new RegExp($(this).val(), 'i');
                    $('.firstsearchable tr').hide();
                    $('.firstsearchable tr').filter(function() {
                        return rex.test($(this).text());
                    }).show();

                })

            }(jQuery));
        });

        function delegateChanged()
        {
            $("[id*='hiddenUserId']").val($("#delegateSelect").val());
            selectUserChangedAction();
        }
    </script>
    <apex:form >
        <div id="sl">
            <div id="sl-body">
             <apex:actionFunction name="selectUserChangedAction" action="{!delegateChanged}"/>
            <!--  <apex:actionFunction name="submitSyncsAction" status="loadingspin" action="{!submitSyncs}"/>
              <apex:actionStatus id="loadingspin" onstart="loading(true)" onstop="loading(false)" /> -->
             <!--  <div id="loadingSpinner" style="display:none" class="se-pre-con"></div> -->
                <div class="row">
                    <div class="col-sm-4">
                        <div class="input-group" style="padding-top:5px;">
                            <span class="input-group-addon">Search</span>
                            <input id="firstfilter" type="text" class="form-control" />
                        </div>
                    </div>
                    <div class="col-sm-5">
                    <apex:inputHidden id="hiddenUserId" value="{!currentSelectedUser}"/>
                    </div>
                    <div class="col-sm-3">
                        <div class="input-group" style="padding-top:5px;">
                            <span class="input-group-addon">Sync Contacts For</span>
                          <select class="form-control" id="delegateSelect" onchange="delegateChanged()">
                           <apex:repeat id="delegateDropdown" value="{!lstSyncDelegates}" var="delegate">
                            <option value="{!delegate.ManagerID}">{!delegate.Name}</option>
                           </apex:repeat>
                          </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <table id="contactTable" class="table table-striped header-fixed">
                            <thead>
                                <th>
                                    <center>Sync to Outlook</center>
                                </th>
                                <th>
                                    <center>Contact</center>
                                </th>
                                <th>
                                    <center>Email</center>
                                </th>
                                <th>
                                    <center>Company</center>
                                </th>
                                <th>
                                    <center>Type</center>
                                </th>
                            </thead>
                            <tbody class="firstsearchable">
                                <apex:repeat id="outlookSyncRecords" value="{!AllSyncRecords}" var="syncRecord">
                                    <tr>
                                        <td>
                                            <center><apex:inputCheckbox value="{!syncRecord.isSynced}" /></center>
                                        </td>
                                        <td>
                                            <center><span>{!syncRecord.contactName}</span></center>
                                        </td>
                                        <td>
                                            <center><span style="word-wrap: break-word;">{!syncRecord.email}</span></center>
                                        </td>
                                        <td>
                                            <center><span>{!syncRecord.accountName}</span></center>
                                        </td>
                                        <td>
                                            <center><span>{!syncRecord.type}</span></center>
                                        </td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row" style="background-color:grey">
                    <div class ="col-sm-5">
                    </div>
                    <div class="col-sm-1">
                        <apex:commandButton id="savebutton" styleClass="btn btn-md btn-default" action="{!submitSyncs}" oncomplete="window.close();" value="Save"/>
                    </div>
                    <div class="col-sm-1">
                        <apex:commandButton id="cancelbutton" styleClass="btn btn-md btn-default" onclick="window.close()" value="Close" />
                    </div>
                     <div class ="col-sm-5">
                    </div>
                </div>
            </div>
        </div>
    </apex:form>
</apex:page>