<apex:page controller="rels.RSAjaxPathController"  
showHeader="false"
contentType="text/html"
standardStylesheets="false" 
sidebar="false"
action="{!init}"
docType="html-4.01-transitional"
applyHtmlTag="true"
> 



<link rel="stylesheet" type="text/css" href="https://www.relsci.com/Content/CRM/BaseballCardStyling.css" />
<link rel="stylesheet" type="text/css" href="https://www.relsci.com/Content/CRM/RelationshipCardStyling.css" />

<style type="text/css">
h1{
	font-family: Arial, Helvetica, sans-serif !important;
	font-size:14px;
}
td {
	font-size:12px;
}
.ui-dialog
{
	background: none !important;
	background-color: white !important;
	padding: 0px;
	border: 1px solid #999;
	display: inline-block;
    width: 800px !important;
}
.ui-dialog-titlebar
{
  display:none;
}
.rsCompanyName {
	font-size:20px;
	text-transform:uppercase;
	font-weight:bold;
	color:#445A7D;
}
.rsMobileCompanyName {
	font-size:20px;
	text-transform:uppercase;
	font-weight:bold;
	color:#445A7D;
}
 
.rsSubTitle {
	font-size:12px;
	color:#666;
	text-transform:uppercase;
}
.rsMobileSubTitle {
	font-size: 14px;
	color: #666666;
	text-transform: uppercase;
}

.rsYou {
	display:inline-block;
	min-width:30px;
	margin-left:5px;	
}
.rsYouMobile {
	display:inline-block;
}

.rsPropPerson {
	color: green;
	display:inline-block;
	min-width:110px;
	margin-left:10px;
	text-overflow:ellipsis !important;	
}
.rsPropPersonMobile {
	color: green;
	display:inline-block;
}
.rsNode {
	display:inline-block;
	min-width:110px;
	margin-left:10px;
	text-overflow:ellipsis !important;
}
.rsNodeMobile {
	display:inline-block;	
}

.rsNodeStrength0 {
	font-size: 12px;
	font-family: 'ProximaNova-Bold', Arial, sans-serif;
	font-weight: bold;
	color: #f2c73e; 
}
.rsNodeStrength1 {
	font-size: 12px;
	font-family: 'ProximaNova-Bold', Arial, sans-serif;
	font-weight: bold;
	color: #f47321;
}

.rsNodeStrength2 {
	font-size: 12px;
	font-family: 'ProximaNova-Bold', Arial, sans-serif;
	font-weight: bold;
	color: #d22929;
}

.rsNodeImg:hover {
	cursor: pointer;
}
.rsNodeText {
	font-size: 16px;
	font-family: 'ProximaNova-Bold', Arial, sans-serif;
	font-weight: bold;

}
.rsShared {
	display:inline-block;
	min-width:100px;
	margin-left:10px;
}

.rsSharedMobile {
	display:inline-block;
	min-width:100px;
}
.rsCloseButton {
	/*float: right;
	position: fixed;*/
	position: absolute;
	right: 10px;
	font-size:16px;
	font-weight: bold;
	color: gray;
}
.rsCloseButton:hover{
	cursor: pointer;
}
.rsIncorrect {
	float:right;
	position:relative;
	font-size:10px;
	color:#333;
	
}
.rsServices{
	float:right;
	position:relative;
	font-size:10px;
	color:#333;
}
.rsRequestProfile {
	float:right;
	position:relative;
	font-size:10px;
	color:#333;	
	text-decoration:underline;
}
.rsRequestProfile:hover
{
    cursor:pointer;
}
.rsProfileRequested
{
	float:right;
	position:relative;
	font-size:10px;
	color:green;
}

.rsDescription
{
	text-overflow: ellipsis;
	white-space: nowrap;
}
.link {
	text-decoration:none;
}

.link:hover {
	cursor:pointer;
}

._rsConfirmMatch, ._rsConfirmMatch:hover {
	text-decoration:underline;
}

.rsTableHeaderRow {
	background-color:#c3c3c3;
	height:28px;
	display:block;
	vertical-align:middle;
}

.rsLogo {
	display:inline-block;
	font-weight:bold;
	font-size:14px;
	color:#000;
	font-family: Arial, Helvetica, sans-serif !important;
}

.rsImage {
	top:10px;
	width:auto;
	height:auto;
	display:inline;
	position:relative;
	padding-bottom:8px;
}
.rsTitle {
	font-weight: normal !important;
	font-size: 14px !important;
	text-transform: none !important;

}

.rsServiceTd {
	white-space:normal;
}
.rsPosition {	
	font-size:14px;
}

.rsDateRange {
	color:#ccc;
	font-size:14px;
}

.rsEmploymentLink {
	text-decoration:none;
	color:#445A7D;
	font-size:14px;
}

.rsError {
	font-family: 'ProximaNova-Regular', Arial, sans-serif;
	font-size: 16px ;
	font-weight: normal ;
	margin-top: 10px;	
	padding-top: 40px;
}

.feedback-container
{
    color: Black;
    width: 150px;
    padding-left: 5px;
    margin-top: 10px;
    margin-bottom: 15px;
    height: 100px;
    text-align: center;
}
.rsProfileRequested
{
	color:green;
} 
.hide {	
    display: none;
  }
.rs-modal-body {
    background-color: #f1f1f2;
    border-bottom: 0px !important;
    
}

.rs-modal-body .rs-modal-textbox-label 
{
        padding-top: 4px;
}
.rsCaseModalCompact
{
	font-family: 'ProximaNova-Regular', Arial, sans-serif;
	position: absolute;
	top: 0% !important;
	left: 50%;
	z-index: 1050;
	overflow: auto;
	height: 150px;
	width: 560px;
	margin: 0 0 0 -280px !important;
	background-color: white;
	border: 1px solid #999;
	border: 1px solid rgba(0,0,0,.3);
	*border: 1px solid #999; /* IE6-7 */
	.border-radius(6px);
	.box-shadow(0 3px 7px rgba(0,0,0,0.3));
	.background-clip(padding-box);
}
.rsMobileCaseModalCompact
{
	font-family: 'ProximaNova-Regular', Arial, sans-serif;
	float: left;
	top: 10% !important;
	left: 5% !important;
	right: 5% !important;
	z-index: 1050;
	overflow: auto;
	height: 150px;
	max-width:90% !important;
	margin: 0 0 0 0 !important;
	background-color: white;
	border: 1px solid #999;
	border: 1px solid rgba(0,0,0,.3);
	*border: 1px solid #999; /* IE6-7 */
	.border-radius(6px);
	.box-shadow(0 3px 7px rgba(0,0,0,0.3));
	.background-clip(padding-box);
}
.sfCaseModal
{

	  font-family: 'ProximaNova-Regular', Arial, sans-serif;
	  position: absolute;
	  top: 0% !important;
	  left: 50%;
	  z-index: 1050;
	  overflow: auto;
	  height: 297px;
	  width: 560px;
	  margin: 0 0 0 -280px !important;
	  background-color: #f1f1f2;
	  border: 1px solid #999;
	  border: 1px solid rgba(0,0,0,.3);
	  *border: 1px solid #999; /* IE6-7 */
	  .border-radius(6px);
	  .box-shadow(0 3px 7px rgba(0,0,0,0.3));
	  .background-clip(padding-box);
}

.feedback-box
{
    padding-right: 20px;
    border-right: 2px solid #d5d6d8;
}

.feedback-info
{
    background-color: #F1F1F2;
    padding: 8px 10px 10px 10px;
    border-top: 1px solid #CCCCCC;
}
.feedback-info .feedback-disabled
{
    color: gray;
    font-size: 12px;
}
.feedback-info .feedback-divider
{
    padding-bottom: 10px;
    margin-bottom: 10px;
}

.feedback-info .feedback-input
{ 
    border: 1px solid #CCCCCC;
}

.feedback-input
{
	height: 18px;
	padding: 4px 6px;
	margin-bottom: 9px;
	color: #545454;
	width: 429px;
	height: 26px;
}
.chatter-input-text
{
    border: 1px solid #CCCCCC;
    width: 485px;
    resize:none; 
    padding-bottom:0; 
    margin-bottom:0 	
}
.feedback-input-text
{
    border: 1px solid #CCCCCC;
    width: 485px;
    height:45px;
    resize:none; 
    padding-bottom:0; 
    margin-bottom:0 
}

.modal-header 
{
	 padding: 9px 15px 3px;
	 border-bottom: 1px solid #eee;
	 height: 47px;
	background-color: white;  
}
.modal-header-noBorder
{
	padding: 9px 15px 3px;
	height: 47px;
	background-color: white;  	
}
h3.modal-Header 
{
    margin: 0;
    line-height: 30px;
}
.modal-header .close 
{ 
	margin-top: 2px; 
}
.rs-modal-header h4 
{
	font-family: 'ProximaNova-Regular', Arial, sans-serif !important;
	font-size: 16px !important;
	font-weight: normal !important;
	margin-top: 10px !important;
}  
.pull-left {
  float: left;
}
.close {
  float: right;
  font-size: 20px;
  font-family: 'ProximaNova-Bold', Arial, sans-serif;
  line-height: 18px;
  color: #000;
  text-shadow: 0 1px 0 rgba(255,255,255,1);
  opacity: 0.2;

}
button.close {
  padding: 0;
  cursor: pointer;
  background: transparent;
  border: 0;
  -webkit-appearance: none;
}
.modal-body {
  overflow-y: auto;
  max-height: 400px;
  padding: 8px;
}

button.close {
  padding: 0;
  cursor: pointer;
  background: transparent;
  border: 0;
  -webkit-appearance: none;
}
.rs-modal-footer 
{
	text-align: center;
}
.btn-cds
{
	background:#e8e8e9 url('/img/alohaSkin/btn_sprite.png') repeat-x right top;
	background-color: whitesmoke !important;
	
	border: 1px solid #b5b5b5;
	border-bottom-color: #7f7f7f;
	
	-webkit-border-radius:3px;
	border-radius: 3px;

	color: #333;

	font-family:  Arial,Helvetica,sans-serif;
	font-size: 12px !important;
	font-weight: bold;

	margin: 1px;
	
	padding: 2px 14px 2px 14px !important;
}
.btn-cds:hover
{
	cursor: pointer;
}
.modal-backdrop {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1040;
  background-color: #000;
  opacity: .8;
  width: 100%;
  height: 100%;
  *filter: alpha(opacity=80);/*IE 7*/
  position: absolute;
  display: block;
  
 }
 .modal-footer
 {
 	
 }
 .rsHelpText
 {
 	font-style: italic;
 	font-size: 10pt;
 	color: #888888;
 	padding-left: 10px;
 }
.rsRelsCard {
	width: inherit !important;
}
.rs-row-fluid
{
	padding-left: 8px;
	padding-bottom: 2px;
}
.rs-pubcontent
{
	padding-left: 8px;
	padding-bottom: 2px;
}
.rs-pubcontent-label
{
	text-transform: uppercase;
	font-size: 14px;
	font-weight: 200;
}
.rsRelationshipDetails
{
	position: relative;
	height: 150px !important;
	overflow-x: hidden !important;
	width: inherit;
	text-align: center;
}
.rsRelationshipDetailsMobile
{
	position: fixed;
	width: 300px !important;
	height: 150px !important;
}
.rsArrow {
    position: absolute;
	background: #fff;
    overflow: visible;
}
.rsArrow:after, .rsArrow:before {
    top: 100%;
    left: 50%;
    border: solid transparent;
    content:"";
    height: 0;
    width: 0;
    position:absolute;
    pointer-events: none;
}
.rsArrow:after {
    border-color: rgba(255, 255, 255, 0);
	border-top-color: #ffffff;
	border-width: 10px;
	margin-left: -10px;
}
.rsArrow:before {
	border-color: rgba(78, 122, 49, 0);
	border-top-color: #888888;
	border-width: 11px;
	margin-left: -11px;
}
.rsModuleContent {
	background-color: white !important;
	max-width: 60%;
}
.rsMobilePadding{
	padding: 5px 5px 5px 5px;
}
.rsMobilePathTitle {
	margin-left: 5px;
	font-weight: bold;
	text-decoration: none;
	padding-bottom: 10px;
}
.rsMobileActionButton{
    border-radius: 5px !important;
	width: 100%;
	font-family: 'ProximaNova-Regular', Arial, sans-serif;
	font-size: 14px;
	font-weight: bold;
	border: 1px solid;
	border-color: #b2b2b2;
	background-color: #e5e5e5;
	color: #445A7D;
	padding-top: 10px;
	padding-bottom: 10px;
	height:50px;

}
.rsMobilePaths {
	border: 1px solid black;
	text-align: left;
	width: 98%;
	margin: 10px 10px 10px 5px;
	padding-right: 10px;
}

.rsMobilePathCenterAlign {
	text-align: center;
}

.rsMobilePathRow {
	font-weight:bold;
	font-size:12px;
	height: 30px;
	padding-top: 15px;
	padding-bottom: 10px;
	overflow: visible;
}
.rsMobilePathConnectionStrength {
	border-bottom: 1px solid #b2b2b2;
	border-top: 1px solid #b2b2b2;
}
.rsNoUnderline {
	text-decoration: none !important;
}
.rsMobileWrapText {
	white-space: normal !important;
	overflow: auto;
	padding padding-bottom: 5px;
}

.rsMobileCaseModal {
	width: 90% !important;
	margin: 0 0 0 0 !important;
	left: 5% !important;
	right: 5% !important;
	top: 10% !important;
	position: fixed !important;
}

.rsMobilePathStation {
	width: 33px;
	height: 44px;
	padding-left:27px;
	padding-top: 10px;
	padding-right:20px;

}
.rsMobilePathTarget {
	width: 33px;
	height: 44px;
	padding-left:28px;
	padding-top: 10px;
	padding-right:20px;
}

.rsMobilePathBackground {
	width: 4px;
	height: 115px;
	left:35px;
	top:-40px;
	z-index: -1;
	position: relative;
}

.rsMobilePathBackgroundColor2 {
	background-image: url('https://www.relsci.com/Content/Images/bg/strong.png');
}
.rsMobilePathBackgroundColor1 {
	background-image: url('https://www.relsci.com/Content/Images/bg/average.png');
}
.rsMobilePathBackgroundColor0 {
	background-image: url('https://www.relsci.com/Content/Images/bg/weak.png');
}

.rsMobilePathBackgroundParent
{
	height: 30px;
}

.chatter-input-text-mobile
{
    border: 1px solid #CCCCCC;
    resize:none; 
    padding-bottom:0; 
    margin-bottom:0;
	
    width:90% !important;

}
.rsLeft {
	width: 300px !important;
}
.rsRight {
	width: 300px !important;
}
.rsHeader {
	width: 800px !important;
}
.rsPathsTable {
	width:100%;
	border: none;
	text-overflow:ellipsis;

}
.rsMobileFloatRight {
	float:right;
	padding-top:15px;
}
.myTopPaths {
	width: 100%;
}
.colleaguesTopPaths {
	width: 100%;
}
.rsMobileLogo
{
    width: 30px;
    height: 30px;
    padding-right:14px;
}
.rsMobileCardHeader
{
    font-size:14px;
    color: #3c3d3e;
}
.rsMobileCard
{
    height:30px;
    padding:14px;
	border-top-left-radius: 5px;
	border-top-right-radius: 5px;    
}
.rsFloatLeft
{
    float:left;
}
.rsMobileCardTitle
{
    line-height:30px;
}
.rsChatterShareTitle
{
	position: relative; 
	overflow:hidden; 
	padding-left: 60px;
	white-space:nowrap; 
	text-overflow:ellipsis;
	width: 60%; 
	display:inline;	
}


</style>
<div>
	<apex:outputPanel rendered="{!!IsMobile}">
		<span class="rsLogo">
			<img class="" style="padding-top:10px;" src="https://static.relsci.com/Content/Crm/Images/favicon.png"></img> 
			RelSci
		</span>
	</apex:outputPanel>
	<apex:outputPanel rendered="{!IsMobile}">
        <div class="rsMobileCard">
            <div class="rsMobileCardHeader">
                <div class="rsFloatLeft">
                    <img class="rsMobileLogo" src="https://www.RelSci.com/Content/Images/Logo-Large.png"></img> 
                </div>
                <span class="rsFloatLeft rsMobileCardTitle">RelSci</span>
            </div>

        </div>

	    <hr />
		<apex:outputPanel rendered="{!IgnoreEntity}">
			<div class="rsMobileFloatRight">
				<span>
				<apex:outputPanel rendered="{!ShowIgnoreEntity}">
					<span style="float:right; padding-right:4px; padding-left:4px;"></span>
					<a href="javascript: void(0);" class="rsIncorrect" id="_rsEnableMatching">Enable Matching</a>
				</apex:outputPanel>
				<apex:outputPanel rendered="{! !ShowIgnoreEntity && !ProfileRequested}">
					<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
					<span id="pfRequest">
						<span class="rsRequestProfile">Request Profile</span>
					</span>
				</apex:outputPanel>
					<apex:outputPanel rendered="{! !ShowIgnoreEntity && ProfileRequested}">
						<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
						<span id="pfRequest">
							<span class="rsProfileRequested">Profile Previously Requested</span>
						</span>
					</apex:outputPanel>				
				</span>
			</div>
			<div id="_rsEntityIgnoredBody">
				<p>Entity has been ignored from being matched</p>
			</div>
		</apex:outputPanel>
		<apex:outputPanel rendered="{!ShowNoPaths}">
			<div class="rsMobileFloatRight">
				<span>
					<a href="javascript: void(0);" class="rsIncorrect" id="_rsIncorrect">Incorrect Match?</a>
				</span>
			</div>
		</apex:outputPanel>
		<apex:outputPanel rendered="{!ShowPath}"> 
			<div class="rsMobilePadding rsMobileFloatRight">
				<span>
					<a href="javascript: void(0);" class="rsIncorrect" id="_rsIncorrect">Incorrect Match?</a>
				</span>
			</div>
		</apex:outputPanel>
		<apex:outputPanel rendered="{!ShowMatching}">
			<div class="rsMobilePadding rsMobileFloatRight"> 
				<div class="rsIncorrect">
					<a href="javascript: void(0);" class="" id="_searchLink">Still don't see the correct match?</a>
					<apex:outputPanel rendered="{!ShowIgnoreEntity}">
						<a href="javascript: void(0);" style="display:none;" id="_rsIgnore">Ignore Link</a>
					</apex:outputPanel>
				</div>	
			</div>
		</apex:outputPanel>			
	</apex:outputPanel>
</div>

<apex:pageMessages />
<apex:outputPanel rendered="{!!RelSciError}">
<apex:outputPanel rendered="{!ShowRSAuthMsg}">
<p>Salesforce does not have access to your RelSci account. To enable access, click <a target="_blank" href="{!URLFOR($Page.RelSci)}">here</a>.</p>
</apex:outputPanel>	 

<apex:outputPanel rendered="{!!ShowRSAuthMsg}">
<div id="__rsContent">
<apex:outputPanel rendered="{!ShowMatching}">
	<div style="padding-top:5px; padding-bottom:5px;"> 
		<apex:outputPanel rendered="{!!IsMobile}">
			<a href="javascript: void(0);" class="rsServices" id="_rsServices">RelSci Services</a>
			<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
		
			<div class="rsIncorrect" style="float:right;">
				<a href="javascript: void(0);" class="" id="_searchLink">Still don't see the correct match?</a>
				<apex:outputPanel rendered="{!ShowIgnoreEntity}">
					<a href="javascript: void(0);" style="display:none;" id="_rsIgnore">Ignore Link</a>
				</apex:outputPanel>
				<apex:outputPanel rendered="{! !ShowIgnoreEntity && !ProfileRequested}">
					<span id="pfRequest">
						<span class="rsRequestProfile" style="display:none" id="_rsRequestProfile">Request Profile</span>
					</span>
				</apex:outputPanel>
				<apex:outputPanel rendered="{! !ShowIgnoreEntity && ProfileRequested}">
					<span id="pfRequest">
						<span class="rsProfileRequested" style="display:none" id="_rsProfileRequested" >Profile Previously Requested</span>
					</span>
				</apex:outputPanel>	
			</div>
		</apex:outputPanel>		
	</div>
</apex:outputPanel>	
<apex:outputPanel id="mainframe">
		<apex:outputPanel rendered="{!!IsMobile}">
			<apex:outputPanel rendered="{!IgnoreEntity}">
		<div>
			<span>
				<a href="javascript: void(0);" class="rsServices" id="_rsServices">RelSci Services</a>
				<apex:outputPanel rendered="{!ShowIgnoreEntity}">
					<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
					<a href="javascript: void(0);" class="rsIncorrect" id="_rsEnableMatching">Enable Matching</a>
				</apex:outputPanel>
				<apex:outputPanel rendered="{! !ShowIgnoreEntity && !ProfileRequested}">
					<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
					<span id="pfRequest">
						<span class="rsRequestProfile">Request Profile</span>
					</span>
				</apex:outputPanel>
				<apex:outputPanel rendered="{! !ShowIgnoreEntity && ProfileRequested}"> <span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
					<span id="pfRequest">
						<span class="rsProfileRequested">Profile Previously Requested</span>
					</span>
				</apex:outputPanel>				
			</span>
		</div>
		<p>Entity has been ignored from being matched</p>
	</apex:outputPanel>
	
	<apex:outputPanel rendered="{!ShowNoPaths}">
		<div>
		<span>
			<a href="javascript: void(0);" class="rsServices" id="_rsServices">RelSci Services</a>
			<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
			<a href="javascript: void(0);" class="rsIncorrect" id="_rsIncorrect">Incorrect Match?</a>
		</span>

		<div>
			<span class="rsCompanyName" id="_rsBaseTitle">
			
			<a class="rsCompanyName link" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(PathService.PathDataResp.Header.Entity.Link)}">{!(PathService.PathDataResp.Header.Entity.DisplayName)}</a>
			</span>  
			
			<span class="rsSubTitle" id="_rsSubTitle">{!(PathService.PathDataResp.Header.SubTitleConv)}</span>
		</div>
	
		
		</div>
		<p>There are no paths available.</p>
	</apex:outputPanel>

	<apex:outputPanel rendered="{!ShowPath}"> 
		<div>
		<span>
			<a href="javascript: void(0);" class="rsServices" id="_rsServices">RelSci Services</a>
			<span style="float:right; padding-right:4px; padding-left:4px;"> | </span>
			<a href="javascript: void(0);" class="rsIncorrect" id="_rsIncorrect">Incorrect Match?</a>
		</span>
		<div>
			<span class="rsCompanyName" id="_rsBaseTitle">
		
			<a class="rsCompanyName link" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(PathService.PathDataResp.Header.Entity.Link)}">{!(PathService.PathDataResp.Header.Entity.DisplayName)}</a>
			</span> 
		
			<span class="rsSubTitle" id="_rsSubTitle">{!(PathService.PathDataResp.Header.SubTitleConv)}</span>
		</div>
		</div>
		<apex:outputPanel rendered="{!(ShowAddRelationshipsButton && PathService.PathDataResp.Header.Entity.EntityType == 7) || (ShowAddOrganizationConnectionButton && PathService.PathDataResp.Header.Entity.EntityType == 6)}">
			<apex:outputPanel rendered="{!IKnowThem}">
				<input id="_rsAddRemoveRelationship" type="button" value="- Remove Relationship"></input>
			</apex:outputPanel>
			<apex:outputPanel rendered="{!!IKnowThem}">
				<input id="_rsAddRemoveRelationship" type="button" value="+ Add Relationship"></input>
			</apex:outputPanel>
		</apex:outputPanel>
		<!--[if lte IE 8]>
			<style type="text/css">
				.rsChatterShareButton {
					display: none;
				}
			</style>
		<![endif]-->
		<apex:outputPanel rendered="{!ChatterEnabled}">
			<input id="_rsShareButtonClick" type="button" value="Share" class="rsChatterShareButton"></input>
		</apex:outputPanel>
		<hr />
		<apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.isOrganization}">
		<span id="_rsBusinessDescriptionHtml">
		<p style="padding:5px;">{!(PathService.PathDataResp.Header.Entity.Description)}</p>
		</span>
		</apex:outputPanel>
		

		
		<apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.isPerson}">
		<div id="_rsCareerSummaryHtml">
			<div style="margin-bottom:10px;">
			<apex:repeat value="{!PathService.PathDataResp.Employments}" var="emp">
						<div style="padding:1px;">
						
						<a class="rsEmploymentLink" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(emp.Company.Link)}">
						<apex:outputText value="{!emp.Company.DisplayName}">
						</apex:outputText>
						</a>
						 -
						<span class="rsPosition">
						<apex:outputText value="{!emp.FirstTitle.Name}">
						</apex:outputText>
						</span>
						<span class="rsDateRange">
						<apex:outputText value="{!emp.FirstTitle.DateRange.Text}">
						</apex:outputText>
						</span>
						  
						</div>
					</apex:repeat>
			</div>
		</div>
		</apex:outputPanel>
		<table class="rsPathsTable">
		<tr>
		<td class="pbTitle" width="50%">
		<h2 class="mainTitle">My Top Paths</h2>
		<span class="rsHelpText">click on the arrows to view connection details</span>
		</td>
		<td class="pbTitle">
		<h2 class="mainTitle">
		<apex:outputText value="My Colleagues' Paths" rendered="{!HasSharedPaths}">
		
		</apex:outputText>
		</h2>
		</td> 
		</tr>
		<tr>	
		<td>
		
		<div id="_rsMyTopPaths">
			<h2 class="rsMyTopPathsChatterTitle" style="display:none">My Top Paths</h2>
			<table class="myTopPaths">
			<apex:repeat value="{!PathService.PathDataResp.My.Top5Paths}" var="path">
			<tr>
			<apex:repeat value="{!path.Hops}" var="hop">
				<apex:outputPanel rendered="{!hop.IsLink}">
					<td style="white-space: nowrap;">
						<apex:outputLink target="_blank" styleClass="{!hop.DisplayClass}"  value="{!hop.Link}">{!hop.DisplayName}</apex:outputLink>
					</td>
				</apex:outputPanel>

				<apex:outputPanel rendered="{!!hop.IsLink}">
					<td style="white-space: nowrap;">
						<apex:outputText styleClass="{!hop.DisplayClass}" value="{!hop.DisplayName}"></apex:outputText>  
					</td>
				</apex:outputPanel>
					<td style="white-space: nowrap;">
							<img class="rsNodeImg" id="_rsNodeImg" src="https://static.relsci.com/Content/Crm/images/{!URLENCODE(hop.PathImg)}" border="0" data-nextEntityId="{!hop.NextNode.EntityId}" data-currentIsProp="{!hop.Node.IsProp}" data-nextIsProp="{!hop.NextNode.IsProp}" data-nextnode="{!hop.NextNode}" data-currentEntityId="{!hop.EntityId}"/>
					</td>
					<td style="rsNodeImgText">
						<span class="rsNodeImgText rsNodeStrength{!hop.Strength}" id="_rsNodeText" style="display:none">></span>
					</td>
					<apex:outputPanel rendered="{!hop.NextNode.Entity.EntityId == path.EndNode.Node.EntityId && hop.NextNode.IsProp}">
						<td style="white-space: nowrap;">
							<a target="_blank" class="rsPropPerson" href="{!path.EndNode.Link}">{!hop.NextNode.DisplayName}</a>
						</td>
					</apex:outputPanel>		
					<apex:outputPanel rendered="{!hop.NextNode.Entity.EntityId == path.EndNode.Node.EntityId && !hop.NextNode.IsProp}">
						<td style="white-space: nowrap;">
							<apex:outputLink target="_blank" styleClass="{!HTMLENCODE(path.EndNode.DisplayClass)}"  value="{!path.EndNode.Link}">{!path.EndNode.DisplayName}</apex:outputLink>
						</td>
					</apex:outputPanel>								
				</apex:repeat>
			</tr>		
			</apex:repeat>
			</table>
		</div>
		</td>
		<td valign="top" width="50%">
		
		<div id="_rsColleagueTopPaths">
			<h2 class="rsMyColleagueTopPathsChatterTitle" style="display:none">My Colleagues' Paths</h2>
			<table class="colleaguesTopPaths">
			<apex:repeat value="{!SecondColPaths}" var="path">
			<tr>
				<apex:repeat value="{!path.Hops}" var="hop">
					<apex:outputPanel rendered="{!hop.IsLink}">
						<td style="white-space: nowrap;">
							<apex:outputLink target="_blank" styleClass="{!HTMLENCODE(hop.DisplayClass)}" value="{!hop.Link}">{!hop.DisplayName}</apex:outputLink>
						</td>
					</apex:outputPanel>
					
					<apex:outputPanel rendered="{!!hop.IsLink}">
						<td style="white-space: nowrap;">
							<apex:outputText styleClass="{!HTMLENCODE(hop.DisplayClass)}"  value="{!hop.DisplayName}"></apex:outputText>
						</td>
					</apex:outputPanel>

					<td style="white-space: nowrap;">
						<img class="rsNodeImg" id="_rsNodeImg" src="https://static.relsci.com/Content/Crm/images/{!URLENCODE(hop.PathImg)}" data-currentIsProp="{!hop.Node.IsProp}" data-nextIsProp="{!hop.NextNode.IsProp}" data-nextEntityId="{!hop.NextNode.EntityId}" data-currentEntityId="{!hop.EntityId}" border="0"/>
					</td>
					<td style="rsNodeImgText">
						<span class="rsNodeImgText rsNodeStrength{!hop.Strength}" id="_rsNodeText" style="display:none">></span>
					</td>
					<apex:outputPanel rendered="{!hop.NextNode.Entity.EntityId == path.EndNode.Node.EntityId && hop.NextNode.IsProp}">
						<td style="white-space: nowrap;">
							<a target="_blank" class="rsPropPerson" href="{!path.EndNode.Link}">{!hop.NextNode.DisplayName}</a>
						</td>
					</apex:outputPanel>		
					<apex:outputPanel rendered="{!hop.NextNode.Entity.EntityId == path.EndNode.Node.EntityId && !hop.NextNode.IsProp}">
						<td style="white-space: nowrap;">
							<apex:outputLink target="_blank" styleClass="{!HTMLENCODE(path.EndNode.DisplayClass)}"  value="{!path.EndNode.Link}">{!path.EndNode.DisplayName}</apex:outputLink>
						</td>
					</apex:outputPanel>							
				</apex:repeat> 
			</tr>		
			</apex:repeat>
			</table>
		</div>
		</td>
		</tr>
		<tr>
		<td valign="bottom" align="right" width="50%"> 
		<apex:outputPanel rendered="{!HasSharedPaths}">
		<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=MyRelationships')}">See All My Paths</a>
		</apex:outputPanel>
		</td>
		<td valign="bottom" align="right" width="50%">
		
		<apex:outputPanel rendered="{!HasSharedPaths}">
			<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=SharedRelationships')}">See All Colleagues' Paths</a>
		</apex:outputPanel>
		
		<apex:outputPanel rendered="{!!HasSharedPaths}">
			<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=MyRelationships')}">See All My Paths</a>
		</apex:outputPanel>
		
		
		</td>
		</tr>
		</table>
	</apex:outputPanel>
	</apex:outputPanel>
	<apex:outputPanel rendered="{!IsMobile}">
	<apex:outputPanel rendered="{!ShowNoPaths}">
	<div>

		<span class="rsMobileCompanyName" id="_rsBaseTitle">
		
		<a class="link" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(PathService.PathDataResp.Header.Entity.Link)}">{!(PathService.PathDataResp.Header.Entity.DisplayName)}</a>
		</span>  
		
		<span class="rsSubTitle" id="_rsSubTitle">{!(PathService.PathDataResp.Header.SubTitleConv)}</span>
		
	
		
		</div>
		<p>There are no paths available.</p>
	</apex:outputPanel>

	<apex:outputPanel rendered="{!ShowPath}"> 
		<div class="rsMobilePadding">
		<span class="rsMobileCompanyName" id="_rsBaseTitle">
		
		<a class="rsMobileCompanyName link" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(PathService.PathDataResp.Header.Entity.Link)}">{!(PathService.PathDataResp.Header.Entity.DisplayName)}</a>
		</span> 
		<div>
			<span class="rsMobileSubTitle" id="_rsSubTitle">{!(PathService.PathDataResp.Header.SubTitleConv)}</span>
		</div>
		</div>
		<apex:outputPanel rendered="{!(ShowAddRelationshipsButton && PathService.PathDataResp.Header.Entity.EntityType == 7) || (ShowAddOrganizationConnectionButton && PathService.PathDataResp.Header.Entity.EntityType == 6)}">
		<hr/>
			<apex:outputPanel rendered="{!IKnowThem}">
				<div class="rsMobilePadding">
					<span>
						<input id="_rsAddRemoveRelationship" type="button" value="- Remove Relationship" class="rsMobileActionButton rsMobilePadding"></input>
					</span>
				</div>
			</apex:outputPanel>
			<apex:outputPanel rendered="{!!IKnowThem}">
				<div class="rsMobilePadding">
					<span>
						<input id="_rsAddRemoveRelationship" type="button" value="+ Add Relationship" class="rsMobileActionButton rsMobilePadding"></input>
					</span>
				</div>
			</apex:outputPanel>
		</apex:outputPanel>
		<!--[if lte IE 8]>
			<style type="text/css">
				.rsChatterShareButton {
					display: none;
				}
			</style>
		<![endif]-->
		<apex:outputPanel rendered="{!ChatterEnabled}">
			<div class="rsMobilePadding">
				<span>
					<input id="_rsShareButtonClick" type="button" value="Share" class="rsMobileActionButton rsMobilePadding"></input>
				</span>
			</div>
			</apex:outputPanel>
			<hr />
			<apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.isOrganization}">
			<span id="_rsBusinessDescriptionHtml">
			<p style="padding:5px;">{!(PathService.PathDataResp.Header.Entity.Description)}</p>
			</span>
		</apex:outputPanel>
		
		
		
		<apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.isPerson}">
			<div id="_rsCareerSummaryHtml">
				<div style="margin-bottom:10px;">
				<apex:repeat value="{!PathService.PathDataResp.Employments}" var="emp">
							<div style="padding:1px;">
							
							<a class="rsEmploymentLink" target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE(emp.Company.Link)}">
							<apex:outputText value="{!emp.Company.DisplayName}">
							</apex:outputText>
							</a>
							 -
							<span class="rsPosition">
							<apex:outputText value="{!emp.FirstTitle.Name}">
							</apex:outputText>
							</span>
							<span class="rsDateRange">
							<apex:outputText value="{!emp.FirstTitle.DateRange.Text}">
							</apex:outputText>
							</span>
							  
							</div>
						</apex:repeat>
				</div>
			</div>
		</apex:outputPanel>
		<hr/>
		<h2 class="mainTitle rsMobilePathTitle">My Top Paths</h2>
		<div id="_rsMyTopPaths">	
		
			<h2 class="rsMyTopPathsChatterTitle" style="display:none">My Top Paths</h2>
			<apex:repeat value="{!PathService.PathDataResp.My.Top5Paths}" var="path">
				<table class="rsMobilePaths">
					<apex:repeat value="{!path.Hops}" var="hop">
						<tr>
							<td class="rsMobilePathStation rsMobileImageBar">
								<div>
									<img src="https://www.relsci.com/Content/Images/Medium-Station.png"/>
								</div>
							</td>
							<td class="rsMobilePathRow">
								<apex:outputLink target="_blank" rendered="{!hop.IsLink}" styleClass="{!hop.DisplayClass}Mobile rsNoUnderline rsNodeText"  value="{!hop.Link}">{!hop.DisplayName}</apex:outputLink>
								<apex:outputText rendered="{!!hop.IsLink}" styleClass="{!hop.DisplayClass}Mobile rsNodeText rsNoUnderline" value="{!hop.DisplayName}"></apex:outputText>  
							</td>
						</tr>
						<tr>
							<td class="rsMobilePathRow rsMobileImageBar">
								<div class="rsMobilePathBackgroundParent">
									<div class="rsMobilePathBackground rsMobilePathBackgroundColor{!hop.Strength}">
									</div>
								</div>
							</td>
							<td class="rsMobilePathConnectionStrength rsMobilePathRow">
								<apex:outputPanel rendered="{!hop.Strength == 2}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Strong</span>
								</apex:outputPanel>
								<apex:outputPanel rendered="{!hop.Strength == 1}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Average</span>
								</apex:outputPanel>
								<apex:outputPanel rendered="{!hop.Strength == 0}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Weak</span>
								</apex:outputPanel>
							</td>
						</tr>
					</apex:repeat>
					<tr>
						<td class="rsMobilePathTarget rsMobileImageBar">
							<img src="https://www.relsci.com/Content/Images/Medium-Target.png"/>
						</td>
						<td class="rsMobilePathRow">
							<apex:outputLink target="_blank" styleClass="{!HTMLENCODE(path.EndNode.DisplayClass)}Mobile rsNodeText rsNoUnderline"  value="{!path.EndNode.Link}">{!path.EndNode.DisplayName}</apex:outputLink>
						</td>
					</tr>
				</table>
			</apex:repeat>

		</div>
 		<div class="rsMobilePathTitle">
			<apex:outputPanel rendered="{!HasSharedPaths}">
				<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=MyRelationships')}">See All My Paths</a>
			</apex:outputPanel>
		
			<apex:outputPanel rendered="{!!HasSharedPaths}">
				<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=MyRelationships')}">See All My Paths</a>
			</apex:outputPanel>
		</div>
		
	<apex:outputPanel rendered="{!HasSharedPaths}">
		<br/>

		<h2 class="mainTitle rsMobilePathTitle">My Colleagues' Paths</h2>

		<div id="_rsColleagueTopPaths">
			<h2 class="rsMyColleagueTopPathsChatterTitle" style="display:none">My Colleagues' Paths</h2>
			<apex:repeat value="{!SecondColPaths}" var="path">
				<table class="rsMobilePaths">
					<apex:repeat value="{!path.Hops}" var="hop">
						<tr>
							<td class="rsMobilePathStation rsMobileImageBar">
								<div>
									<img src="https://www.relsci.com/Content/Images/Medium-Station.png"/>
								</div>
							</td>						
							<td class="rsMobilePathRow">
								<apex:outputLink target="_blank" rendered="{!hop.IsLink}" styleClass="{!HTMLENCODE(hop.DisplayClass)}Mobile rsNodeText rsNoUnderline"  value="{!hop.Link}">{!hop.DisplayName}</apex:outputLink>
								<apex:outputText rendered="{!!hop.IsLink}" styleClass="{!hop.DisplayClass}Mobile rsNodeText rsNoUnderline" value="{!hop.DisplayName}"></apex:outputText>  
							</td>
						</tr>
						<tr>
							<td class="rsMobilePathRow rsMobileImageBar">
								<div class="rsMobilePathBackgroundParent">
									<div class="rsMobilePathBackground rsMobilePathBackgroundColor{!hop.Strength}">
									</div>
								</div>
							</td>
							<td class="rsMobilePathConnectionStrength rsMobilePathRow">
								<apex:outputPanel rendered="{!hop.Strength == 2}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Strong</span>
								</apex:outputPanel>
								<apex:outputPanel rendered="{!hop.Strength == 1}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Average</span>
								</apex:outputPanel>
								<apex:outputPanel rendered="{!hop.Strength == 0}">
									<span class="rsNodeStrength{!hop.Strength}" id="_rsNodeText">Weak</span>
								</apex:outputPanel>
							</td>
						</tr>
					</apex:repeat> 
					<tr>
						<td class="rsMobilePathTarget rsMobileImageBar">
							<img src="https://www.relsci.com/Content/Images/Medium-Target.png"/>
						</td>
						<td class="rsMobilePathRow">
							<apex:outputLink target="_blank" styleClass="{!HTMLENCODE(path.EndNode.DisplayClass)}Mobile rsNodeText rsNoUnderline"  value="{!path.EndNode.Link}">{!path.EndNode.DisplayName}</apex:outputLink>
						</td>
					</tr>
				</table>
			</apex:repeat>
		</div>
		<div class="rsMobilePathTitle">
			<a target="_blank" href="{!URLFOR($Page.RelSci)}?frame={!URLENCODE('/FindAPath?Start=Me&End=Entity:'+(PathService.PathDataResp.Header.Entity.EntityIdStr)+'&Show=SharedRelationships')}">See All Colleagues' Paths</a>
		</div>
	</apex:outputPanel>
</apex:outputPanel>	
		
	</apex:outputPanel> 
	   <apex:outputPanel rendered="{!ShowMatching}">
	   <div id="_otfSync">
	   <apex:outputText value="No Possible Matches Found."
	   rendered="{!NoMatches}">
	   </apex:outputText>

	<apex:outputPanel rendered="{!HasAutoMatch}">
		<c:RSAutoMatch AutoMatch="{!AllMatches.MatchedEntity}" IsMobile="{!IsMobile}"></c:RSAutoMatch>
	</apex:outputPanel>
   	<apex:outputPanel rendered="{!HasPeopleMatches}">
	   <c:RSPossibleMatch Type="Person" PossibleMatches="{!PeopleMatches}" HasPossibleMatches="{!HasPeopleMatches}"   IsMobile="{!IsMobile}"></c:RSPossibleMatch>
	</apex:outputPanel>
	   
   <apex:outputPanel rendered="{!HasOrgMatches}">
	   <c:RSPossibleMatch Type="Organization" PossibleMatches="{!OrgMatches}" HasPossibleMatches="{!HasOrgMatches}" IsMobile="{!IsMobile}"></c:RSPossibleMatch>
   </apex:outputPanel> 
	   
	   </div>
	   
	   <div id="_search" style="display:none;">
	     
      
      Search for a match: <input id="_rsSearch" type="text" /> <button id="_rsSearchButton" value="Search">Search</button> <img id="_showSearching" style='display:none;' src='https://static.relsci.com/Content/Crm/Images/mini-loader.gif'></img>
      <div id="_searchResultsList">
      
      </div>
      </div>
      <script>
      (function () {
      	$.rsciPool = [];
		$.rsciPool.abortAll = function() {
		    $(this).each(function(idx, jqXHR) {
		        jqXHR.abort();
		    });
		    $.rsciPool.length = 0
		};
      	jQuery("#_searchLink").click(function () {
      		$("#_otfSync").hide();
      		$("#_search").show();  
      		$("#_searchLink").hide();
      		$("#_rsIgnore").show();
      		if({!ProfileRequested})
      		{
      			$("#_rsProfileRequested").show();	
      		}
      		else
      		{
      			$("#_rsRequestProfile").show();	
      		}
      		
      	});
      	jQuery("#_rsSearchButton").click(function () {
      		
      		search();
      	});
      	
      	function search() {
      		if( $("#_showSearching").css("display") == 'none' ){
      			$("#_showSearching").show();
      		}
      		if($.rsciPool != null)
      		{
      			$.rsciPool.abortAll();	
      		}
      		
      		var value = $("#_rsSearch").val();
      		var baseurl = "{!URLFOR($Page.RelSciSearchHandler)}";
      		if(baseurl[baseurl.length-1] == "/")
      		{
      			baseurl = baseurl.substring(0,baseurl.length-2);
      		}
      		
      		jQuery.ajax({
      			url: baseurl,
      			cache:false,
      			data: {
      				searchTerm: value, 
      				uniqueId: '{!JSENCODE(UniqueId)}',
      				sfType: '{!JSENCODE(qsType)}',
      				csrf: '{!JSENCODE(csrf)}',
      				IsMobile: '{!IsMobile}'
      			},
      			success: function(data) {      				
      				$("#_searchResultsList").html(data);
      				$("#_showSearching").hide();
      			}
      		});
     	}
      	
      	jQuery("#_rsSearch").keyup(function () {
      		search();
      	});
      	
      	
		
		$.ajaxSetup({
		    beforeSend: function(jqXHR) {
		    	if($.rsciPool != null)
      			{
		        	$.rsciPool.push(jqXHR);
		        }
		    },
		    complete: function(jqXHR) {
		        if($.rsciPool != null)
      			{
		        	var index = $.rsciPool.indexOf(jqXHR);
		        	if (index > -1) {
		            	$.rsciPool.splice(index, 1);
		        	}
		        }
		    }
		});
		
		})();
      </script>
       </apex:outputPanel>        
      
</apex:outputPanel>
</div>
<apex:outputPanel rendered="{!!IsMobile}">
	<div id="_relsChatterShareModal" class="modal hide sfCaseModal">
		<div class="modal-header-noBorder rs-modal-header">
			<div class="pull-left">
	        	<img src="https://www.relsci.com/Content/Images/Logo-Feedback.png" border="0" alt="Logo"></img>
			</div>
			<h4 class="pull-left" style="margin-left:10px;">Share | {!PathService.PathDataResp.Header.Entity.DisplayName}</h4>
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
			<div class="clear"></div>
		</div>
		<apex:form >
			<div class="feedback-info" style="border-top:0;padding: 0px 8px 10px 8px;">
		        <div class="modal-body rs-modal-body">
	                <span class="feedback-disabled">Select which content you would like to share to Chatter:</span>
	            </div>
	            <div class="rs-row-fluid">
	            	<input type="checkbox" id="_relSciHelpedCheckbox"/>
	            	<span class="label">RelSci helped me with this {!JSENCODE(qsType)}</span>
	            </div>
	            <div class="rs-row-fluid ui-widget">
	            	<textarea class="chatter-input-text" rows="2" cols="20"
	               		placeholder='Add "@person/group" to share with non-followers of this contact' id="_relsChatterShareWith"></textarea>
	               	<input class="hide" id="_relsChatterMentionIds"/>
	            </div>
	            <apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.EntityType == 7}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsCareerSummary" checked="true"/>
		            <span class="rs-pubcontent-label">Career Summary</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.EntityType == 6}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsBusinessDescription" checked="true"/>
		            <span class="rs-pubcontent-label">Business Description</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!ShowPath}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsMyPaths" checked="true"/>
		            <span class="rs-pubcontent-label">My Paths</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!HasSharedPaths}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsColleaguePaths" checked="true"/>
		            <span class="rs-pubcontent-label">Colleagues' Paths</span>
		        </apex:outputPanel>
	        </div>
	        <div class="feedback-info" style="border-top:none; padding-top:0px; padding-bottom:4px;">
	        	<div class="rs-modal-footer">
	        		<button type="button" data-dismiss="modal" id="_rsChatterShareBtn" class="btn btn-cds">Share</button>
	    		</div>
	    	</div>  
		</apex:form>
	</div>
</apex:outputPanel>
<apex:outputPanel rendered="{!IsMobile}">
	<div id="_relsChatterShareModal" class="modal hide sfCaseModal rsMobileCaseModal">
		<div class="modal-header-noBorder rs-modal-header">
        	<img style="position: absolute;" src="https://www.relsci.com/Content/Images/Logo-Feedback.png" border="0" alt="Logo"></img>
        	<h4 class="rsChatterShareTitle pull-left">
    			Share | {!PathService.PathDataResp.Header.Entity.DisplayName}
        	</h4>
        	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
		</div>
		<apex:form >
			<div class="feedback-info" style="border-top:0;padding: 0px 8px 10px 8px;">
		        <div class="modal-body rs-modal-body">
	                <span class="feedback-disabled">Select which content you would like to share to Chatter:</span>
	            </div>
	            <div class="rs-row-fluid">
	            	<input type="checkbox" id="_relSciHelpedCheckbox"/>
	            	<span class="label">RelSci helped me with this {!JSENCODE(qsType)}</span>
	            </div>
	            <div class="rs-row-fluid ui-widget">
	            	<textarea class="chatter-input-text-mobile" rows="2" cols="20"
	               		placeholder='Add "@person/group" to share with non-followers of this contact' id="_relsChatterShareWith"></textarea>
	               	<input class="hide" id="_relsChatterMentionIds"/>
	            </div>
	            <apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.EntityType == 7}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsCareerSummary" checked="true"/>
		            <span class="rs-pubcontent-label">Career Summary</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!PathService.PathDataResp.Header.Entity.EntityType == 6}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsBusinessDescription" checked="true"/>
		            <span class="rs-pubcontent-label">Business Description</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!ShowPath}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsMyPaths" checked="true"/>
		            <span class="rs-pubcontent-label">My Paths</span>
		        </apex:outputPanel>
		        <apex:outputPanel rendered="{!HasSharedPaths}" layout="block" styleClass="rs-pubcontent">
		            <input type="checkbox" id="_rsColleaguePaths" checked="true"/>
		            <span class="rs-pubcontent-label">Colleagues' Paths</span>
		        </apex:outputPanel>
	        </div>
	        <div class="feedback-info" style="border-top:none; padding-top:0px; padding-bottom:4px;">
	        	<div class="rs-modal-footer">
	        		<button type="button" data-dismiss="modal" id="_rsChatterShareBtn" class="btn btn-cds">Share</button>
	    		</div>
	    	</div>  
		</apex:form>
	</div>
</apex:outputPanel>

<apex:outputPanel rendered="{!!IsMobile}">
	<div id="_relDetailsCard" class="rsRelationshipDetails" style="display:none;"></div>
</apex:outputPanel>
<apex:outputPanel rendered="{!IsMobile}">
	<div id="_relDetailsCard" class="rsRelationshipDetailsMobile" style="display:none;"></div>
</apex:outputPanel>

<div id="_relDetailsLoadingCard" class="rsRelationshipDetails" style="display:none;"></div>
<div id="_relDetailsArrow" class="rsArrow" style="display:none;"></div>
<apex:outputPanel rendered="{!IsMobile}">
	<div id="_rsAddRemoveRelLoadingModal" class="modal hide rsMobileCaseModalCompact" style="z-index:1051;">
	    <div class="modal-header rs-modal-header">
	        <div class="pull-left">
	        	<img src="https://www.relsci.com/Content/Images/Logo-Feedback.png" border="0" alt="Logo"></img>
	        </div>
	        	<div class="pull-left">
					<apex:outputPanel rendered="{!!IKnowThem}">
						<h4 class="pull-left" style="margin-left:10px;">Adding Relationship</h4>
					</apex:outputPanel>
					<apex:outputPanel rendered="{!IKnowThem}">
						<h4 class="pull-left" style="margin-left:10px;">Removing Relationship</h4>
					</apex:outputPanel>
				</div>
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
	        	<div class="clear"></div>
	    </div>
		<div>
			<center>
				<img style="display:block; margin:0 auto; padding-top:10px;" src="https://static.relsci.com/Content/Crm/Images/ajax-loader.gif" border="0" />
			</center>
		</div>
	</div>
</apex:outputPanel>

<apex:outputPanel rendered="{!!IsMobile}">
	<div id="_rsAddRemoveRelLoadingModal" class="modal hide rsCaseModalCompact" style="z-index:1051;">
	    <div class="modal-header rs-modal-header">
	        <div class="pull-left">
	        	<img src="https://www.relsci.com/Content/Images/Logo-Feedback.png" border="0" alt="Logo"></img>
	        </div>
	        	<div class="pull-left">
					<apex:outputPanel rendered="{!!IKnowThem}">
						<h4 class="pull-left" style="margin-left:10px;">Adding Relationship</h4>
					</apex:outputPanel>
					<apex:outputPanel rendered="{!IKnowThem}">
						<h4 class="pull-left" style="margin-left:10px;">Removing Relationship</h4>
					</apex:outputPanel>
				</div>
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
	        	<div class="clear"></div>
	    </div>
		<div>
			<center>
				<img style="display:block; margin:0 auto; padding-top:10px;" src="https://static.relsci.com/Content/Crm/Images/ajax-loader.gif" border="0" />
			</center>
		</div>
	</div>
</apex:outputPanel>

<div id="_salesforceCaseModal" class="modal hide sfCaseModal" style="z-index:1051;">
    <div class="modal-header rs-modal-header">
        <div class="pull-left">
        	<img src="https://www.relsci.com/Content/Images/Logo-Feedback.png" border="0" alt="Logo"></img>
        </div>
        <h4 class="pull-left" style="margin-left:10px;">RELSCI SERVICES</h4>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
        <div class="clear"></div>
    </div>
    
	<div id="_salesforceCaseModal_isSubmitted" class="hide">
        <div class="modal-body rs-modal-body" style="color: #333333;">
            <div class="proxima-bold" style="text-align:center; font-size:18px; ">
            Thank you
            <br /><br />
            </div>
            <div style="text-align:center;">
                Your message has been submitted to one of our RelSci client support specialists. We appreciate your feedback and will be in touch with you soon to follow up.
                <br />
                <br />
                <img src="https://www.relsci.com/Content/Images/Envelope.png" border="0" alt="letter" />
            </div>
			<div class="feedback-info" style="border-top:none;padding-top:20px;">
        		<button class="btn btn-cds" style="float:right;" type="button" id="closeFeedbackModal" data-dismiss="modal">Close</button>
        	</div>            
        </div>

    </div>
    <div id="_salesforceCaseModal_notSubmitted">
        <div class="modal-body rs-modal-body" style="color:#000; font-size:14px; align:left;">
			<div class="feedback-info" style="border-top:0;padding: 0px 8px 10px 8px;">
            	<div class="row-fluid">
                	<span class="feedback-header">Please submit feedback, request a profile or submit data issues below</span>
            	</div>        
            </div>
            <div class="feedback-info">           
                <div class="row-fluid">
                    <span class="feedback-disabled">To: clientsupport@relsci.com</span>
                </div>
                <div class="row-fluid">
                    <span class="feedback-disabled" id="feedback-page">Page: </span>
                </div>
                <div class="row-fluid">
                    <span class="feedback-disabled" id="feedback-user">User: </span>
                </div>
              	<div class="row-fluid">
                    <div class="span4 rs-modal-textbox-label">
                        <span>Subject: </span>
                    	<span><input type="text" class="span15 feedback-input" value="Feedback | Relationship Science" id="_feedbackSubject" /></span>
                    </div>
                </div>
                <span>Description:</span>
                <textarea class="feedback-input-text" rows="2" cols="20"
                placeholder="How can we help you? Please see above for the type of services we can provide you." id="_feedbackDescription"></textarea>
            </div>            <div class="feedback-info" style="border-top:none; padding-top:0px; padding-bottom:4px;">
            	<div class="rs-modal-footer">
            		<input type="button" class="btn-cds" id="_salesforceCaseModal_submit" value="Submit"></input>
        		</div>
        	</div>  
          
        </div>
    </div>
</div>
</apex:outputPanel>
</apex:outputPanel>
	<div id="_rsModuleContent" class="rsModuleContent"></div>
<script>
sforce.connection.sessionId = "{!$Api.Session_ID}";
userId = "{!$User.Id}";
userName = "{!$User.Username}";
page = "{!URLFOR($Page.RelSciPath)}";

jQuery("#feedback-page").text("Page: " + page);
jQuery("#feedback-user").text("User: " + userName);

function reload() {
    document.location.reload();
}

jQuery("#_rsAddRemoveRelationship").click(function () {

	$("#_rsAddRemoveRelLoadingModal").modal({ show: true });

    jQuery.ajax({
		type:'post',
		cache:false,
		datatype:'json',
		url:"{!URLFOR($Page.RelSciPath)}",
		data: {
				action: 'addRemoveRel',
				entityId: '{!PathService.PathDataResp.Header.Entity.EntityId}',
				csrf: '{!JSENCODE(csrf)}'
				},
		success: function(e) {
			reload();
		}
		
		});	
});



jQuery("._rsConfirmMatch").click(function () {
	_showPossible = false;

	if({!IsMobile})
	{
		$('#_searchLink').hide();
	}

	showLoading();
	var entityId = $(this).data('entityid');
	var etype = $(this).data('entitytype');
	var baseurl = "{!URLFOR($Page.RelSciPath)}";
	if(baseurl[baseurl.length-1] == "/")
	{
 		baseurl = baseurl.substring(0,baseurl.length-2);
 	}

 	//append the query string since mobile adds additional navigation parameters
 	if({!!IsMobile})
 	{
 		baseurl += "?";
 	}
 	else
 	{
 		baseurl += "&";	
 	}

	jQuery.ajax({ 
		cache:false,
		url: baseurl+'accountId={!URLENCODE(UniqueId)}&sfType={!URLENCODE(qsType)}&confirmEntity='+entityId+'&type='+etype+'&csrf={!URLENCODE(csrf)}&IsMobile={!IsMobile}',
		type:'GET',
		success: function(d) {
		
			onLoad(false, entityId, ''); 
		}
	});
});

_showPossible = false;

jQuery("#_rsIncorrect").click(function () {

	if({!IsMobile})
	{
		$('#_rsIncorrect').hide();
	}

	showLoading();
	var baseurl = "{!URLFOR($Page.RelSciPath)}";
	if(baseurl[baseurl.length-1] == "/")
	{
 		baseurl = baseurl.substring(0,baseurl.length-2);
 	}

 	//append the query string since mobile adds additional navigation parameters
 	if({!!IsMobile})
 	{
 		baseurl += "?";
 	}
 	else
 	{
 		baseurl += "&";	
 	}

	jQuery.ajax({
		cache:false,
		url:baseurl+'unlinkEntity={!JSENCODE(UniqueId)}&sfType={!JSENCODE(qsType)}&csrf={!JSENCODE(csrf)}',
		type:'GET',
		success: function(d) {
			ShowPossible();
			_showPossible = true;
			
		}
	});
});
jQuery("#_rsIgnore").click(function ()
{
	
    jQuery.ajax({
		type:'post',
		cache:false,
		datatype:'json',
		url:"{!URLFOR($Page.RelSciPath)}",
		data: {
				action: 'ignoreEntity',
				sfId: '{!JSENCODE(UniqueId)}',
				sfType: '{!JSENCODE(qsType)}',
				csrf: '{!JSENCODE(csrf)}'
				},
		success: function(e) {
			_showPossible = false;
			ignoredEntity = true;
			$("#_rsIgnore").html('Item Ignored');
			SyncOrPath();
		}
		
		});	
});	

jQuery("#_rsEnableMatching").click(function()
{
    jQuery.ajax({
		type:'post',
		cache:false,
		datatype:'json',
		url:"{!URLFOR($Page.RelSciPath)}",
		data: {
				action: 'enableEntity',
				sfId: '{!JSENCODE(UniqueId)}',
				sfType: '{!JSENCODE(qsType)}',
				csrf: '{!JSENCODE(csrf)}'
				},
		success: function(e) {
			showLoading();
			ShowPossible();
			}
		});
});

jQuery("#pfRequest").on('click', ".rsRequestProfile",function()
{
	var sfo = PopulateSfObject();

    jQuery.ajax({
		type:'post',
		cache:false,
		datatype:'json',
		url:"{!URLFOR($Page.RelSciPath)}",
		data: {
				action: 'submitProfileRequest',
				sfType: '{!JSENCODE(qsType)}',
				sfId: '{!JSENCODE(UniqueId)}',
				sfobj: JSON.stringify(sfo),
				csrf: '{!JSENCODE(csrf)}'
			}
	});
	$(this).html('Request Sent');	
	$(this).attr('class', 'rsProfileRequested');
	$(this).attr('id', '_rsProfileRequested');	
});

jQuery("#_rsServices").click(function () { 
	$('#_salesforceCaseModal_isSubmitted').hide();
	$('#_salesforceCaseModal_notSubmitted').show();
	$("#_salesforceCaseModal").modal({ show: true });

});

jQuery("#_salesforceCaseModal_submit").click(function ()
{
	var rsSubj = $("#_feedbackSubject").val();
	var rsDesc = $("#_feedbackDescription").val();

	$("#_salesforceCaseModal_submit").attr('disabled', 'disabled');
	$("#_salesforceCaseModal_submit").attr('value', 'Sending...');

    jQuery.ajax({
	type:'post',
	cache:false,
	datatype:'json',
	url:"{!URLFOR($Page.RelSciPath)}",
	data: {
			action: 'relSciServicesSubmit',
			subj: rsSubj,
			desc: rsDesc,
			csrf: '{!JSENCODE(csrf)}'
			},
	success: function(e) {
		$('#_salesforceCaseModal_isSubmitted').show();
		$('#_salesforceCaseModal_notSubmitted').hide();
		$("#_salesforceCaseModal_submit").removeAttr('disabled');
		$("#_salesforceCaseModal_submit").attr('value', 'Submit');
	}			
	
	});
});

function split(val) {
	return val.split(/,\s*/);
}
function extractLast(term) {
	return split(term).pop();
}
function splitMent(val){
	return val.splitMent(/]\s*/);
}

jQuery("#_relsChatterShareWith").triggeredAutocomplete({
		appendTo: $("#_relsChatterShareModal"),
		hidden: "#_relsChatterMentionIds",
		minLength: 1,
		source: function(request, response) {

		var autoCompleteResult = [];
		
		response( $.ui.autocomplete.filter(
			jQuery.ajax({
				cache:false,
				url:"{!URLFOR($Page.RelSciChatter)}",
				data: {
					action: 'mentionAutoComplete',
					checkText: extractLast(request.term),
					csrf: '{!JSENCODE(csrf)}'
				},
				success: function(data) {
					var mentionsArray = JSON.parse(data.Mentions);
					var stuffsss = response;
					for(var i = 0; i < mentionsArray.length; i++)
					{
						autoCompleteResult.push(mentionsArray[i].MentionName);
					}
					response( $.map(mentionsArray, function(item){
						return {
							label: item.MentionName,
							value: item.MentionId
						}
					}));
				}
			}), extractLast(request.term)));
		},
		trigger:"@"
});

jQuery("#_rsShareButtonClick").click(function () {
	$('#_relsChatterShareModal').modal({ show: true });
});

jQuery("#_rsChatterShareBtn").click(function ()
{
	var chatterBody = $("#_relsChatterShareWith").val();
	var rsHelped = $("#_relSciHelpedCheckbox").prop('checked');
	var rsBusinessDesc = $("#_rsBusinessDescription").prop('checked');
	var rsMyPaths = $("#_rsMyPaths").prop('checked');
	var rsCareerSummary = $("#_rsCareerSummary").prop('checked');
	var rsColleaguePaths = $("#_rsColleaguePaths").prop('checked');

	var chatterShareWith = $("#_relsChatterMentionIds").val();
	var sharedHtml = $("#_rsBaseTitle").html() + '<br/>' + $("#_rsSubTitle").html() + '<br/><hr/>';

	if(rsBusinessDesc == true)
	{
		sharedHtml +=  $("#_rsBusinessDescriptionHtml").html();
	}
	if(rsCareerSummary == true)
	{
		if({!IsMobile} == true)
		{
			//add a line break after career summary for mobile
			sharedHtml += '<br/>' + $("#_rsCareerSummaryHtml").html();	
		}
		else
		{
			sharedHtml += $("#_rsCareerSummaryHtml").html();	
		}
		
	}
	if(rsMyPaths == true)
	{
		$(".rsNodeImgText").show();
		$(".rsMyTopPathsChatterTitle").show();
		if({!IsMobile})
		{
			$(".rsMobileImageBar").hide();
			$(".rsMobilePathRow").addClass("rsMobilePathCenterAlign");
			
		}
		sharedHtml += $("#_rsMyTopPaths").html() + "</br>";
		if({!IsMobile})
		{
			$(".rsMobileImageBar").show();
			$(".rsMobilePathRow").removeClass("rsMobilePathCenterAlign");
		}
		$(".rsMyTopPathsChatterTitle").hide();
		$(".rsNodeImgText").hide();
	}
	if(rsColleaguePaths == true)
	{
		$(".rsNodeImgText").show();
		$(".rsMyColleagueTopPathsChatterTitle").show();
		if({!IsMobile})
		{
			$(".rsMobileImageBar").hide();
			$(".rsMobilePathRow").addClass("rsMobilePathCenterAlign");
		}
		sharedHtml += "</br>" + $("#_rsColleagueTopPaths").html() + "</br>";
		if({!IsMobile})
		{
			$(".rsMobileImageBar").show();
			$(".rsMobilePathRow").removeClass("rsMobilePathCenterAlign");
		}
		$(".rsMyColleagueTopPathsChatterTitle").hide();
		$(".rsNodeImgText").hide();
	}

	$("#_rsModuleContent").html(sharedHtml);

	html2canvas($("#_rsModuleContent"),{
		onrendered: function (canvas) {
			var myImage = canvas.toDataURL("image/png");
			$("#_rsModuleContent").html('');
			jQuery.ajax({
				type:'post',
				cache:false,
				url:"{!URLFOR($Page.RelSciChatter)}",
				data: {
					imageBlob: myImage,
					user: userId,
					chatBody: chatterBody,
					chatMentions: chatterShareWith,
					relSciHelped: rsHelped,
					entityTitle: '{!JSENCODE(PathService.PathDataResp.Header.Entity.DisplayName)}',
					csrf: '{!JSENCODE(csrf)}',
					objectType: '{!JSENCODE(qsType)}'

				}
			});
		}
	});

});

jQuery('html').bind('click', function(e) {
	if(typeof dlg != 'undefined' && dlg.dialog('isOpen') && !jQuery(e.target).is('.ui-dialog, a') && !jQuery(e.target).is('.rsNodeImg, img') && !jQuery(e.target).closest('.ui-dialog').length)
	{
		dlg.dialog('close');
		arw.hide();	
	}
})

function showRelDetailsLoadingCard(node)
{
	rdlc = $("#_relDetailsLoadingCard").dialog({
				modal: false,
				autoOpen: false,
				resizable: false,
				position: {
					my: "center bottom-10",
					at: "center top",
					of: node,
					within: $("body")
				}
			});
	arw = $("#_relDetailsArrow");
	//don't show the arrow if we hit the top of the iFrame
	if(node.offset().top >= 165)
	{
		arw.show();
		arw.position({
			my: "center bottom-11",
			at: "center top",
			of: node,
			within: $("body")
		});
	}
	rdlc.html('<div class="rsCloseButton">X</div><center><img style="display:block; margin:0 auto; padding-top: 40px;" src="https://static.relsci.com/Content/Crm/Images/ajax-loader.gif" border="0" /></center>');

	$("div.rsCloseButton").click(function ()
	{
		forceRelsCardStop = true;
		if(typeof dlg != 'undefined')
		{
			dlg.dialog('close');
		}

		if(typeof rdlc != 'undefined')
		{
			rdlc.dialog('close');
		}
		if(typeof arw != 'undefined')
		{
			arw.hide();	
		}
		
	});
	rdlc.dialog("open");
	var zIndexCard = rdlc.zIndex();
	arw.css("z-index", zIndexCard+1);
	
}


jQuery("img.rsNodeImg").click(function () 
{
	if(typeof dlg != 'undefined')
	{
		dlg.dialog('close');
	}
	var node = $(this);
	var entityId = node.data("currententityid");
	var nextEntityId = node.data("nextentityid");
	var entityIsProp = node.data("currentisprop");
	var nextEntityIsProp = node.data("nextisprop");
	showRelDetailsLoadingCard(node);

	dlg = $("#_relDetailsCard").dialog({
		modal: false,
		autoOpen: false,
		resizable: false,
		maxWidth: 600,
		position: {
			my: "center bottom-10",
			at: "center top",
			of: node,
			within: $("body")
		}
	});
	dlg.html('<div class="rsCloseButton">X</div>');
	jQuery.ajax({
		type:'get',
		cache:false,
		datatype:'text',
		url:'{!URLFOR($Page.RelSciSyncAjax)}',
		data: {
			action: 'getRelsCard',
			entityid: entityId,
			nextentityid: nextEntityId,
			entityIsProp: entityIsProp,
			nextEntityIsProp: nextEntityIsProp,
			csrf: '{!JSENCODE(csrf)}'
				},
		success: function(data) {
			if(typeof forceRelsCardStop != 'undefined' && forceRelsCardStop == true)
			{
				forceRelsCardStop = false;
				dlg.html('');
			}
			else
			{
				if(typeof data.EntityCard == 'undefined')
				{
					dlg.html('<div class="rsCloseButton">X</div><table class="rsRelsCard"><tr class="rsRelsCard rsHeader no-top"><th colspan="3" class="rsRelsCard rsPadded no-top"><span>No connection details currently availible in salesforce for this relationship</span></th></tr></table>');	
				}
				else
				{
					dlg.html('<div class="rsCloseButton">X</div>' + data.EntityCard);
				}
				
				rdlc.dialog("close");
				dlg.dialog("open");
					$("div.rsCloseButton").click(function ()
					{
						if(typeof dlg != 'undefined')
						{
							dlg.dialog('close');
						}

						if(typeof rdlc != 'undefined')
						{
							rdlc.dialog('close');
						}
						if(typeof arw != 'undefined')
						{
							arw.hide();	
						}
						
					});

				forceRelsCardStop = false;
			}
			},
		error: function (e) {
			dlg.html('<div class="rsCloseButton">X</div><div class="rsError">An error occured when retrieving data from RelSci.  Please try again. If this error persists, please contact RelSci.</div>');
			rdlc.dialog("close");
			dlg.dialog("open");
			$("div.rsCloseButton").click(function ()
			{
				if(typeof dlg != 'undefined')
				{
					dlg.dialog('close');
				}

				if(typeof rdlc != 'undefined')
				{
					rdlc.dialog('close');
				}
				if(typeof arw != 'undefined')
				{
					arw.hide();	
				}
				
			});

		},
		timeout: 30000
	});


	
});

function setWidth(tableClass, nodeClass) {
	var maxWidth = 0;
	jQuery(tableClass+" "+nodeClass).each(function () {
		if(jQuery(this).width() > maxWidth) {
			maxWidth = jQuery(this).width();			
		}
	});
	
	jQuery(tableClass+" "+nodeClass).width(maxWidth);
}

jQuery(document).ready(function () {
/*	setWidth(".myTopPaths", ".rsNode");
	setWidth(".colleaguesTopPaths", ".rsNode");
	setWidth(".colleaguesTopPaths", ".rsShared");*/
	
	setWidth(".rsPossibleMatchCell", ".rsCell1");
	setWidth(".rsPossibleMatchCell", ".rsCell2");
	setWidth(".rsPossibleMatchCell", ".rsCell3");
	
	$("#closeFeedbackModal").click(function () {
            $('#_salesforceCaseModal').modal('hide');
        });

     
});
	
jQuery("#_rsEnableMatching").click(function () {
	if({!IsMobile})
	{
		$('#_rsEnableMatching').hide();
		$('#_rsEntityIgnoredBody').hide();
	}
})
    /*
        1. get type
        2. query for sf object
        3. sync if necessary
        4. 
    */
    
    $i = {};
    $i.Type = '{!JSENCODE(qsType)}';
    $i.SFId = '{!JSENCODE(UniqueId)}';
    
    ignoredEntity = false;

    function SyncOrPath()
    {
        var sfo = getSFObject(SyncOrPathCallback);
        var d = 'stuff';
        
    }
    
    function SyncOrPathCallback(sfo)
    { 
    	if(sfo.rels__MatchType__c == '-1')
    	{
    		ignoredEntity = true;
    	}
    
    	if(ignoredEntity == true)
    	{
    		onLoad(false, sfo.rels__EntityId__c, {});
    	}
    	else if(sfo.rels__EntityId__c != null && 
        	sfo.rels__EntityId__c.length > 0 && 
            sfo.rels__EntityId__c.indexOf(",") === -1) {
            //get paths
            onLoad(false, sfo.rels__EntityId__c, {});
            
            
        } else {
            //sync           
            var mc = GetMobileContactFromSFObject(sfo);
            
            onLoad(false, '', mc);
            
            
        }
    }
    
    
function GetMobileContactFromSFObject(SFobject)
{
	var o = {
		Id:'',
		Name:'',
		Company:'',
		Title: '',
		Email: [],
		Domains: [],
		City: [],
		State: [],
		Zip: [],
		TickerSymbol:'', 
		IsCompany:false
	};
		
		o.Id = SFobject.Id;
		if(SFobject.type == 'Opportunity')
		{
			
			if(SFobject.Account != null) 
			{
				o.Name = SFobject.Name;
				o.Company = SFobject.Account.Name;
				o.City.push(SFobject.Account.ShippingCity);
				o.State.push(SFobject.Account.ShippingState);
				o.Zip.push(SFobject.Account.ShippingPostalCode);
				o.Domains.push(SFobject.Account.Website);
				o.TickerSymbol = SFobject.Account.TickerSymbol;
			} else {
				o.Name = SFobject.Name;
				
			}
			
		} else if(SFobject.type =='Account') {
            
            if({!PersonAccountEnabled} == true)
            {
                o.IsCompany = false;
                o.Name = SFobject.Name;
            }
            else
            {
                o.IsCompany = true;
                o.Company = SFobject.Name;
            }

			o.Id = SFobject.Id;
			o.City.push(SFobject.ShippingCity);
			o.State.push(SFobject.ShippingState);
			o.Zip.push(SFobject.ShippingPostalCode);
			o.TickerSymbol = SFobject.TickerSymbol;
			if(SFobject.Website != null)
				o.Domains.push(SFobject.Website);
			
			
		} else if(SFobject.type == 'Contact') {
		
			o.Name = SFobject.Name;
			o.Title = SFobject.Title;
			if(SFobject.Account != null)
				o.Company = SFobject.Account.Name;
			if(SFobject.Email != null)				
				o.Email.push(StripLocalEmail(SFobject.Email));
			if(SFobject.MailingCity != null)
				o.City.push(SFobject.MailingCity);
			if(SFobject.MailingState != null)
				o.State.push(SFobject.MailingState);					
			
			
		} else if(SFobject.type == 'Lead')	{
		
		
			o.Name = SFobject.Name;
			o.Title = SFobject.Title;
			o.Company = SFobject.Company;
			o.Domains.push(SFobject.Website);	
			if(SFobject.Email != null)		
				o.Email.push(StripLocalEmail(SFobject.Email));
			
			
		}
		
		return o;
}

function StripLocalEmail(email)
{
	var atindex = email.indexOf('@');
	if(atindex !== -1)
	{
		return  email.substring(atindex, email.length);
	}
	return '';
}
    
    function getSFObject(cb)
    {
        if($i.Type == 'Contact') {
            
            query = "select {!ContactAccessibility} rels__EntityId__c, rels__MatchType__c from Contact where Id = \'"+$i.SFId+"\' ";
                             
        }
        else if($i.Type == 'Account') {

            query = "select {!AccountAccessibility} rels__EntityId__c, rels__MatchType__c from Account where Id = \'"+$i.SFId+"\' ";
                         
        }
        else if($i.Type == 'Lead') {
            query = "select {!LeadAccessibility} rels__EntityId__c, rels__MatchType__c  from Lead where IsConverted = false and Id = \'"+$i.SFId+"\' ";
        } 
        else if ($i.Type == 'Opportunity') {
            query = "select {!OpportunityAccessibility} rels__EntityId__c from Opportunity where Id = \'"+$i.SFId+"\' ";
        } 
        else if($i.Type.length > 0) {
            //custom object logic
           if(!_showPossible && !isNullOrWhiteSpace('{!JSENCODE(qsEntityId)}'))
           {
           		//matched
           		var mc = {
           			Name : '{!JSENCODE(inMobileContact.Name)}',
           			Title : '{!JSENCODE(inMobileContact.Title)}',
           			Company : '{!JSENCODE(inMobileContact.Company)}',
           			ExternalId : '{!JSENCODE(UniqueId)}',
           			City : {!(inMobileContact.GetCity)}, 
           			State : {!(inMobileContact.GetState)},
           			Email : {!(inMobileContact.GetEmail)},
           			Domain : {!(inMobileContact.GetDomains)},
           			TickerSymbol : '{!JSENCODE(inMobileContact.TickerSymbol)}'
           		};
            	
            	onLoad(false, '{!JSENCODE(qsEntityId)}', mc);
            	return;
           } 
           else 
           {
           		//need to match           		
           		var mc = {
           			Name : '{!JSENCODE(inMobileContact.Name)}',
           			Title : '{!JSENCODE(inMobileContact.Title)}',
           			Company : '{!JSENCODE(inMobileContact.Company)}',
           			ExternalId : '{!JSENCODE(UniqueId)}',
           			City : {!(inMobileContact.GetCity)},
           			State : {!(inMobileContact.GetState)},
           			Email : {!(inMobileContact.GetEmail)},
           			Domain : {!(inMobileContact.GetDomains)},
           			TickerSymbol : '{!JSENCODE(inMobileContact.TickerSymbol)}'
           			
           		};
            	if(cb.toString().indexOf('ShowPossible') !== -1)
            	{
            		onLoad(true, '', mc);
            	}else {
            		onLoad(false, '', mc);
            	}
            	return;
           }
            
            
        } else {
            //sync           
            
           return;
        }           
        RunQuery(query, cb);
        
    }
    
    function PopulateSfObject()
    {
        if($i.Type == 'Contact') {
            
            query = "select {!ContactAccessibility} rels__EntityId__c from Contact where Id = \'"+$i.SFId+"\' ";
                             
        }
        else if($i.Type == 'Account') {

            query = "select {!AccountAccessibility} rels__EntityId__c from Account where Id = \'"+$i.SFId+"\' ";
                         
        }
        else if($i.Type == 'Lead') {
            query = "select {!LeadAccessibility} rels__EntityId__c from Lead where IsConverted = false and Id = \'"+$i.SFId+"\' ";
        } 
        else if ($i.Type == 'Opportunity') {
            query = "select {!OpportunityAccessibility} rels__EntityId__c from Opportunity where Id = \'"+$i.SFId+"\' ";
        } 
        else if($i.Type.length > 0) {
            //custom object logic
           if(!_showPossible && !isNullOrWhiteSpace('{!JSENCODE(qsEntityId)}'))
           {
           		//matched
           		var mc = {
           			Name : '{!JSENCODE(inMobileContact.Name)}',
           			Title : '{!JSENCODE(inMobileContact.Title)}',
           			Company : '{!JSENCODE(inMobileContact.Company)}',
           			ExternalId : '{!JSENCODE(UniqueId)}',
           			City : {!(inMobileContact.GetCity)}, 
           			State : {!(inMobileContact.GetState)},
           			Email : {!(inMobileContact.GetEmail)},
           			Domain : {!(inMobileContact.GetDomains)},
           			TickerSymbol : '{!JSENCODE(inMobileContact.TickerSymbol)}'
           		};
            	
            	onLoad(false, '{!JSENCODE(qsEntityId)}', mc);
            	return;
           } 
           else 
           {
           		//need to match           		
           		var mc = {
           			Name : '{!JSENCODE(inMobileContact.Name)}',
           			Title : '{!JSENCODE(inMobileContact.Title)}',
           			Company : '{!JSENCODE(inMobileContact.Company)}',
           			ExternalId : '{!JSENCODE(UniqueId)}',
           			City : {!(inMobileContact.GetCity)},
           			State : {!(inMobileContact.GetState)},
           			Email : {!(inMobileContact.GetEmail)},
           			Domain : {!(inMobileContact.GetDomains)},
           			TickerSymbol : '{!JSENCODE(inMobileContact.TickerSymbol)}'
           			
           		};
            	if(cb.toString().indexOf('ShowPossible') !== -1)
            	{
            		onLoad(true, '', mc);
            	}else {
            		onLoad(false, '', mc);
            	}
            	return mc;
           }
            
            
        } else {
            //sync           
            
           return;
        } 

    	var q = sforce.connection.query(query);
    	return q.records;
    }
    
        
    function RunQuery(strQuery, callback)
    {    
    	
        var resultQuery = sforce.connection.query(strQuery, function (results) {
        	
        	var records = results.getArray("records");               
            
            if(records.length == 1)
	        {
	            callback(records[0]);
	        }
             
            
        });         
    }
        
    
    
    
    function showLoading(){
        $("#__rsContent").html('<center><img style="display:block; margin:0 auto;" src="https://static.relsci.com/Content/Crm/Images/ajax-loader.gif" border="0" /></center>');
    }
    
    function ShowPossible() {
    	_showPossible = true;
     	var sfo = getSFObject(ShowPossibleCallback);
       
    }

    function ShowPossibleCallback(sfo)
    {
    	if(sfo.rels__MatchType__c == '-1')
    	{
    		var stuff = sfo.rels__MatchType__c;
    	}
     	var mc = GetMobileContactFromSFObject(sfo);
        onLoad(true, '', mc);
    }
    
    function isNullOrWhiteSpace(str){
    	return str === null || str.match(/^ *$/) !== null;
	}
	
	
    
    function onLoad(showPossible, matchedEntityId, mobileContacts) {
        var baseurl = "{!URLFOR($Page.RelSciPathAjax)}"; 
        if(baseurl[baseurl.length-1] == "/")
        {
            baseurl = baseurl.substring(0,baseurl.length-2);
        }
        
		//append the query string since mobile adds additional navigation parameters
	 	if({!!IsMobile})
	 	{
	 		baseurl += "?";
	 	}
	 	else
	 	{
	 		baseurl += "&";
	 	}

	 	// revert to ajax - prevented hoverlinks loading
		
		// location.href = baseurl += $.param({                     
  //                  UniqueId: '{!JSENCODE(UniqueId)}',
  //                  EntityId : matchedEntityId,
  //                  type: '{!JSENCODE(qsType)}',
  //                  showPossible : showPossible,
  //                  csrf : '{!JSENCODE(csrf)}',
  //                  mobilecontactjson : JSON.stringify(mobileContacts),
  //                  ignoredEntity : ignoredEntity,
  //                  IsMobile: '{!IsMobile}'
                   
  //              });
	    
       
        jQuery.ajax({
            url: baseurl,
            cache:false,
            type: 'post',
            data: {                     
                    UniqueId: '{!JSENCODE(UniqueId)}',
                    EntityId : matchedEntityId,
                    type: '{!JSENCODE(qsType)}',
                    showPossible : showPossible,
                    csrf : '{!JSENCODE(csrf)}',
                    mobilecontactjson : JSON.stringify(mobileContacts),
                    ignoredEntity : ignoredEntity,
                    IsMobile: '{!IsMobile}',
                },
                success: function(data) {     
                    if(data.indexOf("window.parent.location.replace") !== -1)
                              
                        $("#__rsContent").html(data);
                     
                },          
            });
           
            
    }
    if (!('indexOf' in Array.prototype)) {
        Array.prototype.indexOf= function(find, i /*opt*/) {
            if (i===undefined) i= 0;
            if (i<0) i+= this.length;
            if (i<0) i= 0;
            for (var n= this.length; i<n; i++)
                if (i in this && this[i]===find)
                    return i;
            return -1;
        };
    }
    
    
sforce.Transport = function(url) {
    this.url = url;
    this.connection = null;

    this.newConnection = function() {
        try {
            this.connection = new ActiveXObject('Msxml2.XMLHTTP');
        } catch(e) {
            try {
                this.connection = new ActiveXObject('Microsoft.XMLHTTP');
            } catch(e) {
                this.connection = new XMLHttpRequest();
            }
        }

        return this.connection;
    };
    
    this.send = function (envelope, callback, async, timeout) {
        this.newConnection();
        if (async) {
            this.connection.onreadystatechange = this.httpConnectionCallback;
        }
        var holder = new sforce.internal.ConnectionHolder(this.connection, callback);
        sforce.internal._connections.push(holder);
        this.connection.open("POST", this.url, async);
        this.connection.setRequestHeader("Content-Type", "text/xml; charset=UTF-8");
        this.connection.setRequestHeader("SOAPAction", "\"\"");
        this.connection.setRequestHeader("Accept", "text/xml");
        this.connection.setRequestHeader("User-Agent", "SFAJAX 1.0");
        this.connection.send(envelope);
        if (async && typeof(timeout) !== "undefined") {
            this.setTimeoutOn(holder, timeout);
        }
        if (!async) {
            this.httpConnectionCallback();
        }
    };
 
    this.setTimeoutOn = function (holder, timeout) {
        function abortConnection() {
            if (holder.connection.readyState !== 4) {
                holder.timedout = true;
                holder.connection.abort();
            }
        }
        setTimeout(abortConnection, timeout);
    };

    this.httpConnectionCallback = function () {

        for (var i = 0; i < sforce.internal._connections.length; i++) {
            var holder = sforce.internal._connections[i];
            if (holder !== null) {
                if (holder.timedout) {
                    sforce.internal._connections[i] = null;
                    sforce.internal._connections.slice(i,1);
                    holder.callback.httpCallback("Remote invocation timed out", false);
                } else  if (holder.connection.readyState == 4) {
                    sforce.internal._connections[i] = null;
                    sforce.internal._connections.slice(i,1);
                    var success = holder.connection.status == 200;
                    if (sforce.debug.trace) {
                        sforce.debug.log("Response : status - " + holder.connection.status);
                        sforce.debug.logXml(holder.connection.responseText);
                    }
                    if (sforce.debug.apexTrace) {
                        sforce.debug.logApex(holder.connection.responseText);
                    }
                    if (holder.connection.responseXML && holder.connection.responseXML.documentElement) {
                        holder.callback.httpCallback(holder.connection.responseXML.documentElement, success);
                    } else {
                        holder.callback.httpCallback("Remote invocation failed, due to: " + holder.connection.responseText +
                                                     " status code: ", holder.connection.status);
                    }
                }
            }
        }
    };
};

jQuery("#_syncModalRunning").show();      
</script>

</apex:page>