<apex:page standardController="Opportunity" extensions="SL_PricingTableInlineVF" docType="html-5.0" id="pageId">
    <apex:form id="formId">
    <apex:pageMessages id="showMessage"/>
    <apex:actionFunction name="rerenderOpportunity" action="{!refreshOpportunity}" rerender="oppTable, pgrid1, pgrid2,showMessage" status="loading" 
            onComplete="rerenderComponent();"/>
	<apex:outputPanel id="dummyOp"></apex:outputPanel>
    <script>
            function updateOpportunity(data)
            {
               var priceType = document.getElementById('{!$Component.pageId:formId:PTOil}') == null ? document.getElementById('{!$Component.pageId:formId:PTPropane}').value : document.getElementById('{!$Component.pageId:formId:PTOil}').value;
               Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.SL_PricingTableInlineVF.updateOpportunityRemote}','{!strOpportunityId}',data,priceType,handleResult);
               function handleResult(result,event)
               {
               		if(result === 'success')
               		{
               			rerenderOpportunity();
               			refreshParent();
               		}
               		else
               		{
               			alert(result);
               		}
               }
            }
            function rerenderTable()
            {
                rerenderTable1();
            }
            
            function refreshParentForCeiling(checkboxId)
            {
            	if(document.getElementById(checkboxId).checked)
            		window.parent.location.href = '/'+'{!strOpportunityId}';
            }
            
            function refreshParent()
            {            	
            	if((document.getElementById('{!$Component.pageId:formId:OCiOil}')==null && document.getElementById('{!$Component.pageId:formId:overrideCeilingLimitOil}')==null) || (document.getElementById('{!$Component.pageId:formId:OCiOil}').value!='' &&  document.getElementById('{!$Component.pageId:formId:overrideCeilingLimitOil}').value!=''))
            		window.parent.location.href = '/'+'{!strOpportunityId}';
            }
    </script>

    <style>
    
        label.labelCol
        {
            text-align: right;
            display:inline-block;
            width: 130px;
        }
        .opOil .col1 label.labelCol
        {
            width: 100px;
        }
        td.col4 label.labelCol
        {
            text-align: right;
            display:inline-block;
            width: 80px;
        }
        td.col4 input
        {
           
            width: 130px;
        }
        
        
        td.col5 label.labelCol
        {
            text-align: right;
            display:inline-block;
            width: 80px;
        }
        td.col6 label.labelCol
        {
            text-align: right;
            display:inline-block;
            width: 80px;
        }
        
        .dataCol
        {
            margin-left: 3px;
            margin-left: 5px;
        }
        .col1
        {
            padding-left:0px;
            margin-left:0px;
        }
        span.opOil .col3
        {
            width: 40%
        }
        .dataTable th:first-child
        {
        width: 100px !important;
        }
    </style>

    
    <apex:actionFunction name="rerenderTable1" action="{!updateOpportunity}" rerender="oppTable,dtTable,showMessage" status="loading"/>
    
    <apex:actionFunction name="rerenderComponent" action="{!dummy}" rerender="dtTable" status="loading"/>
    <apex:actionFunction name="refreshParentForPricingAF" action="{!updateOpportunity}" rerender="opOil, pgrid2, pgrid1,dtTable,showMessage" status="loading" onComplete="refreshParent();"/>
       
       <apex:outputPanel id="oppTable">
        <apex:outputPanel rendered="{!strfieldSetName == 'Oil_Rec_Fieldset'}">
            <apex:outputPanel styleClass="opOil">
                <apex:panelGrid columns="{!If(isCeiling == true, 4, if(oppty.Pricing_Type__c == 'Ceiling with fee',5,3))}" 
                            columnClasses="{!If(isCeiling == true, 'col4, col5, col6, col6',If(oppty.Pricing_Type__c == 'Ceiling with fee', 'col4, col5, col6, col6, col6', 'col1, col2, col3'))}"
                            cellpadding="2" cellspacing="2" width="100%" id="pgrid2">
                            
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol"  value="Price Type" for="PT" style="font-weight:bold; "/>
                        <apex:inputText styleClass="dataCol"  disabled="true" label="" Id="PTOil" value="{!oppty.Pricing_Type__c}"/>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee'), true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Ceiling Initial" for="CiOil" style="font-weight:bold; "/>
                        <apex:outputPanel layout="none" styleClass="dataCol">
                            <input type="text" disabled="true" value="{!oppty.Ceiling_Initial__c}" style="width:100px;"/>
                        </apex:outputPanel>
                    </apex:outputPanel> 
                    
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee', oppty.Pricing_Type__c == 'Variable'), false, true)}">
                        <apex:outputLabel styleClass="labelCol"  value="Fixed Price" for="FP1Oil" style="font-weight:bold; "/>
                        <input id="FP1" type="text" name="FP1Oil"  styleClass="dataCol"  disabled="true" style="min-width: 100px;" label=""  value="{!oppty.Fixed_Price__c}"/>
                    </apex:outputPanel>
                    
                    
                   
                    <apex:outputPanel rendered="{!If( oppty.Pricing_Type__c == 'Variable', true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Variable" for="Variable" style="font-weight:bold; " />
                        <apex:outputPanel layout="none" styleClass="dataCol" >
                            <input type="text" disabled="true" value="{!oppty.Variable__c}"/>
                        </apex:outputPanel>
                    </apex:outputPanel> 
                    
                  
                    
                   
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee'), true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Ceiling Limit" for="ceilingLimitOil" style="font-weight:bold; "/>
                                
                        <apex:outputPanel layout="none" styleClass="dataCol">
                            <input type="text" disabled="true" value="{!oppty.Ceiling_Limit__c}" style="width:100px;"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                    
                   
                    
                    <apex:outputPanel rendered="{!If(oppty.Pricing_Type__c == 'Ceiling with fee',true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Ceiling Fee" for="CeilingFee" style="font-weight:bold; "/>
                        
                        <apex:outputPanel layout="none" styleClass="dataCol">
                            <input type="text" disabled="true" value="{!oppty.Ceiling_Fee__c}" style="width:40px;"/>
                        </apex:outputPanel>
                    </apex:outputPanel>             
                   
                   
				 	
				 	<apex:outputPanel id="blankcol" rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee', oppty.Pricing_Type__c == 'Variable'), false, true)}">
                    	<apex:outputLabel styleClass="labelCol"  value="Override" style="font-weight:bold;" for="enableOverrideFieldsForFixed"/>
                    	<apex:inputCheckbox styleClass="dataCol"  id="enableOverrideFieldsForFixed"  value="{!oppty.Enable_Override_Fields__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
					
					<apex:outputPanel rendered="{!If(oppty.Pricing_Type__c == 'Variable', true, false)}">
                    	<apex:outputLabel styleClass="labelCol"  value="Override" style="font-weight:bold;" for="enableOverrideFieldsForVariable"/>
                    	<apex:inputCheckbox styleClass="dataCol"  id="enableOverrideFieldsForVariable"  value="{!oppty.Enable_Override_Fields__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
					
					 <apex:outputPanel rendered="{!If(isCeiling == true, true, false)}">
                  		<apex:outputLabel styleClass="labelCol"  value="Override" style="font-weight:bold;" for="enableOverrideFieldsForCeiling"/>
                   		<apex:inputCheckbox styleClass="dataCol"  id="enableOverrideFieldsForCeiling"  value="{!oppty.Enable_Override_Fields__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!If(oppty.Pricing_Type__c == 'Ceiling with fee', true, false)}">
                  		<apex:outputLabel styleClass="labelCol"  value="Override" style="font-weight:bold;" for="enableOverrideFieldsForCeilingwithfee"/>
                   		<apex:inputCheckbox styleClass="dataCol"  id="enableOverrideFieldsForCeilingwithfee"  value="{!oppty.Enable_Override_Fields__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
				 	
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol"  value="Override Reason" for="OR" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  Id="OROil" value="{!oppty.Override_Reason__c}" label="" rendered="{!If(oppty.Enable_Override_Fields__c == true,true, false)}" onchange="rerenderTable();" />
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(oppty.Enable_Override_Fields__c == false, true, false)}">
                            <input type="text" disabled="true" style="width: 190px;" value="{!oppty.Override_Reason__c}"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
        <!--            Ceiling Initial -->
                    
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee'), true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Override Ceiling Initial" for="OCiOil" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  Id="OCiOil" value="{!oppty.Override_Ceiling_Initial__c}" label="" onchange="refreshParentForPricingAF();" 
                            rendered="{!If(AND(oppty.Enable_Override_Fields__c == true, oppty.Override_Reason__c != null, oppty.Override_Reason__c != ''  ),true, false)}"/>
                            
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(OR(oppty.Enable_Override_Fields__c != true, oppty.Override_Reason__c == null, oppty.Override_Reason__c == '' ), true,false)}">
                            <input type="text" disabled="true" value="{!oppty.Override_Ceiling_Initial__c}"/>
                        </apex:outputPanel>
                    </apex:outputPanel> 
                    
        <!--            End: Ceiling Initial     -->
        
        <!--             Ceiling Limit -->
                    
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee'), true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Override Ceiling Limit" for="overrideceilingLimit" style="font-weight:bold; "/>
                                
                        <apex:inputField styleClass="dataCol"  label="" Id="overrideCeilingLimitOil" value="{!oppty.Override_Ceiling_Limit__c}" onchange="refreshParentForPricingAF();" 
                            rendered="{!If(AND(oppty.Enable_Override_Fields__c == true, oppty.Override_Reason__c != null, oppty.Override_Reason__c != ''  ),true, false)}"/>
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(OR(oppty.Enable_Override_Fields__c != true, oppty.Override_Reason__c == null, oppty.Override_Reason__c == '' ), true,false)}">
                            <input type="text" disabled="true" value="{!oppty.Override_Ceiling_Limit__c}"/>
                        </apex:outputPanel>
                        
                    </apex:outputPanel>
        <!--        End: Ceiling Limit   -->
                    <apex:outputPanel rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee', oppty.Pricing_Type__c == 'Variable'), false, true)}">
                        <apex:outputLabel styleClass="labelCol"  value="Override Fixed Price" for="overFixedPriceOil" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  label="" Id="overFixedPriceOil" value="{!oppty.Override_Fixed_Price__c}" onchange="refreshParentForPricingAF();" 
                            rendered="{!If(AND(oppty.Enable_Override_Fields__c == true, oppty.Override_Reason__c != null, oppty.Override_Reason__c != ''  ),true, false)}"/>
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(OR(oppty.Enable_Override_Fields__c != true, oppty.Override_Reason__c == null, oppty.Override_Reason__c == '' ), true,false)}">
                            <input type="text" disabled="true" value="{!oppty.Override_Fixed_Price__c}"/>
                        </apex:outputPanel>
                        
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!oppty.Pricing_Type__c == 'Ceiling with fee'}">
				 		
				 	</apex:outputPanel>
                    
                    <!--                Variable -->
                    <apex:outputPanel rendered="{!If( oppty.Pricing_Type__c == 'Variable', true, false)}">
                        <apex:outputLabel styleClass="labelCol"  value="Override Variable" for="OverrideVariable" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  Id="OverrideVariableOil" value="{!oppty.Override_Variable__c}" label="" onchange="refreshParentForPricingAF();" 
                            rendered="{!If(AND(oppty.Enable_Override_Fields__c == true, oppty.Override_Reason__c != null, oppty.Override_Reason__c != ''  ),true, false)}"/>
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(OR(oppty.Enable_Override_Fields__c != true, oppty.Override_Reason__c == null, oppty.Override_Reason__c == '' ), true,false)}">
                            <input type="text" disabled="true" value="{!oppty.Override_Variable__c}"/>
                        </apex:outputPanel>
                    </apex:outputPanel> 
                        
                    
                    
        <!--            End Variable -->
        			<apex:outputPanel id="saveCheckbox" rendered="{!If(isCeiling == true || oppty.Pricing_Type__c == 'Ceiling with fee', true, false)}">
						<apex:outputLabel styleClass="labelCol" id="overrideLabel" value="Submit" for="saveCheckboxflag" style="font-weight:bold; "/>
						<apex:inputCheckbox styleClass="dataCol"  id="saveCheckboxflag" onChange="refreshParentForCeiling('{!$Component.saveCheckboxflag}');"/>
				 	</apex:outputPanel>
				 	
				 	<apex:outputPanel rendered="{!isCeiling || oppty.Pricing_Type__c == 'Ceiling with fee'}">
				 		
				 	</apex:outputPanel>
				 	<apex:outputPanel rendered="{!isCeiling || oppty.Pricing_Type__c == 'Ceiling with fee'}">
				 		
				 	</apex:outputPanel>
				 	<apex:outputPanel rendered="{!isCeiling || oppty.Pricing_Type__c == 'Ceiling with fee'}">
				 		
				 	</apex:outputPanel>
				 	
				 	<apex:outputPanel rendered="{!oppty.Pricing_Type__c == 'Ceiling with fee'}">
				 		
				 	</apex:outputPanel>
                    
                    <apex:outputPanel >
						<apex:outputLabel styleClass="labelCol" id="overriddenLabel" value="Overridden" for="overriddencheckboxflag" style="font-weight:bold; "/>
						<apex:inputCheckbox styleClass="dataCol"  id="overriddencheckboxflag" value="{!oppty.Override__c}" disabled="true"/>
				 	</apex:outputPanel>
				 	
                </apex:panelGrid>
            </apex:outputPanel>
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!if(strfieldSetName == 'Propane_Rec_Fieldset', true, false)}">
            <apex:outputPanel styleClass="opOil">
                <apex:panelGrid columns="4" 
                            cellpadding="2" cellspacing="2" width="100%" id="pgrid1">
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol"  value="Price Type" for="PT" style="font-weight:bold; "/>
                        <apex:inputText styleClass="dataCol"  disabled="true" label="" Id="PTPropane" value="{!oppty.Pricing_Type__c}"/>
                    </apex:outputPanel>
                    
                    <apex:outputPanel >
<!--                     rendered="{!If(OR(isCeiling == true, oppty.Pricing_Type__c == 'Ceiling with fee', oppty.Pricing_Type__c == 'Variable'), false, true)}"> -->
                        <apex:outputLabel styleClass="labelCol"  value="Price" for="FP1Propane" style="font-weight:bold; "/>
                        <input id="FP1" type="text" name="FP1Propane"  styleClass="dataCol"  disabled="true" style="min-width: 100px;" label=""  value="{!oppty.Fixed_Price__c}" />
                    </apex:outputPanel>
<!--                     <apex:outputPanel id="blankcolPropane"> -->
<!--                     </apex:outputPanel> -->
                    
                    
                    <apex:outputPanel >
	                    <apex:outputLabel styleClass="labelCol"  value="Customer Owned?" for="CO" style="font-weight:bold; "/>
	                    <apex:inputField styleClass="dataCol" label="" Id="CO" value="{!oppty.Customer_Owned__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
                                    
                    
                    <apex:outputPanel >
                    	<apex:outputLabel styleClass="labelCol"  value="Override" style="font-weight:bold;" for="enableOverrideFieldsForPropane"/>
                    	<apex:inputCheckbox styleClass="dataCol"  id="enableOverrideFieldsForPropane"  value="{!oppty.Enable_Override_Fields__c}" onchange="rerenderTable();"/>
                    </apex:outputPanel>
                    
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol"  value="Override Reason" for="OR" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  Id="ORPropane" value="{!oppty.Override_Reason__c}" label="" rendered="{!If(oppty.Enable_Override_Fields__c == true,true, false)}" onchange="rerenderTable();" />
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(oppty.Enable_Override_Fields__c == false, true, false)}">
                            <input type="text" disabled="true" style="width: 180px;" value="{!oppty.Override_Reason__c}"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
        
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol"  value="Override Price" for="overFixedPricePropane" style="font-weight:bold; "/>
                        <apex:inputField styleClass="dataCol"  label="" Id="overFixedPricePropane" value="{!oppty.Override_Fixed_Price__c}" onchange="refreshParentForPricingAF();" 
                            rendered="{!If(AND(oppty.Enable_Override_Fields__c == true, oppty.Override_Reason__c != null, oppty.Override_Reason__c != ''  ),true, false)}"/>
                        
                        <apex:outputPanel layout="none" styleClass="dataCol" rendered="{!If(OR(oppty.Enable_Override_Fields__c != true, oppty.Override_Reason__c == null, oppty.Override_Reason__c == '' ), true,false)}">
                            <input type="text" disabled="true" value="{!oppty.Override_Fixed_Price__c}"/>
                        </apex:outputPanel>
                        
                    </apex:outputPanel>
                    
                    
                    <apex:outputPanel >
                        <apex:outputLabel styleClass="labelCol" id="overridePropane" value="Overridden" for="overrideCheckboxPropane" style="font-weight:bold; "/>
                        <apex:inputCheckbox styleClass="dataCol"  id="overrideCheckboxPropane"  value="{!oppty.Override__c}" disabled="true"/>
                    </apex:outputPanel>
                    
                    <apex:outputPanel ></apex:outputPanel>
                       
                </apex:panelGrid>
            </apex:outputPanel>
        </apex:outputPanel>
        
    </apex:outputPanel>
    <apex:outputPanel id="dtTable">
    <c:SL_DataTable sObjectName="{!strsObjectName}" fieldSetName="{!strfieldSetName}" sobjectId="{!strOpportunityId}" filter="{!strfilter}" 
    divisionSB="{!oppty.ZL_Database__c}" division="{!strDivision}" divisiongroup="{!strDivisionGroup}"
    priceType="{!oppty.Pricing_Type__c}" sublevel="{!oppty.Sub_Level__c}" tankType="{!strTankType}" customerowned="{!strCustomerOwned}"/>
    </apex:outputPanel>
    <apex:actionstatus id="loading" startText="Loading...">
            <apex:facet name="start">
                <div id="salesforceSource_blurybackground" style="position: absolute; z-index: 9998;left: 1px; top: 1px; width: 99.9%; height: 100%; text-align: center; vertical-align: middle; background-color: #dcdcdc; opacity: 0.5; filter: alpha(opacity = 50)"/>
                <div id="ManageMembersViewport_loading" class="waitingSearchDiv" style="z-index: 9999;width: 99.9%; height: 80%; display: '';">
                    <div style="width: 144px; vertical-align: middle;padding:20px; " class="waitingHolder">
                         <img class="waitingImage" src="/img/loading.gif" />
                         <span class="waitingDescription">Loading......</span>
                    </div>
                </div>
            </apex:facet>
            <apex:facet name="stop" />
        </apex:actionstatus>
    </apex:form>
    
</apex:page>