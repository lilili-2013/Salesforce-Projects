<apex:page standardController="Account" extensions="SL_CustomActivity_Controller" tabStyle="Opportunity" standardStylesheets="true">
    <apex:stylesheet value="{!URLFOR($Resource.SL_InlineProjectTeams, 'styles/jquery.dataTables.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.SL_InlineProjectTeams, 'styles/sl-bootstrap.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/sl-bootstrap.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.dataTables.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/dataTables.bootstrap.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.floatThead.min.js')}"/>
    
    <apex:form id="formId">
        <style>
            .floatThead-floatContainer{ 
                background-color:white;
            }
            form{
                width:98%;
            }
            #sl-body{
                font-size:1.65em;
            }
            table.dataTable thead .sorting_asc {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_asc.png')}) no-repeat center left;
            }
            table.dataTable thead .sorting_desc {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_desc.png')}) no-repeat center left;
            }
            table.dataTable thead .sorting {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_both.png')}) no-repeat center left;
            }
            
            #activityTable_wrapper{
                height:250px!important;
                overflow-y:auto!important;
                overflow-x: hidden!important;
            }
            
           /* #activityTable {
                   overflow:auto!important;
                   height:250px;
            }*/
            /*.dataTables_scrollHeadInner {
                max-height:14px!important;
            }
            
            .dataTables_scrollBody {
                max-height:267px!important;
            }*/
        </style>
        <script>
            function redirectToNew(actionType)
            {
                var navigateURL = (actionType == 'newTask') ? '/00T/e?tsk3_mlktp=001&tsk3={!Account.Name}&what_id={!Account.Id}&retURL={!Account.Id}'
                                  : (actionType == 'newEvent') ? '/00U/e?evt3_mlktp=001&evt3={!Account.Name}&what_id={!Account.Id}&retURL={!Account.Id}'
                                  : '/{!Account.Id}';
                
                if((typeof sforce != 'undefined') && (sforce != null)) 
                    sforce.one.navigateToURL(navigateURL);
                else 
                    window.open(navigateURL, '_parent');
            } 
        </script>
        
        <div id ="sl">
            <div id= "sl-body">
            
            	<apex:actionFunction action="{!deleteActivity}" name="deleteActivity" reRender="formId" onComplete="window.parent.location.href = '/{!Account.Id}'">
				   <apex:param name="activityid" value="" assignTo="{!selectedActivityId}"/>
				</apex:actionFunction>
				
				<apex:actionFunction name="fetchCallReportId" action="{!fetchCallReportId}" rerender="formId" oncomplete="window.top.location.href = '/apex/SL_CallReportInlineVF?objId={!strRelatedToId}&ActId={!shadowActivityId}'">
					<apex:param name="relatedToId" value="" assignTo="{!strRelatedToId}" />
					<apex:param name="ActivityId" value="" assignTo="{!strActivityId}" />
             	</apex:actionFunction> 
            
                <table width="100%">
                    <tr>
                        <td style="text-align:center">
                            <apex:commandLink onclick="redirectToNew('newTask');return false;">
                                <apex:commandButton value="New Task" styleClass="btn btn-primary btn-sm"/>
                            </apex:commandLink> &nbsp;
                            <apex:commandLink onclick="redirectToNew('newEvent');return false;">
                                <apex:commandButton value="New Event" styleClass="btn btn-primary btn-sm"/>
                            </apex:commandLink>
                        </td>
                    </tr>
                </table>
                <br></br>
                
                <table width="100%" id="activityTable" style="border:1px solid grey" class="table table-striped" cellspacing="0">
                    <thead style="background-color:#FFFFFF">
                        <tr>
                            <th style="vertical-align:middle; background-image:none;">Action</th>
                            <th style="padding-left:20px">Subject</th>
                            <th style="padding-left:20px">Related To</th>
                            <th style="padding-left:20px">Name</th>
                            <th style="padding-left:20px">Due Date</th>
                            <th style="padding-left:20px">Assigned To</th>
                            <th style="padding-left:20px">Create Call Report Link</th>
                        </tr>
                    </thead>
                    <tbody>
                        <apex:repeat value="{!lstActivityHistory}" var="activities">    
                            <tr>
                               <td>
                                    <apex:outputPanel rendered="{!IF(activities.subject != 'Subject Masked', true, false)}" layout="none">
                                   		<a href="javascript: if({!activities.isNativeSubject}){window.open('/{!activities.Id}/e?retURL={!Account.Id}', '_parent');} else {window.open('/apex/SL_Activity_NoAccess?id={!Account.Id}', '_parent');}" style="font-weight:bold;">Edit</a> &nbsp; | &nbsp; 
                                   		<a href="javascript: 
                                   		if({!activities.isNativeSubject})
                                   		{
                                   		    if('{!activities.assignToId}' == '{!strUserId}')
                                   		    {
                                   		        if (window.confirm('Are you sure?')) 
                                   		            deleteActivity('{!activities.id}');
                                   		    }
                                   		    else
                                   		      window.open('/apex/SL_Activity_NoAccess?id={!Account.Id}', '_parent');
                                   		   
                                   		} 
                                   		else {
                                   		    window.open('/apex/SL_Activity_NoAccess?id={!Account.Id}', '_parent');
                                   		    } " style="font-weight:bold">Del</a>           
                                    </apex:outputPanel>
                               </td>
                               <td>
                               		<a href="javascript: if({!activities.isNativeSubject}){window.open('/{!activities.Id}', '_parent');} else {window.open('/apex/SL_Activity_NoAccess?id={!Account.Id}', '_parent');}" style="font-weight:bold;
                               		{!If(activities.subject == 'Subject Masked', 'text-decoration:none;pointer-events:none;','text-decoration:intial;pointer-events:cursor;')}">{!activities.subject}</a>
                               </td>
                               <td>
								<a href="javascript: window.open('/{!activities.relatedToId}', '_parent')" style="font-weight:bold">{!activities.relatedToName}</a>
							   </td>
                                <td style="padding-left: 20px;"><a href="/{!activities.primaryContactId}" target="_blank" style="font-weight:bold">{!activities.primaryContact}</a></td>
                               <td> 
                               	<apex:outputText value="{!TimeZoneValue}">
								    <apex:param value="{!activities.dueDate}"/>
								</apex:outputText>
                               </td>
                               	
                               <td style="padding-left: 20px;">
								<a href="javascript: window.open('/{!activities.assignToId}', '_parent')" style="font-weight:bold">{!activities.assignToName}</a>
							   </td>
                               <td style="padding-left: 20px;">
									<a href="#" style="font-weight:bold" onclick="fetchCallReportId('{!activities.relatedToId}', '{!activities.Id}')">New Call Report</a>
							   </td>
                            </tr>
                        </apex:repeat>    
                    </tbody>
                </table>
                <script>
                    $(document).ready(function() 
                    {
                        $('#activityTable').dataTable(
                            {
                             "bFilter":false,               
                             "bLengthChange":false,
                             "bPaginate":false,
                             "info":false,
                             "aaSorting": [[ 4, "desc" ]],
                             "aoColumnDefs": [{ "bSortable": false, "aTargets": [0]}],
                             //"fixedHeader": true,
                             //"scrollY": "400px"
                            }
                        );
                        $('#projectTable').floatThead();
                    });
                </script>
            </div>
        </div>
    </apex:form>
</apex:page>