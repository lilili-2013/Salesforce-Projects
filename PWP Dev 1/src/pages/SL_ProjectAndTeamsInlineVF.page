<apex:page standardController="Account" extensions="SL_ProjectAndTeamsInlineVF" tabStyle="Opportunity" standardStylesheets="true">
    <apex:stylesheet value="{!URLFOR($Resource.SL_InlineProjectTeams, 'styles/jquery.dataTables.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.SL_InlineProjectTeams, 'styles/sl-bootstrap.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/sl-bootstrap.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.dataTables.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/dataTables.bootstrap.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.SL_InlineProjectTeams, 'scripts/jquery.floatThead.min.js')}"/>
    <apex:form id="formId">
        <style>
            .floatThead-floatContainer{ 
                background-color:white;
            }
            form{
                width:98%;
            }
            #sl-body{
                font-size:1.65em;
            }
            table.dataTable thead .sorting_asc {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_asc.png')}) no-repeat center left;
            }
            table.dataTable thead .sorting_desc {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_desc.png')}) no-repeat center left;
            }
            table.dataTable thead .sorting {
                background: url({!URLFOR($Resource.SL_InlineProjectTeams, 'images/sort_both.png')}) no-repeat center left;
            }
        </style>
        <script>
            function redirectToNewProject(recordId, actionType)
            {
                var navigateURL = (actionType == 'newProject') ? '/apex/SL_ProjectCoverageTeams?accid={!Account.Id}&retURL={!Account.Id}'
                                  : (actionType == 'editProject') ? '/apex/SL_ProjectCoverageTeams?Id='+recordId+'&retURL={!Account.Id}'
                                  : '/'+recordId;
                
                if((typeof sforce != 'undefined') && (sforce != null)) 
                    sforce.one.navigateToURL(navigateURL);
                else 
                    window.open(navigateURL, '_parent');
            } 
        </script>
        
        <div id ="sl">
            <div id= "sl-body">
                <table width="100%">
                    <tr>
                        <td style="text-align:center">
                            <apex:commandLink onclick="redirectToNewProject('{!Account.Id}', 'newProject');return false;">
                                <apex:commandButton value="New Project" styleClass="btn btn-primary btn-sm"/>
                            </apex:commandLink>
                        </td>
                    </tr>
                </table>
                <br></br>
                <table width="100%" id="projectTable" style="border:1px solid grey" class="table table-striped" cellspacing="0">
                    <thead style="background-color:#FFFFFF">
                        <tr>
                            <th style="vertical-align:middle; background-image:none;">Action</th>
                            <th style="padding-left:20px">Project Name</th>
                            <th style="padding-left:20px; vertical-align:middle;">Status</th>
                            <th style="padding-left:20px">Status Date</th>
                            <th style="padding-left:20px">Business Group</th>
                        </tr>
                    </thead>
                    <tbody>
                        <apex:repeat value="{!lstProjectAndTeamsWrapper}" var="project">    
                            <tr>
                                <td>
                                    <apex:commandLink value="Edit" onclick="redirectToNewProject('{!project.objProject.Id}', 'editProject');return false;"/>
                                </td>
                                <td>
                                    <strong><u><apex:commandLink value="{!project.objProject.Name}" onclick="redirectToNewProject('{!project.objProject.Id}', 'viewProject');return false;"/></u></strong>
                                    <table>
                                        <apex:repeat value="{!project.lstProjectTeams}" var="coverageTeam">
                                            <tr>
                                                <td>
                                                    <u><apex:commandLink value="{!coverageTeam.User__r.Name}" onclick="redirectToNewProject('{!coverageTeam.User__c}', 'viewUser');return false;"/></u>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </table>
                                </td>
                                <td data-order="{!mapStageValueToOrder[project.objProject.StageName]}">
                                    <apex:outputField value="{!project.objProject.StageName}"/>
                                </td>
                                <td>
                                    <apex:outputText value="{0, date, M/d/yyyy}">
                                        <apex:param value="{!project.objProject.CloseDate}"/>
                                    </apex:outputText>
                                </td>
                                <td>
                                    <apex:outputText value="{!project.objProject.Business_Group__r.Name}"/>
                                </td>
                            </tr>
                        </apex:repeat>    
                    </tbody>
                </table>
                <script>
                    $(document).ready(function() 
                    {
                        $('#projectTable').dataTable(
                            {
                             "bFilter":false,               
                             "bLengthChange":false,
                             "bPaginate":false,
                             "info":false,
                             "aoColumnDefs": [{ "bSortable": false, "aTargets": [0]} ]
                            }
                        );
                        $('#projectTable').floatThead();
                    });
                </script>
            </div>
        </div>
    </apex:form>
</apex:page>