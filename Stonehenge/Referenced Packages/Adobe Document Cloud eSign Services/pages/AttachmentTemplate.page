<apex:page standardController="echosign_dev1__Attachment_Template__c" extensions="echosign_dev1.AttachmentTemplateController" tabStyle="echosign_dev1__Agreement_Template__c">
	<script>
  		function confirmCancel() {
      		var isCancel = confirm("Are you sure you wish to cancel?");
      		if( isCancel ) {
      			return true;
  			}
  			
     		return false;
  		}  
  	</script>
  
  	<apex:sectionHeader title="Add File Attachments" subtitle="{!sectionSubtitle}" />
    
    <apex:form >
    	<apex:pagemessages id="theMessages"/>
		<apex:pageBlock id="wizardPageBlock" title="{!blockTitle}">
			<apex:pageBlockButtons >
       			<apex:commandButton id="backButton" action="{!doBack}" value="Back" rerender="theMessages,stepTypeSection,stepValueSection,stepSelectionSection,wizardPageBlock,saveButton,backButton,nextButton" rendered="{! isStepValue || isStepSelection }" />
       			<apex:commandButton id="nextButton" action="{!doNext}" value="Next" rerender="theMessages,stepTypeSection,stepValueSection,stepSelectionSection,wizardPageBlock,saveButton,backButton,nextButton" rendered="{!isStepType}" />
       			<apex:commandButton id="saveButton" action="{!doSave}" value="Save" rendered="{! isStepSelection || isStepValue }" />
        		<apex:commandButton action="{!cancel}" value="Cancel" onclick="return confirmCancel()" immediate="true"/>
        	</apex:pageBlockButtons>
        	<apex:outputPanel id="attachmentTemplateTypeDescription" rendered="{!isStepType}">
        		Where do you want to select file attachments from in this agreement template?<br/>
        		<br/>You can either select the file attachment now from your Salesforce document library or you can specify documents from the <br/>master{!masterObjectName} object to be added as attachments to the agreement when the agreement is generated.
      			<br/><br/>
      		</apex:outputPanel>
      		<apex:outputPanel id="attachmentTemplateValueDescription" rendered="{! isStepSelection && isTypeMaster }">
        		Which documents from the master{!masterObjectName} object do you want to add as attachments to the agreement when the agreement is generated?<br/>
        		<br/>You can choose to attach the latest document, the oldest document, or all documents from the master{!masterObjectName} object.<br/>If you select latest or oldest document, you also need to specify how the selection is determined by either choosing Last Modified Date or Created Date of the document.
      			<br/><br/>
      		</apex:outputPanel>
      		<apex:pageBlockSection id="stepTypeSection" columns="1">
      			<apex:inputField id="attachmentTemplateType" value="{!attachmentTemplate.echosign_dev1__Type__c}" required="true" rendered="{!isStepType}"/>
      		</apex:pageBlockSection>
      		<apex:pageBlockSection id="stepValueSection" columns="1">
      			<apex:outputpanel id="attachmentTemplateConstantValue" rendered="{! isStepValue && isTypeConstant }">
					<div class="lookupTab FilePickerResultsFrame"> 
		                <apex:pageBlockSectionItem >
		                       <apex:selectList id="Folder" value="{!selectedFolder}" size="1" >
		                           <apex:selectOptions value="{!documentFolders}"/>
		                           <apex:actionSupport event="onchange" action="{!setFolder}" status="status" rerender="theList"/>
		                         <apex:actionStatus id="status">
		                               <apex:facet name="start"><img src="{!$Resource.loading}" style="width:20px;height:20px" /></apex:facet>
		                               <apex:facet name="stop"><img src="/s.gif" style="width:20px;height:20px" /></apex:facet>
		                           </apex:actionStatus>
		                       </apex:selectList>       
		                </apex:pageBlockSectionItem>
			            <apex:outputpanel id="theList" rendered="{!NOT ISNULL(documentObjects)}" layout="block" >        
			                <apex:pageBlockTable id="BFTable2a" value="{!documentObjects}" rowClasses="firstHeaderRow" var="documentObject" columns="5" width="200%">
			                    <apex:column width="20px">
			                        <apex:facet name="header"></apex:facet>
			                        <apex:inputCheckbox value="{!documentObject.isSelected}" id="checkedone"/>
			                    </apex:column>              
			                   <apex:column >
			                   <apex:facet name="header">{!$ObjectType.Document.fields.Name.label}</apex:facet>
			                        <apex:outputfield value="{!documentObject.document.Name}"/>             
			                  </apex:column>  
			                   <apex:column >
			                   <apex:facet name="header">{!$ObjectType.Document.fields.AuthorId.label}</apex:facet>
			                    <apex:outputfield value="{!documentObject.document.Author.Name}"/>
			                  </apex:column>      
			                   <apex:column >
			                   <apex:facet name="header">{!$ObjectType.Document.fields.BodyLength.label}</apex:facet>
			                    <apex:outputfield value="{!documentObject.document.BodyLength}"/>
			                  </apex:column> 
			                   <apex:column >
			                   <apex:facet name="header">{!$ObjectType.Document.fields.IsInternalUseOnly.label}</apex:facet>
			                    <apex:inputcheckbox disabled="true" value="{!documentObject.document.IsInternalUseOnly}"/>
			                  </apex:column>      
			                </apex:pageBlockTable>
			            </apex:outputpanel>
					</div>
				</apex:outputpanel>
      		</apex:pageBlockSection>
      		<apex:pageBlockSection id="stepSelectionSection" columns="1">
      			<apex:inputField id="attachmentTemplateMasterSelectionType" value="{!attachmentTemplate.echosign_dev1__Attachment_Selection_Type__c}" rendered="{! isStepSelection && isTypeMaster }">
      				<apex:actionSupport event="onchange" action="{!onSelectionTypeChange}" rerender="stepSelectionSection"/>
      			</apex:inputField>
      			<apex:inputField id="attachmentTemplateMasterSelectionField" value="{!attachmentTemplate.echosign_dev1__Attachment_Selection_Field__c}" rendered="{! isStepSelection && isTypeMaster && NOT(isAttachmentSelectionTypeAll) }"/>
        	</apex:pageBlockSection>
  		</apex:pageBlock>
	</apex:form>

</apex:page>