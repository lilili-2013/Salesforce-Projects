<apex:page sidebar="false" controller="BTGCDA.CallDownViewController" docType="html-5.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"/>
    <apex:includeScript value="{!URLFOR($Resource.BTGCDA__CallDownResources, 'CallDownResources/bootstrap-3.0.2/js/bootstrap.min.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BTGCDA__CallDownResources, 'CallDownResources/bootstrap-3.0.2/css/bootstrap-btg-force.css')}"/>
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <style>
        .btg-force a {color: #015ba7; text-decoration: none;}
        .row-separator {border-bottom: 1px solid #dddddd;}
        .member-table {width: 100%;}
        .member-table-label {width: 38%;}
        
        <apex:outputPanel layout="none" rendered="{!theme == 'Gray'}" id="grayTheme">      
            /* Gray Theme */  
            .btg-force .panel-contact{border-color: #aaaaaa;margin-bottom: 5px !important;border-top: 3px solid #56458c;}        
            .btg-force .panel-lead{border-color: #aaaaaa;margin-bottom: 5px !important;border-top: 3px solid #e39321;}         
            .btg-force .panel-strategy{border-color: #aaaaaa;margin-bottom: 5px !important;border-top: 3px solid #015ba7;}
            .btg-force .panel-lead > .panel-heading, .btg-force .panel-contact > .panel-heading, .btg-force .panel-strategy > .panel-heading, .panel-members > .panel-heading{color: #000000;background-color: #f5f5f5;border-color: #aaaaaa;padding: 5px 10px !important;}
        
            .panel-members *, .panel-members *:before, .panel-members *:after{-webkit-box-sizing: border-box;-moz-box-sizing: border-box; box-sizing: border-box;}
            .panel-members{background-color: #ffffff;border: 1px solid #aaaaaa;border-radius: 4px;-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);border-top: 3px solid #015ba7;}
            .panel-members > .panel-heading{color: #000000;background-color: #f5f5f5;padding: 5px 10px;border-bottom: 1px solid #aaaaaa;border-top-right-radius: 3px;border-top-left-radius: 3px;}
            .panel-members > .panel-body{padding: 0px 5px 5px 5px;}
            
            .btg-force #myModal .modal-content, .btg-force #myActivityModal .modal-content{background-color: #cccccc !important; border: 1px solid #fff !important;}
        </apex:outputPanel>
                
        <apex:outputPanel layout="none" rendered="{!theme == null || theme == 'Blue'}" id="colorTheme">    
            /* Blue Theme */
            .btg-force .panel-contact{border-color: #56458c;border-width: 1px;margin-bottom: 5px !important;}        
            .btg-force .panel-lead{border-color: #e39321;border-width: 1px;margin-bottom: 5px !important;}         
            .btg-force .panel-strategy{border-color: #015ba7;border-width: 1px;margin-bottom: 5px !important;}
            .btg-force .panel-contact > .panel-heading a, .btg-force .panel-lead > .panel-heading a, .btg-force .panel-strategy > .panel-heading a{color: #FFFFFF;}
            
            .btg-force .panel-lead > .panel-heading {color: #FFFFFF;background-color: #e39321;border-color: #e39321;padding: 5px 10px !important;} 
            .btg-force .panel-contact > .panel-heading {color: #FFFFFF;background-color: #56458c;border-color: #56458c;padding: 5px 10px !important;} 
            .btg-force .panel-strategy > .panel-heading, .panel-members > .panel-heading{color: #FFFFFF;background-color: #015ba7;border-color: #015ba7;padding: 5px 10px !important;}
            
            .panel-members *, .panel-members *:before, .panel-members *:after{-webkit-box-sizing: border-box;-moz-box-sizing: border-box; box-sizing: border-box;}
            .panel-members{background-color: #ffffff;border: 1px solid #015ba7;border-radius: 4px;-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);}
            .panel-members > .panel-heading{color: #FFFFFF;background-color: #015ba7;padding: 5px 10px;border-bottom: 1px solid #015ba7;border-top-right-radius: 3px;border-top-left-radius: 3px;}
            .panel-members > .panel-body{padding: 0px 5px 5px 5px;}
            
            .btg-force #myModal .modal-content, .btg-force #myActivityModal .modal-content {background-color: #015ba7 !important; border: 1px solid #fff !important;}
            .btg-force #myModal .modal-title, .btg-force #myActivityModal .modal-title{color: #FFFFFF;} 
         </apex:outputPanel>
       
        .btg-force .panel-primary{margin-bottom: 5px !important;}
        .btg-force .panel-primary > .panel-heading {padding: 5px 10px !important;}
        .btg-force .panel-primary > .panel-heading a,  .btg-force .panel-primary > .panel-heading a:visited{color: #ffffff;}
        
        .btg-force .form-group{margin-bottom: 0px !important;}
        .btg-force .panel-body{padding: 5px !important;}        
        .btg-force .progress {margin-bottom: 0px;}
        .btg-force .progress-bar-warning {background-color: #ffff00;}
        
        
        .btg-force .modal-footer {padding: 5px 15px !important; margin-top: 5px !important;}
        .btg-force .modal-body{padding: 5px;}
                
        .contact-legend{display:inline-block; background-color:#56458c; width: 13px; height: 13px; margin-right: 2px;}
        .lead-legend{display:inline-block; background-color:#e39321; width: 13px; height: 13px; margin-right: 2px;}
        .abandoned-legend{display:inline-block; background-color:#d9534f; width: 13px; height: 13px; margin-right: 2px;}
        .successful-legend{display:inline-block; background-color:#5cb85c; width: 13px; height: 13px; margin-right: 2px;}
        .completed-legend{display:inline-block; background-color:#ffff00; width: 13px; height: 13px; margin-right: 2px;}
        
        .strategy-info-link span {margin-left: 10px;}
        .popover-title {display: block !important;}
        
        .strategy-details-table {width: 100%;}
        .strategy-details-table tr td { padding: 5px;}
        .label-column {text-align: right;}
        .app-container{padding-top: 5px;}
        .overlay {position: fixed; top: 0; left: 0; height: 100%; width: 100%; z-index: 2000; background-color: rgba(0,0,0,0.5);}
        .white-box{width: 300px; height: 110px; position: fixed; top: 50%; left: 50%; margin-top: -100px; margin-left: -150px; background-color: #FFFFFF; border-radius: 5px; text-align: center; z-index: 2001;}
        .white-box img{width: 75px;}
        #loadingLabel{font-weight: bold;}
    </style>
<div class="app-container">
    <div id="overlay" style="display: none;">
        <div class="overlay">
        </div>
        <div class="white-box">
            <img src="{!URLFOR($Resource.CallDownResources, 'CallDownResources/Loading_Animation.gif')}" alt="Loading" />
            <div>
                <span id="loadingLabel">Loading</span>
            </div>
        </div>
    </div>
    
<apex:outputPanel id="accessErrorPnl" layout="block" styleClass="btg-force" rendered="{!NOT(hasAccess)}">
	<div class="row">
		<div class="col-md-12">
			<h4>Permission Issues</h4>
			 <div class="alert alert-{!messageType}">
                 <apex:outputText value="{!message}" />
             </div>
             <h5>Object and Field Permissions Needed</h5>
             <table class="table table-striped table-condensed table-bordered">
             	<tr>
             		<th>Object</th>
             		<th>Field</th>
             		<th>Permission Type</th>
             	</tr>
             	<tr>
             		<td><strong>Account</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>ID</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Lead</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>ID</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>First Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Last Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Company</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Phone</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Contact</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>ID</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>First Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Last Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Account Id</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Phone</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Campaign</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>ID</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Name</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Owner</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Campaign Member</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>ID</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Contact Id</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Lead Id</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Campaign Id</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Call Down Strategy</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>All Fields</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Status</td>
             		<td>Edit</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>Completed Attempts</td>
             		<td>Edit</td>
             	</tr>
             	<tr>
             		<td><strong>Call Down Attempt</strong></td>
             		<td></td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>All Fields</td>
             		<td>Read</td>
             	</tr>
             	<tr>
             		<td><strong>Call Down Attempt Result</strong></td>
             		<td></td>
             		<td>Read/Create</td>
             	</tr>
             	<tr>
             		<td></td>
             		<td>All Fields</td>
             		<td>Read/Edit</td>
             	</tr>
             </table>
		</div>
	</div>	
</apex:outputPanel>
    <apex:form id="form1" rendered="{!hasAccess}">
    <div class="btg-force">
        <div class="row"  style="margin-bottom: 5px;">            
                <div class="col-md-6">
                    <strong>Campaign Strategy </strong>
                     <apex:selectList id="strategyList" value="{!strategyId}" multiselect="false" size="1" style="width: 300px;">
                         <apex:selectoptions value="{!StrategyOptions}" />
                         <apex:actionsupport event="onchange" rerender="appSettings,StrategyDetails,StrategyLinks,StrategyInfo,membersPanel,Members,CompanyMembers,refreshOptionList,detail" action="{!strategyOptionsOnChange}" onsubmit="displayOverlay(); clearDetail();" oncomplete="clearMessage(); hideOverlay();" />
                     </apex:selectList>
                     <apex:outputPanel id="StrategyInfo">
                        <a style="display: {!IF(strategy == null, 'none', 'inline')}" href="#" class="strategy-info-link" data-toggle="popover"  title="Call To Action" data-content="{!strategy.callToAction}" >
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </a>  
                        <script type="text/javascript">
                            $('.strategy-info-link').popover({
                                html: true,
                                placement: 'bottom'
                            });
                         </script>
                     </apex:outputPanel>
                     <apex:outputPanel id="refreshOptionList">
                        <script type="text/javascript">
                            if('{!JSENCODE(message)}' == 'Strategy Completed!')
                            {
                                refreshStrategyList();
                            }
                        </script>
                     </apex:outputPanel>
                </div>
                <div class="col-md-6 text-right">                    
                     <apex:outputPanel id="StrategyLinks">
                     	<span style="display: {!IF(strategy == null, 'none', 'inline')}">
                            <strong>Quick Links: </strong>
                        	<a data-id="modal3" data-pageUrl="/{!strategy.campaignId}" data-title="Campaign Details" data-target="#myModal" data-toggle="modal" href="#" >Campaign Details</a> | 
                            <a data-id="modal3" data-pageUrl="/{!strategy.Id}" data-title="Strategy Details" data-target="#myModal" data-toggle="modal" href="#" >Strategy Details</a> | 
                            <a data-id="modal3" data-pageUrl="{!'/apex/' + namespacePrefix + 'CallDownReport?id=' + strategy.Id}" data-title="Strategy Report" data-target="#myModal" data-toggle="modal" href="#" >Strategy Report</a> 
                        </span>
                         <script type="text/javascript">
                                $('a[data-id="modal3"]').on('click', function(){
                                    $('#myModalLabel').html( $(this).attr('data-title') );
                                    $('#modalFrame').attr('src',  $(this).attr('data-pageUrl'));
                                    /*console.log('here');
                                    console.log($(this).attr('data-pageUrl'));
                                    //$('#modal').load();
                                    console.log('there');*/
                                });
                                
                             </script> 
                     </apex:outputPanel>  
                </div> 
        </div>
        <div class="row header-row">
            <div class="col-md-12">
                 <apex:outputPanel id="StrategyDetails" layout="block">
                    <div class="panel panel-strategy"  style="display: {!IF(strategy == null, 'none', 'block')}">
                        <div class="panel-heading clearfix">
                            <h5>Overview</h5>
                        </div>
                   
                        <div class="panel-body"> 
                             <table class="strategy-details-table">
                                <tr>
                                    <td class="label-column" width="7%"><strong>Start Date</strong></td>
                                    <td width="5%">
                                        <apex:outputText value="{0,date,MM/dd/yyyy}">
                                            <apex:param value="{!strategy.startDate}" />
                                        </apex:outputText>
                                    </td>
                                    <td class="label-column clearfix" width="15%">
                                        <div class="pull-right">
                                            <strong>Contacts</strong>
                                        </div>
                                        <div class="contact-legend pull-right">&nbsp;</div>
                                    </td>
                                    <td width="5%">{!strategy.numberOfContacts}</td>
                                    
                                    <td class="label-column" width="15%"><strong>Progress</strong></td>
                                    <td colspan="7">
                                        <div class="progress">
                                            <div class="progress-bar progress-bar-success" style="width: {!strategy.successfulPercentage}%">
                                            </div>
                                            <div class="progress-bar progress-bar-warning" style="width: {!strategy.completedPercentage}%">
                                            </div>                                                       
                                            <div class="progress-bar progress-bar-danger" style="width: {!strategy.abandonedPercentage}%">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="label-column"><strong>End Date</strong></td>
                                    <td>
                                        <apex:outputText value="{0,date,MM/dd/yyyy}">
                                            <apex:param value="{!strategy.endDate}" />
                                        </apex:outputText>
                                    </td>
                                    <td class="label-column">
                                        <div class="pull-right">
                                            <strong>Leads</strong>
                                        </div>
                                        <div class="lead-legend pull-right">&nbsp;</div>
                                    </td>
                                    <td>{!strategy.numberOfLeads}</td>
                                    <td class="label-column" width="15%">
                                        <strong>In Progress</strong>                                          
                                    </td>
                                    <td width="5%">
                                        {!strategy.numberOfMembers - (strategy.abandonedAttempts + strategy.successfulAttempts + strategy.completedAttempts)}
                                    </td>
                                    <td class="label-column clearfix">
                                        <div class="pull-right">
                                            <strong>Successful</strong>
                                        </div>
                                        <div class="successful-legend pull-right">&nbsp;</div>  
                                    </td>
                                    <td width="5%">
                                        {!strategy.successfulAttempts}
                                    </td>
                                    <td class="label-column">
                                        <div class="pull-right">
                                            <strong>Completed Members</strong>
                                        </div>
                                        <div class="completed-legend pull-right">&nbsp;</div> 
                                    </td>
                                    <td>
                                        {!strategy.completedAttempts}
                                    </td>
                                    <td class="label-column">
                                        <div class="pull-right">
                                            <strong>Abandoned Members</strong>
                                        </div>
                                        <div class="abandoned-legend pull-right">&nbsp;</div>
                                    </td>
                                    <td>{!strategy.abandonedAttempts}</td>
                                </tr>
                             </table>
                               
                        </div>
                </div>
                </apex:outputPanel>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <apex:outputPanel id="messagePnl" layout="block">
                    <div class="alert alert-{!messageType}" style="display: {!IF(message == null, 'none', 'block')}">
                        <apex:outputText value="{!message}" />
                    </div>
                    <script type="text/javascript">
                         $('#mainPanel').attr('style', 'display: {!IF(message == 'Strategy Completed!', 'none', 'block')}');
                   </script> 
                </apex:outputPanel>
                <apex:actionFunction name="clearMessagePanel" reRender="messagePnl" action="{!clearDisplayMessage}" />
                <apex:actionFunction name="refreshStrategyList" reRender="strategyList" />
            </div>
        </div>
    </div>
    <div id="mainPanel" class="panel-members">
       <div class="panel-heading">
            <apex:outputPanel id="membersPanel" layout="block" styleClass="btg-force">
            <div style="display: {!IF(strategyId != null && strategyId != '', 'none', 'block')}" >
                <h5>Update Application Settings</h5>
            </div>
            <div class="row" style="display: {!IF(strategy == null, 'none', 'block')}">
                <div class="col-md-3">
                    <h5>Members: {!displayCount} of {!inProgress}</h5>
                </div>
                <div class="col-md-3">
                    <strong>No Attempts</strong>&nbsp;
                    <apex:selectlist value="{!noAttemptFilter}" multiselect="false" size="1" >
                        <apex:selectOption itemValue="" itemLabel="View All Records"></apex:selectOption>
                        <apex:selectOption itemvalue="2HRS" itemLabel="Last 2 Hours"></apex:selectOption>
                        <apex:selectOption itemvalue="4HRS" itemLabel="Last 4 Hours"></apex:selectOption>
                        <apex:selectOption itemvalue="TODAY" itemLabel="Today"></apex:selectOption>
                        <apex:selectOption itemvalue="THISWEEK" itemLabel="This Week"></apex:selectOption>
                        <apex:actionsupport event="onchange" rerender="messagePnl,Members,CompanyMembers,membersPanel" action="{!updateAppSettings}" onsubmit="displayOverlay();" oncomplete="scrollUpList(); hideOverlay();"/>
                    </apex:selectlist> 
                </div>
                <div class="col-md-2">
                    <strong>Group By</strong>&nbsp;
                    <apex:selectlist value="{!groupBy}" multiselect="false" size="1" >
                        <apex:selectOption itemValue="Member" itemLabel="Member"></apex:selectOption>
                        <apex:selectOption itemvalue="Company" itemLabel="Company"></apex:selectOption>
                        <apex:actionsupport event="onchange" rerender="messagePnl,Members,CompanyMembers" action="{!updateAppSettings}" onsubmit="displayOverlay();" oncomplete="scrollUpList(); hideOverlay();"/>
                    </apex:selectlist>  
                </div>
                <div class="col-md-4">
                    <strong>Sort By</strong>&nbsp;
                    <apex:selectlist value="{!sortBy}" multiselect="false" size="1" >
                        <apex:selectOption itemvalue="FirstName" itemLabel="First Name"></apex:selectOption>
                        <apex:selectOption itemvalue="LastName" itemLabel="Last Name"></apex:selectOption>
                        <apex:selectOption itemvalue="Company" itemLabel="Company"></apex:selectOption>
                        <apex:selectOption itemValue="Attempt" itemLabel="Number of Attempts"></apex:selectOption>
                        <apex:actionsupport event="onchange" rerender="messagePnl,Members,CompanyMembers" action="{!updateAppSettings}" onsubmit="displayOverlay();" oncomplete="scrollUpList(); hideOverlay();"/>
                    </apex:selectlist>  
                    &nbsp;
                    <apex:selectlist value="{!sortDirection}" multiselect="false" size="1" >
                        <apex:selectOption itemValue="Asc" itemLabel="Ascending"></apex:selectOption>
                        <apex:selectOption itemvalue="Desc" itemLabel="Descending"></apex:selectOption>
                        <apex:actionsupport event="onchange" rerender="messagePnl,Members,CompanyMembers" action="{!updateAppSettings}" onsubmit="displayOverlay();" oncomplete="scrollUpList(); hideOverlay();"/>
                    </apex:selectlist> 
                </div>
             </div>
    </apex:outputPanel>
    </div>
    <div class="panel-body">
    <apex:outputPanel id="appSettings" layout="block" styleClass="btg-force">
        <div class="row" style="padding: 5px; display: {!IF(strategyId != null && strategyId != '', 'none', 'block')}">
            <div class="col-md-3">
              <strong>Theme</strong> &nbsp;
              <apex:selectlist value="{!theme}" multiselect="false" size="1" >
                  <apex:selectOption itemValue="Blue" itemLabel="Blue"></apex:selectOption>
                  <apex:selectOption itemvalue="Gray" itemLabel="Gray"></apex:selectOption>
                  <apex:actionsupport event="onchange" action="{!updateAppSettings}" onsubmit="displayOverlay();" oncomplete="reloadPage(); hideOverlay();"/>
              </apex:selectlist>
            </div>
            <div class="col-md-2">
                <a href="#" class="thumbnail" data-target="#blueModal" data-toggle="modal">
                    <img width="100%" src="{!URLFOR($Resource.CallDownResources, 'CallDownResources/Blue_Theme.png')}" alt="Blue Theme" title="Blue Theme" />
                </a>
                <div class="text-center">
                    <i>Blue Theme</i>
                </div>
            </div>
            <div class="col-md-2">
                <a href="#" class="thumbnail" data-target="#grayModal" data-toggle="modal">
                    <img width="100%" alt="Gray Theme" title="Gray Theme" src="{!URLFOR($Resource.CallDownResources, 'CallDownResources/Gray_Theme.png')}" />
                </a>
                <div class="text-center">
                    <i>Gray Theme</i>
                </div>
            </div>
            <div class="col-md-5">
            </div>
        </div>
    </apex:outputPanel>
    <table style="width:100%">
        <tr>
            <td class="btg-force" style="width: 315px;">    
        
            <div class="row"> 
                <div id="divLists" class="col-md-12" style="height:550px; overflow: auto;">
                  
                        <apex:outputPanel id="Members" layout="block">
                            <apex:repeat value="{!StrategyMembers}" var="member">
                                 <div class="row">
                                     <div class="col-md-12">
                                         <div id="divMember{!member.Id}" data-type="{!IF(member.isLead, 'lead', 'contact')}" class="panel panel-{!IF(member.id == currentId , 'primary',IF(member.isLead, 'lead', 'contact'))}">
                                            <div class="panel-heading">
                                                 <div>
                                                     <h5>
                                                         <apex:commandLink id="lnkMember" rerender="detail" value="{!member.name}" oncomplete=" scrollUp(); hideOverlay();" onclick="displayOverlay(); select('divMember{!member.Id}');"> 
                                                              <apex:param name="smid" value="{!member.id}" assignTo="{!detailId}"/>
                                                              <apex:param name="smid2" value="{!member.id}" assignTo="{!currentId}" />
                                                          </apex:commandLink> 
                                                          <small>
                                                            &nbsp;&nbsp;<a data-id="modal1" data-pageUrl="/{!member.id}" data-title="{!member.name}" data-target="#myModal" data-toggle="modal" href="#" title="modal view" ><span class="glyphicon glyphicon-new-window"></span></a>
                                                          </small>
                                                     </h5>
                                                     <div>
                                                        <span style="display: {!IF(member.isLead, 'inline', 'none')}">{!member.company}</span>
                                                        <apex:commandLink id="lnkAccount" rerender="detail"  value="{!member.company}" oncomplete="scrollUp(); hideOverlay();" onclick="displayOverlay(); select('divMember{!member.Id}');" rendered="{!IF(member.isLead, false, true)}"> 
                                                          <apex:param name="smid" value="{!member.id}" assignTo="{!currentId}"/>
                                                          <apex:param name="cid" value="{!member.companyId}" assignTo="{!detailId}" />
                                                        </apex:commandLink>
                                                        <span style="display: {!IF(member.isLead, 'none', 'inline')}">
                                                            &nbsp;&nbsp;<a data-id="modal1" data-pageUrl="/{!member.companyId}" data-title="{!member.company}" data-target="#myModal" data-toggle="modal" href="#" title="modal view" ><span class="glyphicon glyphicon-new-window"></span></a>
                                                        </span>
                                                     </div>
                                                 </div>
                                             </div>
                                             <div class="panel-body">
                                                <table class="table-condensed member-table">
                                                    <tbody>
                                                        <tr class="row-separator">
                                                            <td class="member-table-label text-right">
                                                                <strong>Phone</strong>
                                                            </td>
                                                            <td>
                                                            	<apex:outputPanel id="Phone" layout="inline">
                                                                        {!member.phone}
                                                                </apex:outputPanel>
                                                                <apex:outputPanel id="LnkPhone" title="Call" layout="inline" rendered="{!clickToDialUrl != null && clickToDialUrl != ''}">
                                                                	&nbsp;&nbsp;&nbsp;&nbsp;
                                                                	<apex:commandLink style="color: #008000;text-decoration: none;" id="phoneLink" rerender="detail" onclick="setLoadingLabel('Calling: {!JSENCODE(member.name)} - {!member.phone}'); displayOverlay(); select('divMember{!member.Id}'); dial('{!SUBSTITUTE(SUBSTITUTE(clickToDialUrl,'{0}', $User.Extension), '{1}', member.phoneForUrl)}','{!JSENCODE(member.name)}','{!member.Phone}');" oncomplete="hideOverlay();"> 
                                                                        <apex:param name="smid" value="{!member.id}" assignTo="{!detailId}"/>
                                                                        <apex:param name="smid2" value="{!member.id}" assignTo="{!currentId}"/>
                                                                        <span class="glyphicon glyphicon-phone-alt"></span>
                                                                    </apex:commandLink>
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                                                    <apex:commandLink style="color: #800000;text-decoration: none;" id="phoneLinkBLock" title="Call with Blocked Caller ID" rendered="{!NOT(CONTAINS(clickToDialUrl,'*67')) && member.phone != null && member.phone != '' }" rerender="detail" value="" onclick="setLoadingLabel('Calling: {!JSENCODE(member.name)} - *67 {!member.phone}'); displayOverlay(); select('divMember{!member.Id}'); dial('{!SUBSTITUTE(SUBSTITUTE(clickToDialUrl,'{0}', $User.Extension), '{1}', member.blockedPhoneForUrl)}','{!JSENCODE(member.name)}','*67 {!member.Phone}');" oncomplete="hideOverlay();"> 
                                                                        <apex:param name="smid" value="{!member.id}" assignTo="{!detailId}"/>
                                                                        <apex:param name="smid2" value="{!member.id}" assignTo="{!currentId}"/>
                                                                        <span class="glyphicon glyphicon-phone-alt"></span>
                                                                    </apex:commandLink>
                                                                </apex:outputPanel>                                                                
                                                            </td>
                                                        </tr>
                                                        <tr class="row-separator">
                                                            <td class="text-right">
                                                                <strong>Steps Completed</strong>
                                                            </td>
                                                            <td>
                                                                 {!member.numberOfAttemptResults}/{!member.numberOfAttempts}
                                                            </td>
                                                        </tr>
                                                        <tr class="row-separator">
                                                            <td class="text-right">
                                                                <strong>Next Attempt</strong>
                                                            </td>
                                                            <td>
                                                                {!member.nextAttempt.Name} - {!member.nextAttempt.Type__c}  
                                                                <a href="#" class="purpose-link" data-toggle="popover" data-original-title="Purpose" data-content="{!member.nextAttempt.Purpose__c}" >
                                                                    <span class="glyphicon glyphicon-info-sign"></span>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr class="row-separator">
                                                            <td class="text-right">
                                                                <strong>Last Attempt</strong>
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="{0,date,EEE MMM dd, yyyy 'at' hh:mm a }">
                                                                   <apex:param value="{!member.lastAttemptResultLocalDate}" /> 
                                                                </apex:outputText>
                                                            </td>
                                                        </tr>
                                                    </tbody> 
                                                </table>
                                                <div style="margin-top: 10px;">                                          
                                                     <div class="text-center">
                                                         <apex:commandLink action="{!saveAttempt}" value="Attempt" title="Attempt" reRender="Members,StrategyDetails,membersPanel,messagePnl" styleClass="btn btn-xs btn-primary" onclick="displayOverlay();" oncomplete="refreshDetail(); hideOverlay();">
                                                            <apex:param name="memberId" value="{!member.id}" assignTo="{!selectedMemberId}" />
                                                            <apex:param name="smid" value="{!member.id}" assignTo="{!currentId}"/>
                                                         </apex:commandLink>&nbsp;&nbsp;  
                                                         <apex:commandLink action="{!saveAttempt}" rerender="logFrame,activityFrame,messagePnl" styleClass="btn btn-xs btn-info" title="Activity" value="Activity" onclick="displayOverlay(); select('divMember{!member.Id}');displayActivityModal();" oncomplete="hideOverlay();"> 
                                                                      <apex:param name="asmid" value="{!member.id}" assignTo="{!selectedMemberId}"/>
                                                                      <apex:param name="smid" value="{!member.id}" assignTo="{!currentId}"/>
                                                         </apex:commandLink>&nbsp;&nbsp;
                                                         <apex:commandLink action="{!saveSuccess}" value="Success" title="Success" reRender="activityFrame,logFrame,messagePnl" styleClass="btn btn-xs btn-success" onclick="displayOverlay(); select('divMember{!member.Id}');displayActivityModal();" oncomplete="hideOverlay();">
                                                            <apex:param name="lsmid" value="{!member.id}" assignTo="{!selectedMemberId}" />
                                                            <apex:param name="smid" value="{!member.id}" assignTo="{!currentId}"/>
                                                         </apex:commandLink>&nbsp;&nbsp;
                                                          <apex:commandLink action="{!remove}" value="Abandon" title="Abandon" reRender="Members,StrategyDetails,membersPanel,messagePnl" styleClass="btn btn-xs btn-danger" onclick="displayOverlay();" oncomplete="refreshDetail(); hideOverlay();">
                                                            <apex:param name="memberId" value="{!member.id}" assignTo="{!selectedMemberId}" />
                                                            <apex:param name="smid" value="{!member.id}" assignTo="{!currentId}"/>
                                                         </apex:commandLink>
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                 </div>
                             </apex:repeat>     
                             <script type="text/javascript">
                                $('.purpose-link').popover({
                                    html: true,
                                    placement: 'bottom'
                                });
                                $('.phone-popup-link').on('click', function(){                                   
                                   event.preventDefault();
                                   window.open($(this).attr('href'),'CallDownClickToDialPopup','width=100,height=100');
                                });
                                $('a[data-id="modal1"]').on('click', function(){
                                    $('#myModalLabel').html( $(this).attr('data-title') );
                                    $('#modalFrame').attr('src',  $(this).attr('data-pageUrl'));
                                    /*console.log('here');
                                    console.log($(this).attr('data-pageUrl'));
                                    //$('#modal').load();
                                    console.log('there');*/
                                });
                             </script>          
                        </apex:outputPanel>
                        <apex:outputPanel id="CompanyMembers" layout="block">
                        
                        <apex:repeat value="{!StrategyCompanyMembers}" var="cm">
                                <div class="row">
                                     <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <h5>{!cm.Company}</h5>
                                            </div>
                                        </div>
                                        <apex:repeat value="{!cm.members}" var="companyMember">
                                                 <div class="row">
                                                     <div class="col-md-12">
                                                         <div id="divCompMember{!companyMember.Id}" data-type="{!IF(companyMember.isLead, 'lead', 'contact')}" class="panel panel-{!IF(companyMember.id == currentId, 'primary',IF(companyMember.isLead, 'lead', 'contact'))}">
                                                             <div class="panel-heading clearfix">
                                                                <div>
                                                                     <h5>
                                                                         <apex:commandLink id="lnkCompanyMember" rerender="detail" value="{!companyMember.name}" oncomplete="scrollUp(); hideOverlay();" onclick="displayOverlay(); select('divCompMember{!companyMember.Id}');"> 
                                                                              <apex:param name="smid" value="{!companyMember.id}" assignTo="{!detailId}"/>
                                                                              <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
                                                                          </apex:commandLink> 
                                                                          <small>
                                                                          &nbsp;&nbsp;<a data-id="modal2" data-pageUrl="/{!companyMember.id}" data-title="{!companyMember.name}" data-target="#myModal" data-toggle="modal" href="#" title="modal view" ><span class="glyphicon glyphicon-new-window"></span></a>
                                                                          </small>
                                                                     </h5>
                                                                     <div>
                                                                        <span style="display: {!IF(companyMember.isLead, 'inline', 'none')}">{!companyMember.company}</span>
                                                                        <apex:commandLink id="lnkCompanyAccount" rerender="detail"  value="{!companyMember.company}" oncomplete="scrollUp(); hideOverlay();" onclick="displayOverlay(); select('divCompMember{!companyMember.Id}');" rendered="{!IF(companyMember.isLead, false, true)}"> 
                                                                          <apex:param name="smid" value="{!companyMember.id}" assignTo="{!currentId}"/>
                                                                          <apex:param name="cid" value="{!companyMember.companyId}" assignTo="{!detailId}" />
                                                                        </apex:commandLink>
                                                                        <span style="display: {!IF(companyMember.isLead, 'none', 'inline')}">
                                                                            &nbsp;&nbsp;<a data-id="modal2" data-pageUrl="/{!companyMember.companyId}" data-title="{!companyMember.company}" data-target="#myModal" data-toggle="modal" href="#" title="modal view" ><span class="glyphicon glyphicon-new-window"></span></a>
                                                                        </span>
                                                                     </div>
                                                                 </div>
                                                             </div>
                                                             <div class="panel-body"> 
                                                                 <table class="table-condensed member-table">
                                                                    <tbody>
                                                                        <tr class="row-separator">
                                                                            <td class="member-table-label text-right">
                                                                                <strong>Phone</strong>
                                                                            </td>
                                                                            <td>
                                                                            	<apex:outputPanel id="Phone2" layout="inline">
                                                                                    {!companyMember.phone}
                                                                                </apex:outputPanel>
                                                                                <apex:outputPanel id="LnkPhone2" layout="inline" rendered="{!clickToDialUrl != null && clickToDialUrl != ''}">
                                                                                   &nbsp;&nbsp;&nbsp;&nbsp;
                                                                                   <apex:commandLink style="color: #008000;text-decoration: none;" id="companyPhoneLink" title="Call" rerender="detail" onclick="setLoadingLabel('Calling: {!JSENCODE(companyMember.name)} - {!companyMember.phone}'); displayOverlay(); select('divCompMember{!companyMember.Id}'); dial('{!SUBSTITUTE(SUBSTITUTE(clickToDialUrl,'{0}', $User.Extension), '{1}', companyMember.phoneForUrl)}','{!JSENCODE(companyMember.name)}','{!companyMember.Phone}');" oncomplete="hideOverlay();"> 
				                                                                        <apex:param name="smid" value="{!companyMember.id}" assignTo="{!detailId}"/>
				                                                                        <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
				                                                                        <span class="glyphicon glyphicon-phone-alt"></span>
				                                                                    </apex:commandLink>
                                                                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                                                                   <apex:commandLink style="color: #800000;text-decoration: none;" title="Call with Blocked Caller ID" rendered="{!NOT(CONTAINS(clickToDialUrl,'*67')) && companyMember.phone != null && companyMember.phone != ''}" id="companyPhoneLinkBlock" rerender="detail" value="" onclick="setLoadingLabel('Calling: {!JSENCODE(companyMember.name)} - *67 {!companyMember.phone}'); displayOverlay(); select('divCompMember{!companyMember.Id}'); dial('{!SUBSTITUTE(SUBSTITUTE(clickToDialUrl,'{0}', $User.Extension), '{1}', companyMember.blockedPhoneForUrl)}','{!JSENCODE(companyMember.name)}','*67{!companyMember.Phone}');" oncomplete="hideOverlay();"> 
				                                                                        <apex:param name="smid" value="{!companyMember.id}" assignTo="{!detailId}"/>
				                                                                        <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
				                                                                        <span class="glyphicon glyphicon-phone-alt"></span>
				                                                                    </apex:commandLink>
                                                                                </apex:outputPanel>
                                                                            </td>
                                                                        </tr>
                                                                        <tr class="row-separator">
                                                                            <td class="text-right">
                                                                                <strong>Steps Completed</strong>
                                                                            </td>
                                                                            <td>
                                                                                {!companyMember.numberOfAttemptResults}/{!companyMember.numberOfAttempts}
                                                                            </td>
                                                                        </tr>
                                                                        <tr class="row-separator">
                                                                            <td class="text-right">
                                                                                <strong>Next Attempt</strong>
                                                                            </td>
                                                                            <td>
                                                                                {!companyMember.nextAttempt.Name} - {!companyMember.nextAttempt.Type__c} 
                                                                                <a href="#" class="purpose-link2" data-toggle="popover" data-original-title="Purpose" data-content="{!companyMember.nextAttempt.Purpose__c}" >
                                                                                    <span class="glyphicon glyphicon-info-sign"></span>
                                                                                </a>
                                                                            </td>
                                                                        </tr>
                                                                        <tr class="row-separator">
                                                                            <td class="text-right">
                                                                                <strong>Last Attempt</strong>
                                                                            </td>
                                                                            <td>
                                                                                <apex:outputText value="{0,date,EEE MMM dd, yyyy 'at' hh:mm a }">
                                                                                    <apex:param value="{!companyMember.lastAttemptResultLocalDate}" /> 
                                                                                </apex:outputText>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                                <div style="margin-top: 10px;">                                          
                                                                     <div class="text-center">
                                                                         <apex:commandLink action="{!saveAttempt}" value="Attempt" title="Attempt" reRender="CompanyMembers,StrategyDetails,membersPanel,messagePnl" styleClass="btn btn-xs btn-primary" onclick="displayOverlay();" oncomplete="refreshDetail(); hideOverlay();">
                                                                            <apex:param name="memberId" value="{!companyMember.id}" assignTo="{!selectedMemberId}" />
                                                                            <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
                                                                         </apex:commandLink>&nbsp;&nbsp;  
                                                                         <apex:commandLink action="{!saveAttempt}" rerender="logFrame,activityFrame,messagePnl" styleClass="btn btn-xs btn-info" title="Activity" value="Activity" onclick="displayOverlay(); select('divCompMember{!companyMember.Id}');displayActivityModal();" oncomplete="refreshDetail(); hideOverlay();"> 
                                                                                      <apex:param name="asmid" value="{!companyMember.id}" assignTo="{!selectedMemberId}"/>
                                                                                      <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
                                                                         </apex:commandLink>&nbsp;&nbsp;
                                                                         <apex:commandLink action="{!saveSuccess}" value="Success" title="Success" reRender="activityFrame,logFrame,messagePnl" styleClass="btn btn-xs btn-success" onclick="displayOverlay(); select('divCompMember{!companyMember.Id}');displayActivityModal();" oncomplete="refreshDetail(); hideOverlay();">
                                                                            <apex:param name="lsmid" value="{!companyMember.id}" assignTo="{!selectedMemberId}" />
                                                                            <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}"/>
                                                                         </apex:commandLink>&nbsp;&nbsp;
                                                                          <apex:commandLink action="{!remove}" value="Abandon" title="Abandon" reRender="CompanyMembers,StrategyDetails,membersPanel,messagePnl" styleClass="btn btn-xs btn-danger" onclick="displayOverlay();" oncomplete="refreshDetail(); hideOverlay();">
                                                                            <apex:param name="memberId" value="{!companyMember.id}" assignTo="{!selectedMemberId}" />
                                                                            <apex:param name="smid2" value="{!companyMember.id}" assignTo="{!currentId}" />
                                                                         </apex:commandLink>
                                                                     </div>
                                                                 </div>
                                                             </div>
                                                         </div>
                                                     </div> 
                                                 </div>
                                             </apex:repeat>
                                    </div>
                                </div> 
                            </apex:repeat>
                            <script type="text/javascript">
                                $('.purpose-link2').popover({
                                    html: true,
                                    placement: 'bottom'
                                });
                                 $('.phone-popup-link2').on('click', function(){                                   
                                   event.preventDefault();
                                   window.open($(this).attr('href'),'CallDownClickToDialPopup','width=100,height=100');
                                });
                                $('a[data-id="modal2"]').on('click', function(){
                                    $('#myModalLabel').html( $(this).attr('data-title') );
                                    $('#modalFrame').attr('src',  $(this).attr('data-pageUrl'));
                                    /*console.log('here');
                                    console.log($(this).attr('data-pageUrl'));
                                    //$('#modal').load();
                                    console.log('there');*/
                                });
                                
                             </script> 
                        </apex:outputPanel>
                        <apex:actionFunction name="refreshDetailPanel" reRender="detail" />
                        <apex:actionFunction name="clearDetailPanel" reRender="detail" action="{!clearDetailId}" />
                        <apex:actionFunction name="refreshPanelsAfterActivity" reRender="Members,CompanyMembers,StrategyDetails,membersPanel,messagePnl,detail" oncomplete="hideOverlay();" />                        
                </div>   
            </div>
        </td>
        <td style="padding: 5px;">
            <div id="divDetails" style="height:550px; overflow: auto;">
                <apex:outputPanel id="detail" layout="block">
                    <div style="display: {!IF(defaultDetailId == detailId, 'none', 'block' )}"> <!--  Workaround to get related list hover to render -->
                        <apex:detail id="RecordDetail" title="false" inlineEdit="true" relatedList="true" showChatter="true" relatedListHover="true" subject="{!detailId}"/>
                    </div>
                 </apex:outputPanel>
            </div> 
            <div class="btg-force">
                <!-- Modals -->
                	 <div class="modal fade" id="myActivityModal" tabindex="-1" role="dialog" aria-labelledby="myActivityModalLabel" aria-hidden="true">
                      <div class="modal-dialog" style="width: 95%;">
                        <div class="modal-content">
                          <div class="modal-header">
                            <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                            <h4 class="modal-title" id="myActivityModalLabel">Activity</h4>
                          </div>
                          <div class="modal-body">
	                          	<apex:outputPanel id="activityFrame" layout="block">
		                    		<div id="divActvityFrame" style="display: {!IF($CurrentPage.parameters.asmid == null, 'none', 'block')}">
			                        	<apex:iframe src="{!IF($CurrentPage.parameters.asmid == null, '','/00T/e?who_id=' + $CurrentPage.parameters.asmid + '&isdtp=vw')}" scrolling="true" id="taskIframe"/>
		                    		</div>
		                    	</apex:outputPanel>
		                    	<apex:outputPanel id="logFrame" layout="block">
				                    <div id="divLogFrame" style="display: {!IF($CurrentPage.parameters.lsmid == null, 'none', 'block')}">
				                        <apex:iframe src="{!IF($CurrentPage.parameters.lsmid == null, '', '/00T/e?title=Call&who_id=' + $CurrentPage.parameters.lsmid + '&isdtp=vw&followup=1&tsk5=Call')}" scrolling="true" id="logIframe"/>
				                    </div>
				                </apex:outputPanel>
	                     </div>
	                     <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-default" data-dismiss="modal" onclick="refreshAfterActivity();">Close</button>
                          </div>
                        </div><!-- /.modal-content -->
                      </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                    
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                      <div class="modal-dialog" style="width: 95%;">
                        <div class="modal-content">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                          </div>
                          <div class="modal-body">
                                <apex:iframe src="" scrolling="true" id="modalFrame" width="100%"/>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
                          </div>
                        </div><!-- /.modal-content -->
                      </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                 <div class="modal fade" id="blueModal" tabindex="-1" role="dialog" aria-labelledby="blueModalLabel" aria-hidden="true">
                     <div class="modal-dialog" style="width: 75%;">
                       <div class="modal-content">
                         <div class="modal-header">
                           <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                           <h4 class="modal-title" id="blueModalLabel">Blue Theme</h4>
                         </div>
                         <div class="modal-body">                           
                             <div class="text-center">
                               <img width="90%" src="{!URLFOR($Resource.CallDownResources, 'CallDownResources/Blue_Theme.png')}" alt="Blue Theme" title="Blue Theme" />
                             </div>
                         </div>
                         <div class="modal-footer">
                           <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
                         </div>
                       </div><!-- /.modal-content -->
                     </div><!-- /.modal-dialog -->
                   </div><!-- /.modal -->
                   <div class="modal fade" id="grayModal" tabindex="-1" role="dialog" aria-labelledby="grayModalLabel" aria-hidden="true">
                     <div class="modal-dialog" style="width: 75%;">
                       <div class="modal-content">
                         <div class="modal-header">
                           <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                           <h4 class="modal-title" id="grayModalLabel">Gray Theme</h4>
                         </div>
                         <div class="modal-body">
                               <div class="text-center">
                                    <img width="90%" class="img-thumbnail" src="{!URLFOR($Resource.CallDownResources, 'CallDownResources/Gray_Theme.png')}" alt="Gray Theme" title="Gray Theme" />
                               </div>
                               
                         </div>
                         <div class="modal-footer">
                           <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
                         </div>
                       </div><!-- /.modal-content -->
                     </div><!-- /.modal-dialog -->
                   </div><!-- /.modal -->
            </div>
        </td>
     </tr>
     </table>
     </div>
     </div>
     </apex:form>
     <script type="text/javascript">        
        function hideFrames()
        {
            $("#divActvityFrame").attr('style','display:none');
            $("#divLogFrame").attr('style','display:none');
            refreshDetail();
        }
        
        function scrollUp()
        {
            $("#divDetails").animate({ scrollTop: 0 }, "fast");
        }
        
        function scrollUpList()
        {
            $("#divLists").animate({ scrollTop: 0 }, "fast");
        }
        
        function refreshDetail()
        {
            refreshDetailPanel();
            scrollUp();
        }
        
        function clearDetail()
        {
            clearDetailPanel();
        }
        
        function clearMessage()
        {
            clearMessagePanel();
        }
        
        function reloadPage()
        {
            window.location = window.location;
        }
        
        function select(divId)
        {
            $('.panel-primary').first().attr('class', 'panel panel-' + $('.panel-primary').first().attr('data-type'));
            $("#" + divId).attr('class', 'panel panel-primary');
        }
    
        function displayOverlay()
        {
            $("#overlay").attr('style','display: block;');
        }
    
        function hideOverlay()
        {
        	setLoadingLabel('Loading');
        	
            $("#overlay").attr('style','display: none;');
        }
        
        function refreshAfterActivity()
        {
            displayOverlay();
            
            refreshPanelsAfterActivity();
        }
        
        function dial(url, name, phone)
        {
        	console.log('Calling: ' + name + ' - ' + phone);
        	//setLoadingLabel('Calling: ' + name + ' - ' + phone)
            //displayOveray();
            
            try
            {
	            $.get(url, function( data ) {
	                    //$( ".result" ).html( data );
	                    //alert( "Call was performed." );
	                   // setLoadingLabel('Loading');
	            });
            }catch(e)
            {
            	//setLoadingLabel('Loading');
            	console.log('Error: ' + e);
            }
            
            
           	//hideOverlay();
        }
        
        function setLoadingLabel(labelText)
        {
        	//console.log('Label: ' + labelText);
        	$("#loadingLabel").html(labelText);
        }
        
        
        
        //$('#myActivityModal').modal();
        function displayActivityModal()
        {
        	$('#myActivityModal').modal({backdrop: 'static'});
        	//$('#myActivityModal').modal('show');	
        }
    </script>
</div><!-- app container -->
</apex:page>