<apex:page showHeader="false" sidebar="false" controller="SL_ctrl_VendorSearch">
	<apex:includeScript value="{!URLFOR($Resource.SL_VendorCommunity,'js/jquery.min.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.SL_VendorCommunity, 'js/jquery.dataTables.min.js')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.SL_VendorCommunity,'css/tableStyle.css')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.SL_VendorCommunity,'css/customTableStyle.css')}"/>
	<style type="text/css">
		.container{
			width: 85%;
			padding: 15px 0px 15px;
		}
        td a{
        	text-decoration: underline;
        }
	</style>
	<script>
        jQuery( function ($) {
		    $(document).ready( function() { 
	    		var opptyTable,
	    			schedTable,
	    			userTable,
			    	opptys = {!opptyResultsJSON},
			    	scheds = {!schedResultsJSON},
			    	users,
			    	opptysData = [],
			    	schedsData =[],
			    	usersData = [],
			    	opptyFieldSet = {!opptyFieldSetJSON},
			    	schedFieldSet = {!schedFieldSetJSON},
			    	userFieldSet,
			    	opptyColumns = [],
			    	schedColumns = [],
			    	userColumns = [];

			    for(var j = 0; j < opptyFieldSet.length; j++){
			    	opptyColumns.push({"data": opptyFieldSet[j].fieldPath, "defaultContent": "",});
		    	}
		    	for(var j = 0; j < schedFieldSet.length; j++){
			    	schedColumns.push({"data": schedFieldSet[j].fieldPath, "defaultContent": "",});
		    	}

			    for(var i = 0; i < opptys.length; i++){
			    	var temp = {};
			    	for(var j = 0; j < opptyFieldSet.length; j++){
			    		if(opptyFieldSet[j].type == "currency"){
			    			var n = Number(opptys[i][opptyFieldSet[j].fieldPath]);
		    				temp[opptyFieldSet[j].fieldPath] = "$" + n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,");
			    		}else if(opptyFieldSet[j].type == "datetime"){
			    			var d = new Date(opptys[i][opptyFieldSet[j].fieldPath]);
			    			temp[opptyFieldSet[j].fieldPath] = (d.getMonth() + 1) + '/' + d.getDate() + '/' + d.getFullYear();
			    		}else{
			    			temp[opptyFieldSet[j].fieldPath] = opptys[i][opptyFieldSet[j].fieldPath];
			    		}
			    	}
			    	temp['DT_RowId'] = opptys[i]['id'];
			    	opptysData.push(temp);
			    }

			    for(var i = 0; i < scheds.length; i++){
			    	var temp = {};
			    	for(var j = 0; j < schedFieldSet.length; j++){
			    		if(schedFieldSet[j].type == "currency"){
			    			var n = Number(scheds[i][schedFieldSet[j].fieldPath]);
		    				temp[schedFieldSet[j].fieldPath] = "$" + n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,");
			    		}else if(schedFieldSet[j].type == "datetime"){
			    			var d = new Date(scheds[i][schedFieldSet[j].fieldPath]);
			    			temp[schedFieldSet[j].fieldPath] = (d.getMonth() + 1) + '/' + d.getDate() + '/' + d.getFullYear();
			    		}else{
			    			temp[schedFieldSet[j].fieldPath] = scheds[i][schedFieldSet[j].fieldPath];
			    		}
			    	}
			    	temp['DT_RowId'] = scheds[i]['id'];
			    	schedsData.push(temp);
			    }

			    //initialize datatables
			    opptyTable = $('#opptyList').dataTable( {
			        "data": opptysData,
			        "columns" : opptyColumns
			    } );

			    schedTable = $('#schedulesList').dataTable( {
			        "data": schedsData,
			        "columns" : schedColumns
			    } );

		    });
		});
    </script>
	<apex:composition template="SL_VendorTemplate">
		<apex:define name="mainSection">
			<div class="container">
				<apex:message style="color:red;"/>
				<h2>Opportunities</h2><br/><br/>
				<table id="opptyList" class="display" cellspacing="0" width="100%">
			    	<thead>
			            <tr>
			            	<apex:repeat value="{!$ObjectType.Opportunity.FieldSets.FAEF_Vendor_Opportunity_Listview}" var="o"> 
		                        <th><apex:outputtext value="{!o.Label}"></apex:outputtext></th>
						    </apex:repeat>
			            </tr>
			        </thead>
			 
			        <tfoot>
			            <tr>
			            	<apex:repeat value="{!$ObjectType.Opportunity.FieldSets.FAEF_Vendor_Opportunity_Listview}" var="o"> 
		                        <th><apex:outputtext value="{!o.Label}"></apex:outputtext></th>
						    </apex:repeat>
			            </tr>
	            	</tfoot>
			    </table>
			    <br/><hr/><br/>
			    <h2>Schedules</h2><br/><br/>
			    <table id="schedulesList" class="display" cellspacing="0" width="100%">
			    	<thead>
			            <tr>
			            	<apex:repeat value="{!$ObjectType.Schedule__c.FieldSets.FAEF_Vendor_Schedule_Listview}" var="o"> 
		                        <th><apex:outputtext value="{!o.Label}"></apex:outputtext></th>
						    </apex:repeat>
			            </tr>
			        </thead>
			 
			        <tfoot>
			            <tr>
			            	<apex:repeat value="{!$ObjectType.Schedule__c.FieldSets.FAEF_Vendor_Schedule_Listview}" var="o"> 
		                        <th><apex:outputtext value="{!o.Label}"></apex:outputtext></th>
						    </apex:repeat>
			            </tr>
	            	</tfoot>
			    </table>
			</div>
		</apex:define>
	</apex:composition>
</apex:page>