<apex:page controller="CustomChatterSearchController" extensions="CustomChatterPdfExportExtension" showChat="false" tabStyle="NewsFeed">
<apex:pageMessages id="pgMsg" ></apex:pageMessages>
<!-- <head> -->
  <apex:stylesheet value="{!$Resource.ChatterPageCSS}"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script>
      function checkEnter(e){
          if(e && e.keyCode == 13)
          {
              e.preventDefault();
              document.getElementById('searchbutton').onclick();
          }
      }
      function CommentFeed(feedId){
       
       if($('.'+feedId).val() == '' ){
        alert('Please enter text to comment.');
        return;
       }
       else{
       commentAdhocFeed(feedId,$('.'+feedId).val());
       }
      }
      $(document).ready(function() {
		var imgTri = document.getElementById('img_j_id0:j_id31:j_id141:j_id145');
		var imgTriDefault = document.getElementById('img_j_id0:j_id31:j_id49:j_id53');
		
		if(imgTri){
			twistSection(imgTri);
		}
		if(imgTriDefault){
			twistSection(imgTriDefault);
		}
	  });
  </script>
  <style>
    div.helpText{
        top: 300px !important;
    }
   
    .feedHr{
    background-color: #D4DADB;
    border-width: 0;
    color: #D4DADB;
    min-height: 1px;
  }
  .customeFeedContainer{
  	background: none repeat scroll 0 0 #EFF7FA;
    border-bottom: 1px solid #DEE5EA;
    border-top: 1px solid white;
  }
  .commentBtn{
  	background: linear-gradient(#FFFFFF, #F0F0F0) repeat scroll 0 0 transparent;
    border-color: #C3C3C3 #AAAAAA #909090;
    border-image: none;
    border-radius: 3px 3px 3px 3px;
    border-style: solid;
    border-width: 1px;
    color: #222222;
    font-size: 0.917em;
    font-weight: bold;
    text-decoration: none;float: right;
    margin: 10px 0 0;
	padding: 2px 3px;
	font-family: inherit;
	cursor: pointer;
  }
  </style>
<!-- </head> -->

  <!-- <chatter:feedWithFollowers entityId="{!$User.Id}" showHeader="false"/> -->
  <apex:sectionHeader title="Chatter Feeds"/>
  
  <apex:outputPanel >
      <apex:form >
                    <apex:actionFunction name="commentAdhocFeed" action="{!commentAdhocFeed}"  rerender="chatterList">
                        <apex:param name="feedItemId" assignTo="{!feedItemId}" value="" />
                         <apex:param name="feedCommentText" assignTo="{!feedCommentText}" value="" />
                    </apex:actionFunction>
<!--               <apex:actionFunction name="search" action="{!searchChatterList}" reRender="chatterList"/> -->
              <table width="90%">
                  
                  <tr>
                      <td width='50%'>
                          <apex:commandbutton id="searchbutton"  value="Search" action="{!searchChatterList}" status="searchStatus" reRender="chatterList,pgMsg"/> 
                          &nbsp;<apex:inputText style="width:60%;" value="{!searchTag}" onkeydown="checkEnter(event)" alt="Enter HashTag" id="searchinput"/>
                         <apex:outputpanel id="TagsStatus">
                            <apex:actionstatus id="searchStatus">
                                        <apex:facet name="start">     
                                            <span style="color:red;font-weight:bold;">Searching Tags...</span> 
                                            <img src="/img/loading.gif" alt="." />
                                        </apex:facet>
                                    </apex:actionstatus>   
                         </apex:outputpanel>
                      </td>
                      <td style="text-align:right;">
                      
                          <apex:outputLabel >Date Range : </apex:outputLabel>
                          <apex:selectList label="Date Range" title="Date Range" value="{!dateRange}"  size="1" styleClass="selectDate">
                              <apex:actionSupport event="onchange" status="searchStatus" action="{!changeDateAndSearch}" reRender="chatterList,pgMsg"/>
                              <apex:selectOption itemLabel="All" itemValue="all"/>
                              <apex:selectOption itemLabel="This Week" itemValue="thisweek"/>
                              <apex:selectOption itemLabel="Last Week" itemValue="lastweek"/>
                              <apex:selectOption itemLabel="This Month" itemValue="thismonth"/>
                              <apex:selectOption itemLabel="Last Month" itemValue="lastmonth"/>
<!--                               <apex:selectOption itemLabel="Custom Date" itemValue="customdateweek"/> -->
                          </apex:selectList>  
<!--                           <apex:commandButton value="Email" reRender="emailPanel,DefaultSettingPanel" action="{!setEmailTrue}" />   -->
<!--                           <apex:commandButton value="Export" action="/apex/ChatterPagePdf" /> -->
                      </td>
                  </tr>
                  <tr>
                      <td colspan="2">
                       <apex:outputPanel id="DefaultSettingPanel" >
                          <apex:pageBlock mode="maindetail" rendered="{!showEmail == true && editMode == false}">
                               <apex:pageBlockButtons location="bottom">
                                  <apex:commandButton value="Edit Settings" action="{!editSettings}" status="loadingStatus" reRender="emailPanel,DefaultSettingPanel"/>
                                    <apex:actionstatus id="loadingStatus">
                                        <apex:facet name="start">     
                                            <span style="color:red;font-weight:bold;">Loading Settings ...</span> 
                                            <img src="/img/loading.gif" alt="." />
                                        </apex:facet>
                                    </apex:actionstatus>
                              </apex:pageBlockButtons>
                               <apex:pageBlockSection title="Default Values" >
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Subject</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.Subject__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Message</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.Message__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >File Name</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.FileName__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Next Schedule Day</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.Day__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Next Schedule Hour</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.Next_Schedule_HR__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >AM/PM</apex:outputLabel>
                                        <apex:outputtext value="{!defaultSetting.AM_PM__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Ad-hoc Emails</apex:outputLabel>
                                        <apex:outputtext style="width:200px" value="{!defaultSetting.Ad_hoc_Emails__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Mail Reply To</apex:outputLabel>
                                        <apex:outputtext style="width:155px" value="{!defaultSetting.Mail_Reply_To__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Sender Dispaly Text</apex:outputLabel>
                                        <apex:outputtext style="width:155px" value="{!defaultSetting.Display_Text__c}"/>
                                    </apex:pageBlockSectionItem>
                              </apex:pageBlockSection>
                          </apex:pageBlock>
                          <apex:pageBlock mode="maindetail" rendered="{!showEmail == true && editMode == true}">
                               <apex:pageBlockButtons location="bottom">
                                  <apex:commandButton value="Save Settings" action="{!updateSettings}" status="updatingStatus" reRender="emailPanel,DefaultSettingPanel"/>
                                  <apex:commandButton value="Cancel" action="{!cancelSettings}"  reRender="emailPanel,DefaultSettingPanel"/>     
                                     <apex:actionstatus id="updatingStatus">
                                        <apex:facet name="start">     
                                            <span style="color:red;font-weight:bold;">Updating Settings ...</span> 
                                            <img src="/img/loading.gif" alt="." />
                                        </apex:facet>
                                    </apex:actionstatus>
                              </apex:pageBlockButtons>
                               <apex:pageBlockSection title="Default Values" >
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Subject</apex:outputLabel>
                                        <apex:inputfield value="{!defaultSetting.Subject__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Message</apex:outputLabel>
                                        <apex:inputfield value="{!defaultSetting.Message__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >File Name</apex:outputLabel>
                                        <apex:inputfield value="{!defaultSetting.FileName__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Next Schedule Day</apex:outputLabel>
                                        <apex:outputpanel >
                                           <apex:selectList value="{!selectedweekDays}" size="1">
                                                <apex:selectOptions value="{!weekDays}"/>
                                           </apex:selectList><p/>
                                        </apex:outputpanel>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Next Schedule Hour</apex:outputLabel>
                                        <apex:outputpanel >
                                           <apex:selectList value="{!selectedweekHr}" size="1">
                                                <apex:selectOptions value="{!weekHr}"/>
                                           </apex:selectList><p/>
                                        </apex:outputpanel>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >AM/PM</apex:outputLabel>
                                        <apex:outputpanel >
                                           <apex:selectList value="{!selectedamPm}" size="1" >
                                                <apex:selectOptions value="{!amPm}"/>
                                           </apex:selectList><p/>
                                        </apex:outputpanel>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Ad-hoc Emails</apex:outputLabel>
                                        <apex:inputfield style="width:200px" value="{!defaultSetting.Ad_hoc_Emails__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Mail Reply To</apex:outputLabel>
                                        <apex:inputfield style="width:155px" value="{!defaultSetting.Mail_Reply_To__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Sender Dispaly Text</apex:outputLabel>
                                        <apex:inputfield style="width:155px" value="{!defaultSetting.Display_Text__c}"/>
                                    </apex:pageBlockSectionItem>
                              </apex:pageBlockSection>
                          </apex:pageBlock>
                      </apex:outputPanel>
                      <apex:outputPanel id="emailPanel" >
                      <apex:pageBlock mode="maindetail" rendered="{!showEmail == true}">
                          <apex:pageBlockButtons location="bottom">
                              <apex:commandButton value="Email"  action="{!sendPdf}"/>
                              <apex:commandButton value="Cancel" action="{!setEmailFalse}" reRender="emailPanel,DefaultSettingPanel"/>
<!--                                <apex:commandButton value="Show Html" action="{!showhtml}"/> -->
                          </apex:pageBlockButtons>
                          <apex:pageBlockSection title="Email" >
                             <apex:pageBlockSectionItem >
<!--                                        <apex:outputLabel >Email ID</apex:outputLabel> -->
<!--                                        <apex:inputText id="EmailID" style="width:300px" value="{!email}" required="true"/> -->
                                   
                                       <apex:outputLabel >Email Group</apex:outputLabel>
                                       <apex:outputpanel >
                                       <apex:selectList value="{!selectedGroupId}" size="1">
                                            <apex:selectOptions value="{!groupOptions}"/>
                                       </apex:selectList><p/>
                                  </apex:outputpanel>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                       <apex:outputLabel >Ad-hoc Emails
                                           
                                       </apex:outputLabel>
                                       <apex:outputpanel >
                                        <table>
                                            <tr>
                                                <td>
                                                    <span id="Contact.Email-_help" class="helpButton">
                                                        <img title="" class="helpOrb" style="right: -1px;" alt="" src="/s.gif"/>
                                                        <script type="text/javascript">sfdcPage.setHelp('Contact.Email', 'Email address seprated by semicolon(;)');
                                                        </script>
                                                    </span>
                                                </td>
                                                <td>
                                                        <apex:inputfield style="width:200px" value="{!mailGroup.Ad_hoc_Emails__c}"/>
                                                </td>
                                            </tr>
                                        </table>
                                       
                                       </apex:outputpanel>
                              </apex:pageBlockSectionItem>
<!--                               &nbsp; -->
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >Mail Send On</apex:outputLabel>
                                  <apex:inputfield value="{!mailGroup.Mail_Send_On__c}"/>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >Subject</apex:outputLabel>
                                  <apex:inputText style="width:300px" value="{!mailGroup.Subject__c}"/>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >File Name</apex:outputLabel>
                                  <apex:inputText value="{!mailGroup.File_Name__c}" required="true"/>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >Message</apex:outputLabel>
                                  <apex:inputTextarea style="width:300px;"  value="{!mailGroup.Message__c}"/>
                              </apex:pageBlockSectionItem>
                             
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >Include This Message In Mail</apex:outputLabel>
                                  <apex:inputfield value="{!mailGroup.Include_Custom_Message__c}"/>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                  <apex:outputLabel >Mail Reply To</apex:outputLabel>
                                  <apex:inputfield style="width:250px;" value="{!mailGroup.Mail_Reply_To__c}"/>
                              </apex:pageBlockSectionItem>
                              <apex:pageBlockSectionItem >
                                        <apex:outputLabel >Sender Dispaly Text</apex:outputLabel>
                                        <apex:inputfield style="width:155px" value="{!mailGroup.Display_Text__c}"/>
                              </apex:pageBlockSectionItem>
                          </apex:pageBlockSection>
                      </apex:pageBlock>
                      </apex:outputPanel>
                      </td>
                  </tr>
                  <tr>
                      <td colspan="10">
                          <hr class="feedHr"/>
                      </td>
                  </tr>
                  
              </table>
          
      </apex:form>
  </apex:outputPanel>
  
  
  
  <apex:outputPanel layout="block" id="chatterList">
     <apex:form >
<!--      ----------------------------------This Block Is Under Development------------------------------------ -->
     <table width="100%" border="0" style="font-size:12px;font-family:Arial;color:#222">
    	<tbody>
    			<apex:repeat value="{!newsFeed}" var="feed">
    				<tr style="vertical-align:top">
						<td valign="top" style="text-align:left;vertical-align:top">
								<apex:image url="{!mapOfPhoto[feed.CreatedById]}" styleClass="feedImage" width="45"  height="45"/>
						</td> 
						<td>&nbsp;</td>
						<td width="100%" valign="top" style="vertical-align:top">
							<table width="90%" border="0" style="font-size:12px;font-family:Arial;color:#222">
							<tr valign="top">
								<td style="text-align:left">
									<apex:outputpanel style="word-wrap:break-word;text-align:left;color:#015ba7;font-size:12px">
                         				 <apex:outputLink style="text-decoration:none;color:#015ba7;" rendered="{!mapOfParentName[feed.ParentId] == 'Case'}" value="mailto:{!feed.CreatedBy.email}?subject={!defaultSetting.Subject__c}">{!mapOfParentList[feed.ParentId].CaseNumber}</apex:outputLink>
                        				<apex:outputLink style="text-decoration:none;color:#015ba7;" rendered="{!mapOfParentName[feed.ParentId] != 'Case'}" value="mailto:{!feed.CreatedBy.Email}?subject={!defaultSetting.Subject__c}">{!mapOfParentList[feed.ParentId].Name}</apex:outputLink>
									</apex:outputpanel>
								</td>
								<td valign="top" nowrap="" style="text-align:right">
								  <apex:outputtext style="color:#7d7d84;font-size:11px;font-family:Arial" value="{0,date,E MMM dd,yyyy}">
                           				<apex:param value="{!feed.CreatedDate}" />
                     			 </apex:outputtext>                        
								</td>
							</tr>
							<tr>
								<td width="100%" valign="top" colspan="2">   
								 	<apex:outputPanel rendered="{!mapOfParentName[feed.ParentId] != 'Case' && mapOfParentName[feed.ParentId] != 'ContentDocument'} && mapOfParentName[feed.ParentId] != 'Dashboard'">
                          				<apex:outputText rendered="{!feed.CreatedBy.Name != mapOfParentList[feed.ParentId].Name}" value=" - {!feed.CreatedBy.Name}" ></apex:outputText>
                      				</apex:outputPanel>
                     				<apex:outputPanel rendered="{!mapOfParentName[feed.ParentId] == 'ContentDocument' || mapOfParentName[feed.ParentId] == 'Dashboard'}">
                          				<apex:outputText rendered="{!feed.CreatedBy.Name != mapOfParentList[feed.ParentId].Title}" value=" - {!feed.CreatedBy.Name}" ></apex:outputText>
                          				
                      				</apex:outputPanel>
								</td>
							</tr>
							<tr>
								<td width="80%" valign="top" colspan="2">   
								<apex:outputlabel escape="false" value="{!commentHtmlMap[feed.id]}"></apex:outputlabel>
<!-- 									<apex:outputText styleclass="feeditemtext cxfeeditemtext" escape="false" value="{!feed.Body}"></apex:outputText> -->
								</td>
							</tr>
							</table>
							<apex:repeat value="{!mapOfComment[feed.id]}" var="comm">
							  <table width="90%" border="0" style="border-collapse: collapse;font-size:12px;font-family:Arial;color:#222">
							    <tbody>
										<tr style="vertical-align:top">
											<td width="55">&nbsp;</td>
											<td class="customeFeedContainer" valign="top" style="text-align:center;vertical-align:top">
													<apex:image url="{!mapOfPhoto[comm.CreatedBy.Id]}" width="30" height="30" alt="{!comm.CreatedBy.Name}"/>
											</td>                
											<td class="customeFeedContainer" width="90%" valign="top" style="vertical-align:top">
												<table width="100%" border="0">
													<tbody>
														<tr valign="top">
														<td style="text-align:left">
															<span style="word-wrap:break-word;text-align:left;font-family:Arial;color:#015ba7;font-size:12px">
																{!comm.CreatedBy.Name}
															</span>
														</td>
														<td valign="top" nowrap="" style="text-align:right">
															 <apex:outputtext style="color:#7d7d84;font-size:11px;font-family:Arial" value="{0,date,E MMM dd,yyyy}">
                           										<apex:param value="{!comm.CreatedDate}" />
                     			 							 </apex:outputtext>                        
														</td>
													</tr>
													<tr>
														<td valign="top" colspan="2">   
																<apex:outputLabel escape="false" style="font-size:12px;color:#222222;font-family:Arial" value="{!commentHtmlMap[comm.id]}"></apex:outputLabel>
														</td>
													</tr>
												</tbody>
												</table>
											</td>
										</tr>
<!-- 										<tr> -->
<!-- 											<td></td> -->
<!-- 											<td colspan="3"> -->
<!-- 												<hr noshade="" style="color:#d4dadb;background-color:#d4dadb;min-height:1px;border-width:0"/> -->
<!-- 											</td> -->
<!-- 										</tr> -->
								</tbody>
							  </table>
							</apex:repeat>
							<table width="90%" border="0" style="border-collapse: collapse;font-size:12px;font-family:Arial;color:#222">
							<tbody>
								<tr style="vertical-align:top">
										<td width="55">&nbsp;</td>
										<td class="customeFeedContainer" valign="top" style="text-align:center;vertical-align:top">
												<apex:image url="{!currentUser.SmallPhotoUrl}" width="30" height="30" alt="{!currentUser.Name}"/>
										</td>                
										<td class="customeFeedContainer" width="90%" valign="top" style="vertical-align:top">
											<div >
												<div >
													<apex:inputfield value="{!newFeedComment.CommentBody}"  styleClass="foobar cxnewcommenttext chatterMentionsEnabled chatterHashtagsEnabled   cxiswired {!feed.id}" id="newsFeedId"  style="min-height: 32px;"/>
												</div>
												<div  style="width:165px;">
														<input style="float: right;  margin: 10px 0 0 0;" type="button" onclick="CommentFeed('{!feed.id}');" title="Comment" value="Comment" class="commentBtn" id="ext-gen5"></input>
												</div> 
												<div style="padding-top: 16px;">
												<apex:outputLink style="text-decoration:none;color:#015ba7;" value="mailto:{!feed.CreatedBy.Email}?subject={!defaultSetting.Subject__c}">Reply by email</apex:outputLink>
												</div>
<!-- 												<div class="feedclearfloat"></div> -->
											</div>
										</td>
									</tr>
							</tbody>
						</table>
						</td>
					</tr>
    			</apex:repeat>
    	</tbody>
     </table>
<!--      ----------------------------------This Block Is Under Development------------------------------------ -->
   </apex:form>   
  </apex:outputPanel>
</apex:page>