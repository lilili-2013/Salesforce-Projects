<apex:page standardController="ts2__s_UserList__c" extensions="ts2.s_UserListController" action="{!LoadAction}" title="{!$ObjectType.ts2__s_UserList__c.Label+': '+ts2__s_UserList__c.Name}">
	<apex:includeScript value="{!URLFOR($Resource.ts2__jQuery, 'jquery-1.8.2.min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.ts2__SSearch, 'res/js/s_popup_windows.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.ts2__stcode, 'res/js/ui-2.js')}" />

	<apex:stylesheet value="{!URLFOR($Resource.ts2__stcode, 'res/css/ui-2.css')}"/>

<script>
	var sResultItemApiName = '{!$ObjectType.s_ResultItem__c.Name}';
</script>

<apex:form id="frm" onKeyPress="return(event.keyCode!=KEY_ENTER);" >
	<apex:pageMessages id="pageMessages" />

	<apex:sectionHeader title="{!$ObjectType.ts2__s_UserList__c.Label}" subtitle="{!ts2__s_UserList__c.Name}" />

	<apex:pageBlock title="{!$Label.ShortList_LABEL_ShortListDetail}" mode="maindetail">
		<apex:pageBlockButtons location="top">
			<apex:commandButton value="{!$Label.ShortList_BTN_Edit}" title="{!$Label.ShortList_BTN_Edit}" action="{!edit}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_Delete}" title="{!$Label.ShortList_BTN_Delete}" action="{!delete}" />
		</apex:pageBlockButtons>
		<apex:pageBlockSection columns="2">
			<apex:outputField value="{!ts2__s_UserList__c.Name}" />
			<apex:outputField value="{!ts2__s_UserList__c.ts2__description__c}" />
		</apex:pageBlockSection>
	</apex:pageBlock>

	<c:s_TaxonomySelector pager="{!pager}" id="FilterPanel" />

	<apex:pageBlock id="ShortListPageBlock" title="{!$ObjectType.Contact.LabelPlural}">
		<apex:pageBlockButtons location="top" >
			<apex:commandButton value="{!$Label.ShortList_BTN_RemoveContacts}" title="{!$Label.ShortList_BTN_RemoveContacts}" action="{!removeSelectedContactsFromList}" onclick="if(!validateRemoveCandidates()){return(false)}else{jQuery('[id$=frm] input.btn').attr('disabled','disabled').addClass('btnDisabled');LoadingElementShow(jQuery('[id$=ShortListPageBlock]').find('div.pbBody').get(0), '{!$Label.Candidates_LABEL_Deleting}');}" rerender="ShortListPageBlock" oncomplete="jQuery('[id$=frm] input.btn').removeAttr('disabled').removeClass('btnDisabled');" />
			<apex:commandButton value="{!$Label.ShortList_BTN_AddContact}" title="{!$Label.ShortList_BTN_AddContact}" onclick="openWindowJSAndPrepareSelection('openUListAddContactWindow',false,'{!$Page.ts2__s_UserListContactPopup}','{!ts2__s_UserList__c.Id}');return(false);" />
			<apex:commandButton value="{!$Label.ShortList_BTN_SendEmail}" title="{!$Label.ShortList_BTN_SendEmail}" onclick="openWindowJSAndPrepareSelection('openSendEmailWindow',true,'{!$Page.ts2__email_manager}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Send_Email__c || ISBLANK($Setup.Short_List__c.Id)}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_SendSMS}" title="{!$Label.ShortList_BTN_SendSMS}" onclick="openWindowJSAndPrepareSelection('openSendSMSWindow',true,'{!$Page.ts2__s_UserList_E}','{!ts2__s_UserList__c.Id}'); return(false);" rendered="{!isSMSPackageExists}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_ApplyToJobs}" title="{!$Label.ShortList_BTN_ApplyToJobs}" onclick="openWindowJSAndPrepareSelection('openApplyToWindow',true,'{!$Page.ts2__ApplyJobPage}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Apply_to_Jobs__c || ISBLANK($Setup.Short_List__c.Id)}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_AddSkills}" title="{!$Label.ShortList_BTN_AddSkills}" onclick="openWindowJSAndPrepareSelection('openSkillsWindow',true,'{!$Page.ts2__add_skills_temp}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Add_Skills__c || ISBLANK($Setup.Short_List__c.Id)}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_AddTags}" title="{!$Label.ShortList_BTN_AddTags}" onclick="openWindowJSAndPrepareSelection('openAddTagsWindow',true,'{!$Page.ts2__AddTagsCandidate}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Add_Tags__c || ISBLANK($Setup.Short_List__c.Id)}" />
			<apex:commandButton value="{!$Label.ShortList_BTN_AddToAnotherList}" title="{!$Label.ShortList_BTN_AddToAnotherList}" onclick="openWindowJSAndPrepareSelection('openAddToListWindow',true,'{!$Page.ts2__AddToList}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Add_to_List__c || ISBLANK($Setup.Short_List__c.Id)}" />
			<apex:commandButton value="{!$Label.ReviewEmailTitle}" title="{!$Label.ReviewEmailTitle}" onclick="openWindowJSAndPrepareSelection('openReviewWindow',true,'{!$Page.ts2__ReviewCandidates}','{!ts2__s_UserList__c.Id}');return(false);" rendered="{!$Setup.Short_List__c.Enable_Review_Email__c || ISBLANK($Setup.Short_List__c.Id)}" />
		</apex:pageBlockButtons>

		<apex:outputPanel id="PagerItemsPanel">
			<apex:pageBlockTable id="ContactList" value="{!pager.PageOfItems}" var="pageItem" cellpadding="6" width="100%" border="0" >
				<apex:column rendered="{!pager.ResultSize > 0}" width="23px" >
					<apex:facet name="header">
						<apex:inputCheckbox value="{!pager.IsWholePageSelected}" onclick="Paginator.SelectAll(this)" />
					</apex:facet>
					<apex:inputCheckbox value="{!pageItem.selected}" onclick="Paginator.SelectionChange(this)" />
				</apex:column>
				<apex:repeat value="{!pager.QueryFieldList}" var="fs">
					<apex:column rendered="{!pager.ResultSize > 0}" >
						<apex:facet name="header"><apex:outputText value="{!$ObjectType.Contact.fields[fs].Label}" /></apex:facet>
						<apex:outputField value="{!pageItem.sobj[fs]}" rendered="{!NOT($ObjectType.Contact.Fields[fs].NameField) && NOT($ObjectType.Contact.Fields[fs].Calculated && $ObjectType.Contact.Fields[fs].Type='string')}" style="{!IF(CONTAINS(fs,'Skill_Codes__c') || CONTAINS(fs,'Experience_Summary__c'),'word-wrap:break-word;','')}" />
						<apex:outputLink value="/{!pageItem.sobj.Id}" target="_blank" rendered="{!$ObjectType.Contact.Fields[fs].NameField}"><apex:outputField value="{!pageItem.sobj['Name']}" /></apex:outputLink>
						<apex:outputText value="{!pageItem.sobj[fs]}" rendered="{!$ObjectType.Contact.Fields[fs].Calculated && $ObjectType.Contact.Fields[fs].Type='string'}" escape="false" />
					</apex:column>
				</apex:repeat>
				<apex:column rendered="{!pager.ResultSize = 0}" headerValue="{!$Label.ShortList_LABEL_ShortListIsEmpty}" headerClass="noRowsHeader" />
			</apex:pageBlockTable>
			<div style="display:none;" class="waitingSearchDiv waitingSearchDivOpacity"></div>
			<div style="display:none;" class="waitingSearchDiv"><span class="waitingSearchHolder" style="top:16px;"><img src="/img/loading.gif" class="waitingImage"/><span class="waitingDescription"></span></span></div>
		</apex:outputPanel>

		<c:s_ColumnSelector pager="{!pager}" id="PaginationPanel" />

	</apex:pageBlock>

	<apex:actionFunction action="{!pager.PrepareResultItemSelectionAction}" name="PrepareResultItemSelection" rerender="PagerItemsPanel,PaginationPanel,pageMessages" oncomplete="jQuery('[id$=frm] input.btn').removeAttr('disabled').removeClass('btnDisabled');openWindowJS('{!JSENCODE(pager.ResultItemId)}','{!JSENCODE(pager.PageParamIn)}');">
		<apex:param name="PageSizeIn" assignTo="{!pager.PageParamIn}" value="" />
	</apex:actionFunction>

</apex:form>

<script>
	jQuery.noConflict();
	var Paginator = new PaginatorInstance("ContactList");
	jQuery(document).ready(function() {
		gfxInit();
	});

	function gfxInit() {
		a1=new Image; a1.src="{!URLFOR($Resource.stcode, 'res/img/spinner.gif')}";
		a2=new Image; a2.src="/img/loading.gif";
	}

	function validateRemoveCandidates() {
		var selectionCount = Paginator.GetSelectionSize();
		if (selectionCount == 0) {
			alert('{!JSENCODE($Label.Candidates_LABEL_YouMustSelectAtLeastOne)}');
			return false;
		}
		return confirm('{!JSENCODE($Label.ShortList_LABEL_DeleteContactsConfirmation)}'.replace('{0}',selectionCount));
	}
</script>

<script>
	function openWindowJSAndPrepareSelection(funcName, requireSelection, param1, param2) {
		var pageParam = funcName + '~' + param1 + '~' + param2;
		if (requireSelection) {
			if (funcName == 'openSendSMSWindow') {
				if (Paginator.GetSelectionSize() > 1) {
					alert('{!JSENCODE($Label.Candidates_LABEL_YouMustSelectOnlyOne)}');
					return;
				}
			}
			if (Paginator.GetSelectionSize() > 0) {
				jQuery('[id$=frm] input.btn').attr('disabled','disabled').addClass('btnDisabled');
				LoadingElementShow(jQuery("[id$=ShortListPageBlock]").find("div.pbBody").get(0), '{!JSENCODE($Label.Candidates_LABEL_Loading)}');
				PrepareResultItemSelection(pageParam);
			}
			else {
				alert('{!JSENCODE($Label.Candidates_LABEL_YouMustSelectAtLeastOne)}');
			}
		}
		else {
			openWindowJS(undefined, pageParam);
		}
	}

	function openWindowJS(ResultItemId, pageParam) {
		var pageParams = pageParam.split('~');
		var funcName = pageParams[0];
		var param1 = pageParams[1];
		var param2 = pageParams[2];
		window[funcName](param1,param2,ResultItemId);
	}
</script>

</apex:page>