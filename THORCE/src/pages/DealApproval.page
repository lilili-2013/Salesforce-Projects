<apex:page docType="html-5.0" Controller="DealApprovalCtrl" showHeader="false" sidebar="false" standardStylesheets="false"  >
	<apex:stylesheet value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'jquery.mobile-1.3.0.min.css')}"/>
	<apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'jquery-1.9.1.min.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'jquery.mobile-1.3.0.min.js')}"/>
	<!--  <apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'cordova.force.js')}"/>-->
	<apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'backbone/underscore-1.4.4.min.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'force.entity.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.MobileSample_Resources_jQueryMobile, 'SObjectData.js')}"/>
	
	<script src="//ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"/>

	<head>

		<title>Thor Leasing Deal Approval</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<style>
			html {height:100%}
			body {margin:0}

			body.wait, body.wait * { cursor: wait !important; }
		</style>		
		
		<!-- NOTE: Custom styling is included within the page as a component as opposed to a .css file to avoid JQM styling overriding custom styling -->
		<c:DealApprovalCss />	
					
		<script>
			$(document).ready(function () {
				var oppTest = '{!dealForApproval.Name}';
				//alert('opp = ' + '{!$CurrentPage.parameters.dealId}');
				if(oppTest != ''){ 
				   $.mobile.changePage( "#detailPage", { transition: "none"} ); 
				}

			});

			function outsideFn()
			{
				//alert("outside funtion" + document.getElementById(tid).value); 
				//alert("outside function" + $('[name=dealfield]').val());
				getDeal($('[name=dealfield]').val());
				
				//window.location.hash='topofpage';
			}

//			$(".ui-input-clear").keydown(function() {
//				alert('search typing');
//			});
					
			//Prevent the backspace key from navigating back within the browser unless we're in a text field (requested feature)	
			$(document).keydown( function(e){  
			  var target = $( e.target );
			  if(e.which == 8 && !target.is(":text") && !target.is("textarea") ) {  
			    e.preventDefault();  
			    return false;   
			  } 
			});

			$(".ui-input-text").change(function() {
				alert("on text change");
			});
			
			//If no rows are dislayed after updating the search filter, display text "No results were found"
			setInterval(function() {
			    var optCount = $("#newlist li:visible").size();
			
			    if(optCount < 1) {
			        $("#no-results").show(); 
			    }
			    else {
			        $("#no-results").hide(); 
			    }
			}, 100);

//			$('document').ready(function(){
//				$("#comments").blur(function() {
//					//alert('textarea lost focus');	 
//						 
//					//Close the keyboard control; doesn't always close automatically when the popup is closed
//					//$("#focusdiv").focus();
//					$("input").blur();
//					document.activeElement.blur();
//				});
//			});

		var busyCursorOn = function() {
			$('body').addClass('wait');
		};
		
		var busyCursorOff = function() {
			$('body').removeClass('wait');
		};
		</script>
	</head>
	<body>

		<apex:form >
			<apex:actionFunction name="getDeal" action="{!getSelectedDeal}" reRender="output1" status="busyCursor" >
				<apex:param assignTo="{!dealId}" name="dealId" value=""/>
			</apex:actionFunction>
			
			
			<div id="detailPage" data-role="page" class="ui-responsive-panel">
				<div id="content-header" data-role="header">
					<table width="100%">
						<tr>
							<!--  <td width="25%" align="left"><a class="custom-link custom-link-left" data-bind="click: homePage" id="menu2" >&lt; Menu</a></td>-->
							
							<td width="25%" align="left" valign="middle"><a class="ui-btn-left" data-role="button" data-theme="c" data-bind="click: homePage" id="menu2" >&lt; Menu</a></td>
							<td width="50%" align="center"><br/><h2>Leasing Deal Approval</h2></td>
							<td width="25%" align="right" valign="middle"><a class="ui-btn-right" data-role="button" data-theme="c" href='#approval-popup' id="approve-button" data-rel="popup" data-position-to="window" style="visibility:hidden">Approve / Reject</a></td>
							
							<!--  <a data-bind="click: homePage" id="menu2" class='ui-btn-left' data-icon='bars' data-theme="a">Menu</a>-->
							<!--  <a href='#approval-popup' id="approve-button" class='ui-btn-right' data-icon='bars' data-theme="a" data-rel="popup" data-position-to="window" style="visibility:hidden">Approve / Reject</a>-->
						</tr>
					</table>
				</div>
					
				<div id="maincontent" data-role="content" class="ui-content" >
	
					<input id="dealfield" name="dealfield" onchange="outsideFn();" type="hidden" />
					<!--  <p><apex:outputField value="{!dealForApproval.Name}" id="dealname" /></p>-->
					
					<apex:pageBlock id="output1"> 
						<apex:actionStatus id="busyCursor" onStart="busyCursorOn()" onStop="busyCursorOff()"/>
						<a id="topofpage" />
						<c:DealApprovalOfficeLeasingLayout parentId="{!dealId}" rendered="{!isOfficeDealSheet}" />
						<c:DealApprovalMemoLayout parentId="{!dealId}" rendered="{!isDealMemoSheet}" />
						<c:DealApprovalRetailLeasingLayout parentId="{!dealId}" rendered="{!isLeasingDealSheet}"/>
						<c:DealApprovalAmendmentLeasingLayout parentId="{!dealId}" rendered="{!isLeasingAmendmentDealSheet}" />
					</apex:pageBlock>
				</div>
					
				<div id="leftPanel" data-role="panel" data-display="reveal">
					<div id = "menu-panel" class="inner-panel">
						<ul data-role="listview" class="approval-list">
							<li data-role="list-divider">Pending Approvals</li>
							<li><a data-bind="click: AllApprovals"> All </a></li>
							<li><a data-bind="click: AllApprovalsLO">Leasing Office</a></li>
							<li><a data-bind="click: AllApprovalsLR">Leasing Retail </a></li>
							<li data-role="list-divider">Approval History</li>
							<li> <a data-bind="click: AllApprRej">All </a></li>
							<li> <a data-bind="click: AllLOApprRej"> Leasing Office </a></li>
							<li> <a data-bind="click: AllLRApprRej"> Leasing Retail </a></li>
						</ul>
					</div>
				</div>

				<div id="approval-list" data-role="panel" data-display="reveal" class="approval-list">
					<div id="deallist" class="inner-panel inner-panel-search">
					</div>
				</div>  
				<div data-role="popup" data-theme="c" id="approval-popup" data-dismissible="false" data-overlay-theme="a">
					<a id="popup-close" data-bind="click: closeButtonCB" data-wrapperels="span" class="ui-btn-right ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-notext ui-btn-up-a" >
						<span class="ui-btn-inner">
							<span class="ui-btn-text">Close</span>
							<span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span>
						</span>
					</a>
				<div id="wrapper" tabindex="0"> 
					<!--  
					<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-notext ui-btn-up-a" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" title="Close">
						<span class="ui-btn-inner">
							<span class="ui-btn-text">Close</span>
							<span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span>
						</span>
					</a>
					-->
					<h3>Approval Request</h3>
					<br/>
					<p>Please enter your notes and click Approve or Reject:</p>
					<br/>
					<textarea id="comments" name="comments" data-bind="value:apprvMsg, valueUpdate:['afterkeydown','propertychange','input']"/>
					<div class="ui-grid-a deal-detail-grid">
						<div class="ui-block-b ui-button">
							<a data-bind="click: approveButtonCB" data-role="button">Approve</a>
						</div>
						<div class="ui-block-b ui-button">
							<a data-bind="click: rejectButtonCB" data-role="button">Reject</a>
						</div>
					</div>
				</div>
				</div>	  
			</div>
		</apex:form>			
	</body>
	<c:DealApprovalContent />
</apex:page>