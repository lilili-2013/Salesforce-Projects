<apex:page standardController="Call_Report__c" extensions="SL_CallReportInlineVFController" showHeader="true" sidebar="true" action="{!createCallReport}">
    <apex:form id="pageForm" >   
    	<apex:actionfunction name="confirmDeleteAF" action="{!delAttendee}" rerender="AttendeeId" status="processing">
			<apex:param name="removeparam" value="" assignTo="{!strAttendeeId}"/>
        </apex:actionfunction>
		<apex:actionfunction name="editAttendeeAF" action="{!editAttendee}" rerender="PWPAtendee" status="processing">
			<apex:param name="editAttendeeParam" value="" assignTo="{!strAttendeeId}"/>
         </apex:actionfunction>
            
       	<apex:actionfunction name="CompanyDeleteAF" action="{!delCompany}" rerender="companyId" status="processing">
			<apex:param name="removeparam1" value="" assignTo="{!strCompanyId}"/>
        </apex:actionfunction>
            
        <apex:actionfunction name="editCompanyAF" action="{!editCompany}" rerender="PWPCompany" status="processing">
            <apex:param name="editCompany" value="" assignTo="{!strCompanyId}"/>
        </apex:actionfunction>
        
        <apex:actionFunction name="saveAllAF" action="{!saveAll}" rerender="PWPAtendee,PWPCompany,showMessageForCompany,showMessageForAttendee" status="processing">
        	<apex:param name="objectName" value="" assignTo="{!strObjectName}"/>
        </apex:actionFunction>
        
        <apex:actionFunction name="editAllAF" action="{!editRecords}" rerender="PWPAtendee,PWPCompany,showMessageForCompany,showMessageForAttendee" status="processing">
        	<apex:param name="objectName" value="" assignTo="{!strObjectName}"/>
        </apex:actionFunction>
        
        <apex:actionFunction name="deleteAllAF" action="{!deleteRecords}" rerender="PWPAtendee,PWPCompany,showMessageForCompany,showMessageForAttendee" status="processing">
        	<apex:param name="objectName" value="" assignTo="{!strObjectName}"/>
        </apex:actionFunction>
        
        <apex:pageMessages id="showMessage"/>        
        <apex:outputPanel rendered="{!!isActivityClicked}">
	        <!-- Call Report Attendees Section --> 
	        <apex:pageBlock title="Attendees" id="AttendeeId">  
	                <div align="center">
		                <apex:commandButton value="Delete Selected" onClick="deleteAllAF('Call Report Attendee');return false;"/>
		            	<apex:commandButton value="Edit Selected" onClick="editAllAF('Call Report Attendee'); return false;"/>
					</div>            
		            <apex:pageblocktable value="{!lstWrapperAttendee}" var="attendee" id="PWPAtendee" width="100%"> 
			        	<apex:column headerValue="Selected" width="10px">
			        		<apex:facet name="header">
			        			<apex:inputCheckBox id="headerChkBox" onclick="checkAllRecords('{!$Component.PWPAtendee}',this);"/>
			        		</apex:facet>
			        		<apex:inputCheckBox title="check"  value="{!attendee.isSelected}"/>
			        	</apex:column>
			        	<apex:column headerValue="Action" width="50px">
			            	<apex:outputpanel rendered="{!attendee.isEditRecord}">
			                 	<apex:commandlink value="Edit" onclick="editAttendeeAF('{!attendee.objAttendee.Id}');return false;" >
			                 	</apex:commandlink>&nbsp;|&nbsp;
			                 	<apex:commandLink value="Del" onclick="confirmDeleteAF('{!attendee.objAttendee.Id}');return false;"></apex:commandLink> 
			             	</apex:outputpanel>
			             	<apex:outputpanel rendered="{!NOT(attendee.isEditRecord)}"> 
		                     	<apex:commandlink value="Cancel" action="{!cancelAttendeeRecord}" rerender="AttendeeId" status="processing">
		                        	<apex:param name="cancelparam" value="true" assignTo="{!attendee.isEditRecord}"/>
		                         	<apex:param name="cancelparam1" value="true" assignTo="{!attendee.isCancelRecord}"/>
		                         	<apex:param name="removeparam" value="{!attendee.objAttendee.Id}" assignTo="{!strAttendeeId}"/>
		                     	</apex:commandlink>
			             	</apex:outputpanel>
			         	</apex:column>
		           		<apex:column headervalue="Name" width="200px">
							<apex:outputPanel rendered="{!attendee.isEditRecord}">
								<a href="/{!attendee.objAttendee.Call_Report_Attendee__c}" target="_parent" style="color:black;">{!attendee.objAttendee.Call_Report_Attendee__r.Name}</a>
							</apex:outputPanel>
							<apex:inputField rendered="{!NOT(attendee.isEditRecord)}" id="textbox" value="{!attendee.objCR.Reference_Contact__c}" onChange="saveAllAF('Call Report Attendee');return false;"/>
							<apex:outputPanel rendered="{!IF(attendee.strErrormessage != '', true, false)}">
								<div class="errorMsg"><span>{!attendee.strErrormessage}</span></div>
	               			</apex:outputPanel>
		           		</apex:column>
		           		<apex:repeat value="{!$ObjectType.Contact.FieldSets.AttendeeFieldSet}" var="field">
	            			<apex:column headerValue="{!field.Label}">
		            			<apex:outputPanel rendered="{!field.Type == 'reference'}">
									<a href="/{!attendee.objAttendee['Call_Report_Attendee__r.'+field.FieldPath]}" target="_parent" style="color:black;">{!attendee.objAttendee['Call_Report_Attendee__r.'+ IF(CONTAINS(field.FieldPath, 'Id'), SUBSTITUTE(field.FieldPath,'Id','.Name'),SUBSTITUTE(field.FieldPath,'__c','__r.Name'))]}</a>
								</apex:outputPanel>
	            				<apex:outputField value="{!attendee.objAttendee['Call_Report_Attendee__r.'+field.FieldPath]}" rendered="{!field.Type != 'reference'}"/>
	            			</apex:column>
	            		</apex:repeat>
		        	</apex:pageblocktable>      
		         <apex:outputPanel rendered="{!IF(lstWrapperAttendee.size == 0, true, false)}" id="showMessageForAttendee">
		        	<center>
	                	<h1>No records to display.</h1>
	            	</center>
		        </apex:outputPanel>
	        </apex:pageBlock>
	        
	
			<!-- Call Report Company Section -->
			    
	        <apex:pageBlock title="Companies" id="companyId">        
	        	 <div align="center">    
	                <apex:commandButton value="Delete Selected" onClick="deleteAllAF('Call Report Company');return false;"/>
	                <apex:commandButton value="Edit Selected" onClick="editAllAF('Call Report Company'); return false;"/>
	             </div>            
	             	<apex:pageblocktable value="{!lstWrapperCompany}" var="company" id="PWPCompany" width="100%"  > 
		            	<apex:column headerValue="Selected" width="10px">
			        		<apex:facet name="header">
			        			<apex:inputCheckBox id="headerChkBox" onclick="checkAllRecords('{!$Component.PWPCompany}',this);"/>
			        		</apex:facet>
			        		<apex:inputCheckBox title="check"  value="{!company.isSelected}"/>
			        	</apex:column>
		            	<apex:column headerValue="Action" width="50px"> 
		                	<apex:outputpanel rendered="{!company.isEditRecord}">
		                    	<apex:commandlink value="Edit" onclick="editCompanyAF('{!company.objCompany.Id}'); return false;">
		                    	</apex:commandlink>&nbsp;|&nbsp;
		                    	<apex:commandLink value="Del" onclick="CompanyDeleteAF('{!company.objCompany.Id}');return false;"></apex:commandLink> 
		                	</apex:outputpanel>
		                	<apex:outputpanel rendered="{!NOT(company.isEditRecord)}">	                        
		                        <apex:commandlink value="Cancel" action="{!cancelCompanyRecord}" rerender="companyId" status="processing">
		                           <apex:param name="cancelparam2" value="true" assignTo="{!company.isEditRecord}"/>
		                            <apex:param name="cancelparam3" value="true" assignTo="{!company.isCancelRecord}"/>
		                            <apex:param name="removeparam" value="{!company.objCompany.Id}" assignTo="{!strCompanyId}"/>
		                        </apex:commandlink>
		                	</apex:outputpanel>
		            	</apex:column>
	            
	            		<apex:column headervalue="Name" width="200px">
	                    	<apex:outputPanel rendered="{!company.isEditRecord}">
								<a href="/{!company.objCompany.Relevant_Company__c}" target="_parent" style="color:black;">{!company.objCompany.Relevant_Company__r.Name}</a>
							</apex:outputPanel>
	                    	<apex:inputField rendered="{!NOT(company.isEditRecord)}" value="{!company.objCR.Reference_Account__c}" onChange="saveAllAF('Call Report Company');return false;"/>
	            			<apex:outputPanel rendered="{!IF(company.strErrormessage != '', true, false)}">
                    			<div class="errorMsg"><span>{!company.strErrormessage}</span></div>
                    		</apex:outputPanel>
	            		</apex:column>
	            		<apex:repeat value="{!$ObjectType.Account.FieldSets.CompanyFieldSet}" var="field">
	            			<apex:column headerValue="{!field.Label}">
	            				<apex:outputField value="{!company.objCompany['Relevant_Company__r.'+field.FieldPath]}"/>
	            			</apex:column>
	            		</apex:repeat>
	            	</apex:pageblocktable>
	            <apex:outputPanel rendered="{!IF(lstWrapperCompany.size == 0, true, false)}" id="showMessageForCompany">
		        	<center>
	                	<h1>No records to display.</h1>
	            	</center>
		        </apex:outputPanel>
	        </apex:pageBlock>
		</apex:outputPanel>
		<c:SL_ActionStatusComponent />        
    </apex:form>
     <!-- Call Report Information Section -->
      <apex:outputPanel rendered="{!isActivityClicked}">
       	<apex:detail subject="{!objCallReport.Id}" inlineEdit="true"/>
      </apex:outputPanel>
    <script>
    	/*This function is used to check all checkbox if header is selected*/
		function checkAllRecords(tableId,headerChkBox)
        {
		    var arrayInput = document.getElementById(tableId).getElementsByTagName('input');		
          	for(var i=0 ; i < arrayInput.length ; i++) 
            {
           		if(arrayInput[i].type == 'checkbox' && arrayInput[i].title == 'check')
              	{
            			arrayInput[i].checked = headerChkBox.checked ? true : false;
           		}
            }
         }
    </script>
</apex:page>