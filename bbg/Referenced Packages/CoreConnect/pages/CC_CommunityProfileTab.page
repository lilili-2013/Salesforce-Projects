<apex:page showHeader="false" Sidebar="false" controller="CORECONNECT.CC_CommunityProfileTabController">
<script>
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        //results = regex.exec(document.referrer);
        results = regex.exec(document.URL);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}
var tab = getParameterByName('sfdc.tabName');
var userId = getParameterByName('sfdc.userId');
</script>

<apex:form >
    <apex:actionFunction name="setTabName" action="{!setTabName}" rerender="fieldsetFields">
        <apex:param name="p1" value="" assignTo="{!tabName}" />
        <apex:param name="p2" value="" assignTo="{!userId}" />
    </apex:actionFunction>

<apex:outputPanel id="fieldsetFields">
	
    <apex:outputPanel rendered="{!IF(NOT(ISBLANK(fieldSetName)) && showFields ,'true','false')}">
      
      <apex:pageBlock >
      <apex:pageBlockSection columns="2" title="{!fieldSetLabel}"> 
      <apex:repeat value="{!fieldNames}" var="f">
         
          <apex:pageBlockSectionItem rendered="{!NOT(readOnly)}"> 
          		<apex:outputLabel value="{!f.label}"/>   	
                <apex:inputField label="{!f.label}" value="{!currUser[f.fieldPath]}" /> 
          </apex:pageBlockSectionItem>
          
          <apex:pageBlockSectionItem rendered="{!readOnly}"> 
          		<apex:outputLabel value="{!f.label}"/>   	
                <apex:outputField label="{!f.label}" value="{!currUser[f.fieldPath]}" /> 
          </apex:pageBlockSectionItem>
         
        </apex:repeat>
        </apex:pageBlockSection>
        <apex:pageBlockButtons location="bottom" rendered="{!NOT(readOnly)}">
        	<apex:commandButton action="{!saveFields}" value="Save" rerender="fieldsetFields"/>
        </apex:pageBlockButtons>
        </apex:pageBlock>
        
    </apex:outputPanel>
    <apex:outputText value="System settings not found for {!tabName}" rendered="{!IF(NOT(showFields) && NOT(ISBLANK(tabName)) ,'true','false')}"/>
    <apex:outputText value="User Fieldset not found for {!tabName}" rendered="{!IF(showFields && NOT(ISBLANK(tabName)) && ISBLANK(fieldSetLabel) ,'true','false')}"/>
</apex:outputPanel>
</apex:form>
<script>
setTabName(tab,userId);
</script>
</apex:page>