<apex:page id="pageId" standardController="Literature_Requests__c" extensions="SL_AddLiteratureRequestController" >
    <apex:form id="formId">
        <script>
            /* Redirect page to respective contacts detail page onclick of Cancel button  */
            function cancelButton()
            {
                if('{!$CurrentPage.parameters.id}' === ''){
                     window.location.href = '/{!$CurrentPage.parameters.contactId}';
                } else {
                    window.location.href = '/{!$CurrentPage.parameters.id}';
                }
            }
            
            /* To validate number fields like Zip code and Quantity */ 
            function onlyNum(evt) 
            {
                evt = (evt) ? evt : window.event;
                var charCode = (evt.which) ? evt.which : evt.keyCode; 
                if (charCode > 31 && (charCode < 48 || charCode > 57)) 
                {
                    return false;
                }
            } 
            
            /* Get the selected Address radio button values */
            function setSelectedAddress(selectedAddress)
            {
                document.getElementById('{!$Component.addressId}').value = selectedAddress;
            }
            
            
            /* This function is use to check all checkbox if header is selected */
            function checkAllRecords(tableId,headerChkBox)
            {
                var arrayInput = document.getElementById('{!$Component.pageBlockId}').getElementsByTagName('input');
                
                if(headerChkBox.checked)
                {
                    for(var i=0 ; i < arrayInput.length ; i++) 
                    {
                        if(arrayInput[i].type == 'checkbox' && arrayInput[i].title == 'check')
                        {
                            arrayInput[i].checked = true;
                        }
                    }
                    checkBoxHeaderChecked = true; 
                    checkBoxChecked = true;
                }
                else
                {
                    for(var i=0 ; i < arrayInput.length ; i++) 
                    {
                        if(arrayInput[i].type == 'checkbox' && arrayInput[i].title == 'check')
                        {
                            arrayInput[i].checked = false;
                        }
                    }
                    checkBoxHeaderChecked = false;
                    checkBoxChecked = false;
                }
            }
            
            /* This function is use to check header checkbox if all checkebox is selected */
            function callCheckIfAllCheckBoxChecked()
            {
                var count = 0;
                var noOfChkBox = 0;
                var arrayInput = document.getElementById('{!$Component.pageBlockId}').getElementsByTagName('input');
                for(var i=0 ; i < arrayInput.length ; i++) 
                {
                    if(arrayInput[i].type == 'checkbox' && arrayInput[i].checked && arrayInput[i].title == 'check')
                    {
                        count++;
                    }
                    if(arrayInput[i].type == 'checkbox' && arrayInput[i].title == 'check')
                    {
                        noOfChkBox++;
                    }
                }
               
                if(count>=1)
                {
                    checkBoxChecked = true;
                }
                
                if(count == noOfChkBox && noOfChkBox > 0)
                    document.getElementById('{!$Component.pageBlockId.headerChkBox}').checked = true;
                else
                    document.getElementById('{!$Component.pageBlockId.headerChkBox}').checked = false;
            }
            
            function uncheckSelectAllOnClickRemove()
            {
                document.getElementById('{!$Component.pageBlockId.headerChkBox}').checked = false;
            }
        </script>
        <div class="bodyClass">
            <div class="bPageTitle">
                <div class="ptBody secondaryPalette">
                    <div class="content">
                        <img src="/s.gif" alt="Literature Request" class="pageTitleIcon" title="Literature Request" style="margin-top:0"/>
                        <h1>
                            <apex:outputLabel value="New Literature Request" style="font-size:initial;"/>
                        </h1>
                    </div>
                </div>
            </div>
        </div>  
        <table width="100%">
            <tr width="100%">
                <td width="25%"></td>
                <td colspan="3"  width="25%">
                    <input type="button" style="width: 47px;" class="btn" value="Save" onclick="saveLitratureReqAndItemsAF();" />
                    <input type="button"  class="btn" value="Cancel" onclick="cancelButton()"/>
                </td>
               <td width="30%"></td>
            </tr>
        </table>
    <apex:inputhidden value="{!strSelectedAddress}" id="addressId"/>
    <table width="100%" style="margin-bottom: 5px;margin-top: 19px;">
        <tr>
            <td style="font-size: 15px; height: 32px;"><b>Name:</b>&nbsp;{!objContact.Name}</td>
            <td><div style="margin-top:2px;"><b style="margin-left: 10px;">Description:</b>&nbsp;<div style="margin-left: 87px;margin-top: -20px;"><apex:inputField value="{!objLRequest.Description__c}" style="width:213px;resize: none;height:20px;"/></div></div></td>
        </tr>
        <tr>
            <td style="font-weight: bold;font-size: 15px; width:100%;" colspan="3">Ship To:</td>
        </tr>
        <tr>
            <td style="width:25%; text-align: left;">
                <table style="margin-top: 20px;">
                    <tr>
                        <td>
                            <div style="margin-top: 29px;"><input type="radio" name="address" checked="checked" value="mailing" onclick="setSelectedAddress(this)"/></div>
                        </td>
                        <td >    
                            <div style="margin-top: 31px;">
                                <b>Mailing</b>
                            </div>
                        </td>
                        <td>
                            <div style="margin-top: 15px;margin-left: 3px;">
                                <apex:outputPanel rendered="{!objContact.MailingStreet != null}">
                                    {!objContact.MailingStreet} <br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.MailingCity != null}">
                                    {!objContact.MailingCity}
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.MailingCity != null && objContact.MailingState != null}">,</apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.MailingState != null}">
                                    {!objContact.MailingState}<br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.MailingState == null}">
                                    <br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.MailingPostalCode != null}">
                                    {!objContact.MailingPostalCode}
                                </apex:outputPanel>
                            </div>     
                        </td> 
                    </tr>
                </table>
            </td>
            <td style="width:30%; text-align: left;">
                <table style="margin-top: 20px;">
                    <tr>
                        <td>
                            <div style="margin-top: 29px;"><input type="radio" name="address" value="other" onclick="setSelectedAddress(this.value)"/></div>
                        </td>
                        <td>
                            <div style="margin-top: 31px;">
                                <b>Other</b>
                            </div>  
                        </td>
                        <td>
                            <div style="margin-top: 15px;margin-left: 3px;">
                                <apex:outputPanel rendered="{!objContact.OtherStreet != null}">
                                        {!objContact.OtherStreet}<br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.OtherCity != null}">
                                    {!objContact.OtherCity}
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.OtherCity != null && objContact.OtherState != null}">,</apex:outputPanel>
                                
                                <apex:outputPanel rendered="{!objContact.OtherState != null}">
                                    {!objContact.OtherState}<br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.OtherState == null}">
                                    <br/>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!objContact.OtherPostalCode != null}">
                                    {!objContact.OtherPostalCode}
                                </apex:outputPanel>
                            </div>                              
                        </td>
                    </tr>
                </table>
            </td>
            <td style="width:45%; text-align: left;">
                <table>
                    <tr>
                        <td style="vertical-align: middle;"><input type="radio" name="address" value="custom" onclick="setSelectedAddress(this.value)"/></td>
                        <td>
                            <div style="margin-top: 52px;">
                                <b>Custom</b>
                            </div>
                        </td>      
                        <td>
                            <table style="margin-left: 2px; position:relative; bottom:3px;">
                                <tr>
                                    <td colspan="2">
                                        <apex:inputText style="width:235px;height:20px;" html-placeholder="Name" value="{!strContactName}"/><br/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <apex:inputText id="inputTextAdd" style="width: 235px;height: 20px;" html-placeholder="Address" value="{!strCustomAddress}"/><br/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <apex:inputText id="cityId" style="width: 116px;height: 20px;" html-placeholder="City" value="{!strCustomCity}"/>&nbsp;
                                        <apex:inputText id="stateId" style="width: 109px;height: 20px;margin-left:1px;" html-placeholder="State" maxlength="2" value="{!strCustomState}"/><br/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <apex:inputText id="Zip" style="width: 235px;height: 20px;" html-placeholder="Zip" maxlength="20" value="{!strCustomZip}"/>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>        
            </td>
        </tr>
        <tr>
            <td style="width:25%; text-align: left;height: 31px;">
                <div style="margin-top: 5px;"><b>Delivered By&nbsp;&nbsp;</b><apex:inputField value="{!objLRequest.Send_By__c}" style="height: 16px;"/></div>
            </td>
            <td style="width:30%; text-align: left;">
                <div style="margin-top: 5px;margin-left: 9px;"><b>Delivery Method&nbsp;&nbsp;</b><apex:inputField value="{!objLRequest.Delivery_Method__c}" style="height: 22px;width: 196px;"/></div>
            </td>
            <td style="width:45%; text-align: left;">
                <div style="margin-top: 5px;margin-left: 9px;"><b>Print Literature Request With&nbsp;&nbsp;</b><apex:inputField value="{!objLRequest.Print_Literature_Request_with__c}" style="height: 22px;width: 140px;"/></div>
            </td>
        </tr>
    </table>
    <!-- Start - For adding and removing related Literature request items  -->
    <apex:outputpanel id="optId">
        <apex:pageMessages id="ErrorMessage" />
        <apex:pageBlock id="pageBlockId" mode="inlineedit">
            <apex:pageBlockButtons location="top"> 
                <apex:commandButton action="{!addLiteratureRequestItems}" value="Add Item" rerender="optId" status="loading" />
                <apex:commandButton action="{!removeLiteratureRequestItems}" value="Remove Item" rerender="optId,ErrorMessage" status="loading" oncomplete="uncheckSelectAllOnClickRemove();" />
            </apex:pageBlockButtons>
            <!-- Start - Literature Items Section -->               
                <table style="width:100%;" id="TableId" class="list" border="0" cellspacing="0" cellpadding="0">
                    <tr class="headerRow">
                        <th width="4%" class=" zen-deemphasize">
                             <apex:inputCheckbox id="headerChkBox" onclick="checkAllRecords('TableId',this);"/>
                        </th>
                        <th width="20%" style="vertical-align: bottom;" class=" zen-deemphasize">Item Type</th>
                        <th width="25%" style="vertical-align: bottom;" class=" zen-deemphasize">Item</th>
                        <th width="20%" style="vertical-align: bottom;" class=" zen-deemphasize">Quantity</th>
                        <th width="25%" style="vertical-align: bottom;" class=" zen-deemphasize">Investor</th>
                    </tr>
                    <apex:variable var="rowNum" value="{!0}"/>
                    <apex:repeat value="{!lstLiteratureItemsWrapper}" var="litItem">
                        <tr class="dataRow" onblur="if (window.hiOff){hiOff(this);}" onfocus="if (window.hiOn){hiOn(this);}" onmouseout="if (window.hiOff){hiOff(this);}" onmouseover="if (window.hiOn){hiOn(this);}">
                            <td class=" dataCell">
                                <apex:inputCheckbox title="check" value="{!litItem.isSelected}" id="inputId" onclick="if(document.getElementById('{!$Component.inputId}').checked)"/>
                            </td>
                            <td class="dataCell">
                                <apex:outputPanel rendered="{!litItem.isDisplay == true}" >
                                    <span style="display:none">{!rowNum}</span>
                                    <apex:selectList value="{!litItem.strSelectedLiteratureItemType}" multiselect="false" size="1" style="width:122px;" onchange="onChangeItemType(Number(this.parentNode.getElementsByTagName('span')[0].innerHTML));">
                                        <apex:selectOptions value="{!LiteratureItemTypeValues}"/>
                                    </apex:selectList>
                                </apex:outputPanel>
                                <apex:outputText id="typeId" value="{!litItem.strSelectedLiteratureItemType}" rendered="{!litItem.isDisplay == false}"/>
                            </td>   
                            <td class="dataCell">
                                <apex:outputPanel rendered="{!litItem.isDisplay == true}" >
                                    <span style="display:none">{!rowNum}</span>
                                    <apex:selectList value="{!litItem.strSelectedLiteratureItemId}"  multiselect="false" size="1" style="width:282px;" onchange="onChangeItem(Number(this.parentNode.getElementsByTagName('span')[0].innerHTML));">
                                        <apex:selectOptions value="{!litItem.lstItemName}"/>
                                    </apex:selectList>
                                </apex:outputPanel>
                                <apex:outputText value="{!litItem.strItemName}" rendered="{!litItem.isDisplay == false}"/>  
                            </td>
                            <td class="dataCell">
                                <apex:inputField value="{!litItem.objLiteratureItem.Quantity__c}" onKeyPress="return onlyNum(event);" rendered="{!litItem.isDisplay == true && litItem.isQtyEditable == false}"/>
                                <apex:outputField value="{!litItem.objLiteratureItem.Quantity__c}" rendered="{!litItem.isDisplay == false && litItem.isQtyEditable == false}"/>
                                <apex:inputField value="{!litItem.objLiteratureItem.Quantity__c}" style=" resize: none;width: 117px;height:13px;margin-top:2px;" rendered="{!litItem.isQtyEditable == true}" onKeyPress="return onlyNum(event);"/>
                            </td>
                            <td class="dataCell">
                                <apex:inputField value="{!litItem.objLiteratureItem.Investor__c}" style=" resize: none;width: 117px;height:13px;margin-top:2px;" rendered="{!litItem.isDisplay == true}"/>
                                <apex:outputField value="{!litItem.objLiteratureItem.Investor__c}" rendered="{!litItem.isDisplay == false}"/>
                            </td>
                         </tr>
                         <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                    </apex:repeat>
                </table>
                <apex:pageBlockButtons location="bottom">
                    <input type="button"  class="btn" style="width:47px;" value="Save" onclick="saveLitratureReqAndItemsAF();" />
                    <input type="button"  class="btn" style="margin-left:-1px;" value="Cancel" onclick="cancelButton()"/>
                </apex:pageBlockButtons>
        </apex:pageBlock>
    </apex:outputpanel>
    <apex:actionfunction name="onChangeItemType" action="{!updateItems}" status="loading" rerender="optId,ErrorMessage">
        <apex:param name="index" assignTo="{!rowIndex}" value=""/>
    </apex:actionfunction>
    <!-- End - For adding and removing related Literature request items  -->    
    <!-- Start - Action Function to call controller save method -->
    <apex:actionFunction name="saveLitratureReqAndItemsAF" action="{!saveLitratureReqAndItems}" status="loading" rerender="optId,ErrorMessage"/>
    <apex:actionFunction name="onChangeItem" action="{!getLiteratureItemsDetails}" status="loading" rerender="ErrorMessage,optId">
        <apex:param name="test" assignTo="{!rowIndex}" value=""/>
    </apex:actionFunction>
    <!-- End - Action Function to call controller save method -->
    <!-- Start - For  Loading symbol  -->
    <apex:actionstatus id="loading">
        <apex:facet name="start">
            <div id="salesforceSource_blurybackground" style="z-index:9999; position:fixed; left:1px; top:1px; width:100%;height:100%; text-align:center; vertical-align: middle; background-color: #dcdcdc; opacity:0.4;filter:alpha(opacity=40)"></div>
            <div id="ManageMembersViewport_loading" class="waitingSearchDiv" style="width: 100%; height: 100%; display: ''; ">
                <div style="vertical-align: middle;" class="waitingHolder">
                    <table align="center" valign="middle" style="width: 100%; height: 30%">
                        <tr align="center" valign="middle" style="width: 100%; height: 30%">
                            <td valign="middle">&nbsp;</td>
                        </tr>
                    </table> 
                </div>
            </div>
            <div id="ManageMembersViewport_loading" class="waitingSearchDiv" style="width: 100%; height: 100%; display: ''; "></div>
            <script>document.getElementById('ManageMembersViewport_loading').height = window.innerHeight * (3/4);</script>
        </apex:facet>
    </apex:actionstatus>
    <!-- End - For Loading symbol  -->
    </apex:form>
</apex:page>