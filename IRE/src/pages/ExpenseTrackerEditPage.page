<apex:page id="pageId" standardController="Expense_Tracker__c"  extensions="ExpenseTrackerEditPageController">
  <style type="text/css">
.loading-icon {
   background-image: url(/img/loading.gif);
   width: 16px;
   height: 16px;
}
 
 
.search-block {
   text-align: left;
   margin-bottom: 5px;
   display: inline-table;
}
 
.search-block input {
   margin: 15px 15px 15px 5px;
}
 
.search-block-button {
   min-width: 50px;
}
 
.process-block {
   text-align: center;
   margin-top: 10px;
   float:left;
}
 
.process-block input {
   margin: 0px 15px;
}
 
.process-block-button {
   min-width: 110px;
}
  
.page-buttons input {
   min-width: 110px;
}
</style>
<script>
    var newWin=null;
    function openLookupPopup()
    {
        var url="/apex/Uploadfile"; 
        newWin=window.open(url, 'Popup','height=500,width=600,left=100,top=100,resizable=no,scrollbars=yes,toolbar=no,status=no');
        if (window.focus) 
        {
            newWin.focus();
        }
            
        return false;
    }
                  
    function closeLookupPopup()
    {
       if (null!=newWin)
       {
          newWin.close();
       }  
    }
    function reload() { 
     
        document.getElementById("{!$Component.formId.pbId.pbsIs.ckLun}").checked = true;    
        
    } 
</script>
<apex:form id="formId">  
    <apex:sectionHeader title="Expense Tracker Edit" subtitle="New Expense Tracker" />
    <apex:pageblock id="pbId" title="Expense Tracker Edit">
    <apex:pageBlockButtons location="top">
     <div class="process-block">
            <apex:actionStatus id="ProcessButtonStatus">
               <apex:facet name="stop">
                  <apex:outputPanel >
                     <apex:commandButton styleClass="process-block-button" value="Save" action="{!DoSomethingMany}"
                        status="ProcessButtonStatus" disabled="{!enable}"/>
                     <apex:commandButton styleClass="process-block-button" immediate="true" value="Cancel" action="{!ClearAll}" />
                     <apex:commandButton onclick="openLookupPopup(); return false" value="Attachment"/>
                  </apex:outputPanel>
               </apex:facet>
               <apex:facet name="start">
                  <apex:outputPanel >
                     <apex:commandButton styleClass="process-block-button" value="Processing..." disabled="true" />
                     <apex:commandButton styleClass="process-block-button" value="Processing..." disabled="true" />
                  </apex:outputPanel>
               </apex:facet>
            </apex:actionStatus>
         </div>
         </apex:pageBlockButtons>    
        <apex:pageblocksection columns="2" id="pbsIs">  
            <apex:inputfield value="{!Expense_Tracker__c.Educational_Meeting__c}" rendered="{!EducationalRecType}" required="true">
            <apex:actionSupport event="onchange" rerender="TablePanel,pbId" status="TableUpdateStatus" />
            </apex:inputField>
            <apex:inputField value="{!Expense_Tracker__c.Account__c}"   >
                <apex:actionSupport event="onchange" action="{!BuildQuery}"   rerender="TablePanel,pbId" status="TableUpdateStatus" >
                  <apex:param name="ischanged" value="true" assignTo="{!ischanged}"/>
                </apex:actionsupport>
            </apex:inputField>
            <apex:inputfield value="{!Expense_Tracker__c.Expense_Date__c}"/>  
            <apex:inputfield value="{!Expense_Tracker__c.Expense_Details__c}"/>  
            <apex:inputfield value="{!Expense_Tracker__c.Expense_Type__c}"/>  
            <apex:inputfield value="{!Expense_Tracker__c.Amount__c}"/>
            <apex:inputfield value="{!Expense_Tracker__c.Status__c}"/>
            <apex:inputfield value="{!Expense_Tracker__c.Source__c}"/>
            <apex:inputfield value="{!Expense_Tracker__c.Notes__c}"/>
            <apex:inputfield id="ckLun" value="{!Expense_Tracker__c.Attachment__c}"/>
            
        </apex:pageblocksection>
         </apex:pageblock>  

      <!-- search results table      -->
      <apex:pageBlock id="TablePanel">  
         <div class="search-block" >
            <div style="display: inline-table">
               <span><b>Name:</b></span>
               <apex:inputText value="{!SearchName}" />
            </div>
            
            <apex:commandButton styleClass="search-block-button" value="Search" action="{!SearchContact}" rerender="TablePanel"
               status="TableUpdateStatus" />
         </div>
         
         <div style="margin-top: 5px; float:right;">
            <apex:outputText value="Number of Records per Page: " />
            <apex:selectList value="{!RecPerPage}" size="1">
               <apex:selectOptions value="{!RecPerPageOption}" />
               <apex:actionSupport event="onchange" reRender="TablePanel"  action="{!Pagination}" status="TableUpdateStatus" />
            </apex:selectList>
         </div>
 
         <div style="clear: both;"></div>
 
         <apex:actionStatus id="TableUpdateStatus">
            
            <!-- loading message -->
            <apex:facet name="start">
               <apex:outputPanel layout="block" styleClass="message infoM4">
                  <apex:panelGrid columns="2" styleClass="messageTable" columnClasses="messageCell" style="padding:0px;margin:0px;">
                     <apex:panelGroup >
                        <img class="loading-icon" src="/s.gif" />
                     </apex:panelGroup>
                     <apex:panelGroup >
                        <div class="messageText">Please wait...</div>
                     </apex:panelGroup>
                  </apex:panelGrid>
               </apex:outputPanel>
            </apex:facet>
 
            <!-- Contact table -->
            <apex:facet name="stop">
               <apex:pageBlockTable value="{!CurrentContactList}" var="a" id="pb">
                 
                  <apex:column >
                     <div style="text-align: center;">
                        <apex:inputCheckBox value="{!a.aCheckBox}" id="check-box">
                           <apex:actionSupport event="onchange" rerender="SelectedCount" action="{!UpdateContactSelectedSet}" />
                           </apex:inputcheckbox>
                     </div>
                  </apex:column>
                  <apex:column >
                     <apex:facet name="header" >
                        <apex:commandLink action="{!SortToggle}" rerender="TablePanel" status="TableUpdateStatus">
                           <apex:param name="SortField" value="Name" assignTo="{!SortField}" />
                           <apex:outputText value="{!$ObjectType.Contact.Fields.Name.Label}{!IF(SortField=='Name',IF(SortDirection='asc','?','?'),'')}" />
                        </apex:commandLink>
                     </apex:facet>
                     <apex:outputLink value="/{!a.aContact.Id}" target="_blank">{!a.aContact.Name}</apex:outputlink>
                  </apex:column>
                 <apex:column >
                     <apex:facet name="header">
                        <apex:commandLink action="{!SortToggle}" rerender="TablePanel" status="TableUpdateStatus">
                           <apex:param name="SortField" value="Email" assignTo="{!SortField}" />
                           <apex:outputText value="{!$ObjectType.Contact.Fields.Email.Label}{!IF(SortField=='Email',IF(SortDirection='asc','?','?'),'')}" />
                        </apex:commandLink>
                     </apex:facet>
                     <apex:outputField value="{!a.aContact.Email}" />
                  </apex:column>   
                 <apex:column >
                     <apex:facet name="header">
                        <apex:commandLink action="{!SortToggle}" rerender="TablePanel" status="TableUpdateStatus">
                           <apex:param name="SortField" value="Phone" assignTo="{!SortField}" />
                           <apex:outputText value="{!$ObjectType.Contact.Fields.Phone.Label}{!IF(SortField=='Phone',IF(SortDirection='asc','?','?'),'')}" />
                        </apex:commandLink>
                     </apex:facet>
                     <apex:outputField value="{!a.aContact.Phone}" />
                  </apex:column>       
               </apex:pageBlockTable>
            </apex:facet>
         </apex:actionStatus>
         <apex:pageBlockButtons location="bottom" >
         <div>
            <span class="page-buttons" style="float: left; margin-bottom: 5px;"> <apex:commandButton disabled="{!!isprevious}" value="Previous" action="{!previous}"
                  rerender="TablePanel"  status="TableUpdateStatus"/> 
             <apex:commandButton disabled="{!!isnext}" value="Next"
                  action="{!next}" rerender="TablePanel" status="TableUpdateStatus"  />
            </span>
            
         </div>
         </apex:pageBlockButtons>
        </apex:pageBlock>
   </apex:form>

</apex:page>