<apex:page controller="SL_PropertyAndUnitSearchController" readOnly="true" standardStylesheets="true" docType="html-5.0" applyBodyTag="false">
    <head>
		 <style>		
		 	@media (max-height: @screen-sm-max) { 550px; }
		 	@media (max-height: @screen-md-max) { 550px; } 	
		 	.searchDiv
		 	{
		 		margin-top:10px;
		 		text-align:center;
		 	}
		 	
		 	.tableStyle
			{
				margin-top:10px;
			}
			
			.filterDiv
			{
 				text-align:center; 
				vertical-align: middle;
				border-bottom:1px solid black;
				line-height: 30px;
    			padding-bottom: 10px;
			}
			
			.columnDiv
			{
				overflow-y:auto;
				overflow-x:hidden;
				height:650px;
			}
			
			.recordLink
			{
				color:black!important;
				font-weight:bold;
			}
			
			.resultDiv
			{
				border-bottom:1px solid black;
				margin-top:5px;
			}
			
			.fieldsInfoDiv
			{
				color:#00318A;
				margin-top:5px;
			}
			
			.fieldsInfoDiv label
			{
				color:black;
			}
			
			.descriptionWithImage
			{
				color:#00318A;
				min-height: 52px;
			}
			
			.descriptionWithImageForUnit
			{
				color:#00318A;
				min-height: 74px;
			}
			
			.descriptionWithoutImage
			{
				color:#00318A;
			}
		 </style>
		 <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
         <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"></meta>
		 <apex:stylesheet value="{!URLFOR($Resource.SL_Bootstrap,'/sl_bootstrap_css.css')}" />
	     <apex:stylesheet value="{!URLFOR($Resource.SL_Bootstrap,'/bootstrap-select.min.css')}" />
	     <apex:stylesheet value="{!URLFOR($Resource.BootStrapDatePicker,'/bootstrap-datepicker3.standalone.css')}"/>
	     <script type="text/javascript" src="{!URLFOR($Resource.BootStrapDatePicker,'/jquery.min.js')}"/>
		 <script type="text/javascript" src="{!URLFOR($Resource.BootStrapDatePicker,'/bootstrap-datepicker.js')}"/>
    </head>
    <body class="sl-bs">
	    <div class="container">
		    <apex:form >
		    	<apex:actionFunction name="searchAF" action="{!fetchRecords}" rerender="searchResults,countDiv" onComplete="unblockUI();">
		    		<apex:param value="" assignTo="{!strSearchTerm}" name="searchparam"/>
		    		<apex:param value="" assignTo="{!strSelectedValue}" name="selectedVal"/>
		    		<apex:param value="" name="unitWhereClause"/>
		    		<apex:param value="" name="propertyWhereClause"/>
		    	</apex:actionFunction>
				<div class="sl-bs">
					<div class="span3 searchDiv">
						<select class="span3 input-sm" id="choiceType" value="{!strSelectedValue}" data-live-search="true" onChange="updateFilters();">
		                	<apex:repeat value="{!PicklistOptions}" var="choice">
		                		<option value="{!choice.strValue}">{!choice.strLabel}</option>
		                	</apex:repeat>
			            </select>
			            <input type="text" value="{!strSearchTerm}" placeholder="Search..." class="input-sm" id="searchTerm" style="width:40%;" title="Searches over Property's Comments, Property's State, Property's City, Property's Property Manager and Property's Asset Manager."/>
			            <button type="button" class="btn btn-primary ladda-button" data-style="expand-left" onClick="search();">
				            <span class="ladda-label">Search</span>
				        </button>
			        </div>
			        <apex:outputPanel id="countDiv">
				        <div class="row">
					        <div style="text-align:right;font-weight:bold;padding-right:18px;margin-top:10px;">
					        	{!totalProperties + totalUnits}&nbsp;Results:&nbsp; {!totalProperties}&nbsp; Properties, &nbsp;{!totalUnits}&nbsp; Units
					        </div>
				        </div>
			        </apex:outputPanel>
			        <table width="100%" cellspacing="0" cellpadding="0" class="table tableStyle">
			        	<tr>
			        		<td width="25%" style="border-right:1px solid black;">
			        			<div class="columnDiv">
			        			<div class="filterDiv">
		                         	<label>Refine Search:</label>
		                    	</div>
			        			<apex:outputPanel id="fieldSetFilters">													
			        			<apex:outputPanel >			        			       			
			        			<apex:repeat value="{!lstFilterElements}" var="element">
			                        <apex:outputPanel rendered="{!element.fldType == 'string'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                                <input type="checkbox" id="{!element.apiName}_Checkbox"/>
			                                <label for="{!element.apiName}">{!element.labelName}</label><br/>
			                                <div class="row">
			                                	<div class="col-md-11">
			                                		<input type="text" id="{!element.apiName}" fldType="{!element.fldType}" labelName = "{!element.labelName}" onkeyup="changeFlagStatus('{!element.apiName}','string');" objectName = "{!element.objectName}" class="form-control input-sm filterElements"/>
			                            		</div>
			                            	</div>
			                            </div>
			                        </apex:outputPanel>
			                        <apex:outputPanel rendered="{!element.fldType == 'reference'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                                <input type="checkbox" id="{!element.apiName}_Checkbox"/>
			                                <label for="{!element.apiName}">{!element.labelName}</label><br/>
			                                <div class="row">
			                                	<div class="col-md-11">
			                                		<input type="text" id="{!element.apiName}" fldType="{!element.fldType}" labelName = "{!element.labelName}" onkeyup="changeFlagStatus('{!element.apiName}','reference');" objectName = "{!element.objectName}" class="form-control input-sm filterElements"/>
			                            		</div>
			                            	</div>
			                            </div>
			                        </apex:outputPanel>
			                        <apex:outputPanel rendered="{!element.fldType == 'number'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                            	<input type="checkbox" id="{!element.apiName}_Checkbox"/>
				                            <label>{!element.labelName}</label><br/> 
			                            	<div class="row">
				                            	<div class="col-md-5">		                            	
						                             <input type="text" id="{!element.apiName}__Low" fldType="{!element.fldType}" labelName = "{!element.labelName}" onkeyup="changeFlagStatus('{!element.apiName}','number');" class="form-control filterElements" objectName = "{!element.objectName}" maxlength="9"/>		                                
				                            		 <script>
		                                             $('#{!element.apiName}__Low').keypress(function (e) {
		                                                        if (e.which != 8 && e.which != 0 && (event.which != 46 || $('#{!element.apiName}__Low').val().indexOf('.') != -1) && (e.which < 48 || e.which > 57)) {
		                                                                        //display error message
		                                                                        $('#{!element.apiName}__Lowerrmsg').show();
		                                                                        $('#{!element.apiName}__Lowerrmsg').html("Digits Only").show().fadeOut("slow");
		                                                                               return false;
		                                                                    }
		                                                                    })                          
		                                                                    
		                                                                    .on('blur',function(e){
		                                                                        if($('#{!element.apiName}__Low').val()!=null && $('#{!element.apiName}__High').val()!=null)
		                                                                        {
		                                                                            var lowValue = parseFloat($('#{!element.apiName}__Low').val());
		                                                                            var highValue = parseFloat($('#{!element.apiName}__High').val());
		                                                                            if(highValue < lowValue)
		                                                                            {
		                                                                            	 $('#{!element.apiName}__Low').next('span').remove();
		                                                                            	 $('#{!element.apiName}__High').next('span').remove();
		                                                                            	 var span = $('<span />').attr('id', '{!element.apiName}'+'__Lowerrmsg').html("Higher Limit should be greater than Lower limit");
		                                                                            	 $('#{!element.apiName}__Low').after(span);		                                                                            	
		                                                                            }
		                                                                            else
		                                                                            {
		                                                                                $('#{!element.apiName}__Higherrmsg').remove();
		                                                                                $('#{!element.apiName}__Lowerrmsg').remove();
		                                                                            }
		                                                                            return false;
		                                                                        }
		                                                                    }                                                    
		                                                        );
		                                        </script>
				                            	</div>
				                            	<div class="col-md-2">
				                            		<label>to</label> 	                  
				                            	</div>          	
				                            	<div class="col-md-5">	                            	
					                            	<input type="text" id="{!element.apiName}__High" fldType="{!element.fldType}" labelName = "{!element.labelName}" onkeyup="changeFlagStatus('{!element.apiName}','number');" class="form-control filterElements" objectName = "{!element.objectName}" maxlength="9"/>
				                            		<script>
		                                            $('#{!element.apiName}__High').keypress(function (e) {
		                                                        if (e.which != 8 && e.which != 0 && (event.which != 46 || $('#{!element.apiName}__High').val().indexOf('.') != -1) && (e.which < 48 || e.which > 57)) {
		                                                                        //display error message
		                                                                        $('#{!element.apiName}__Higherrmsg').html("Digits Only").show().fadeOut("slow");
		                                                                               return false;
		                                                                    }
		                                                                    })
		                                                                    .on('blur',function(e){
		                                                                        if($('#{!element.apiName}__Low').val()!=null && $('#{!element.apiName}__High').val()!=null)
		                                                                        {
		                                                                            var lowValue = parseFloat($('#{!element.apiName}__Low').val());
		                                                                            var highValue = parseFloat($('#{!element.apiName}__High').val());
		                                                                            if(highValue < lowValue)
		                                                                            {
		                                                                                 $('#{!element.apiName}__Low').next('span').remove();
		                                                                            	 $('#{!element.apiName}__High').next('span').remove();
		                                                                                 var span = $('<span />').attr('id', '{!element.apiName}'+'__Higherrmsg').html("Higher Limit should be greater than Lower limit");
		                                                                            	 $('#{!element.apiName}__High').after(span);			                                                                             
		                                                                            }
		                                                                            else
		                                                                            {
		                                                                                $('#{!element.apiName}__Higherrmsg').remove();
		                                                                                $('#{!element.apiName}__Lowerrmsg').remove();
		                                                                            }
		                                                                            return false;
		                                                                        }
		                                                                    }                                                    
		                                                        );
		                                        </script>
				                            	</div>
			                            	</div>
			                            </div>
			                        </apex:outputPanel>
			                        <apex:outputPanel rendered="{!element.fldType == 'boolean'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                                <input type="checkbox" id="{!element.apiName}" fldType="{!element.fldType}" labelName = "{!element.labelName}" objectName = "{!element.objectName}" class="filterElements"/>
			                                <label for="{!element.apiName}">{!element.labelName}</label><br/>
			                            </div>
			                        </apex:outputPanel>
			                        <apex:outputPanel rendered="{!element.fldType == 'picklist' || element.fldType == 'multipicklist'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                                <input type="checkbox" id="{!element.apiName}_Checkbox"/>
			                                <label for="{!element.apiName}">{!element.labelName}</label><br/>
			                                <div class="row">
				                                <div class="col-md-11">
					                                <select id="{!element.apiName}" fldType="{!element.fldType}" labelName = "{!element.labelName}" onChange="changeFlagStatus('{!element.apiName}','picklist');" class="form-control filterElements" objectName = "{!element.objectName}">
					                                    <option value="">--None--</option>
					                                    <apex:repeat value="{!element.plValues}" var="picklistValue">
					                                        <option>{!picklistValue}</option>
					                                    </apex:repeat>
					                                </select>
				                                </div>
			                                </div>
			                            </div>
			                        </apex:outputPanel>
			                        <apex:outputPanel rendered="{!element.fldType == 'date' || element.fldType == 'datetime'}" layout="none">
			                            <div class="filterDiv" objectName = "{!element.objectName}">
			                                <input type="checkbox" id="{!element.apiName}_Checkbox"/>
			                                <label>{!element.labelName}</label><br/>
			                                <div class="row">
				                                <div class="col-md-5">
				                                	<input type="text" id="{!element.apiName}__From" fldType="{!element.fldType}" objectName = "{!element.objectName}" labelName = "{!element.labelName}" onChange="changeFlagStatus('{!element.apiName}','date');" class="form-control filterElements datepicker"/>
				                                	<script>
				                                		$('[id*={!element.apiName}__From]').datepicker({
						                                                     format: "mm/dd/yyyy",
						                                                     autoclose: true,
						                                                     daysOfWeekDisabled : '[0]'
						                                                 })
						                                                 .on('changeDate',function(ev){
						                                                
						                                                 var StartDate = '{!element.apiName}__From';
						                                                 var EndDate = '{!element.apiName}__To';
						                                                 if(document.getElementById(StartDate).value!=null && document.getElementById(EndDate).value!=null && document.getElementById(StartDate).value!='' && document.getElementById(EndDate).value!='')
						                                                 {                   
						                                                     var StartDateValue = document.getElementById(StartDate).value;
						                                                     var EndDateValue = document.getElementById(EndDate).value;		                                                     
						                                                     
						                                                     var dtStartDate = new Date(StartDateValue);
						                                                     var dtEndDate = new Date(EndDateValue);
						                                                     if(dtStartDate > dtEndDate)
						                                                     {
						                                                         alert('Please select valid date: From Date cannot be greater than To Date');
						                                                         document.getElementById(StartDate).value = '';
						                                                     }
						                                                 }
						                                                 return false;       
						                                                 });
				                                	</script>
				                                </div>
				                                <div class="col-md-2">
					                            	<label>to</label> 	                  
					                            </div> 
				                                <div class="col-md-5">
				                                	<input type="text" id="{!element.apiName}__To" fldType="{!element.fldType}" objectName = "{!element.objectName}" labelName = "{!element.labelName}" onChange="changeFlagStatus('{!element.apiName}','date');" class="form-control filterElements"/>
				                                	<script type="text/javascript" src="{!URLFOR($Resource.BootStrapDatePicker,'/jquery.min.js')}"/>
				                                	<apex:stylesheet value="{!URLFOR($Resource.BootStrapDatePicker,'/bootstrap-datepicker3.standalone.css')}"/>
				                                	<script type="text/javascript" src="{!URLFOR($Resource.BootStrapDatePicker,'/bootstrap-datepicker.js')}"/>
				                                	<apex:outputPanel id="topicker">
				                                	<script>
				                                		$('[id*={!element.apiName}__To]').datepicker({
		                                                     format: "mm/dd/yyyy",
		                                                     autoclose: true,
		                                                     daysOfWeekDisabled : '[0]'
		                                                 })
		                                                 .on('changeDate',function(ev){
		                                                 var StartDate = '{!element.apiName}__From';
		                                                 var EndDate = '{!element.apiName}__To';
		                                                 if(document.getElementById(StartDate).value!=null && document.getElementById(EndDate).value!=null && document.getElementById(StartDate).value!='' && document.getElementById(EndDate).value!='')
		                                                 {                   
		                                                     var StartDateValue = document.getElementById(StartDate).value;
		                                                     var EndDateValue = document.getElementById(EndDate).value;		                                                     
		                                                     
		                                                     var dtStartDate = new Date(StartDateValue);
		                                                     var dtEndDate = new Date(EndDateValue);
		                                                     if(dtStartDate > dtEndDate)
		                                                     {
		                                                         alert('Please select valid date: From Date cannot be greater than To Date');
		                                                         document.getElementById(EndDate).value = '';
		                                                     }
		                                                 }
		                                                 return false;       
		                                                 });
				                                	</script>
				                                	</apex:outputPanel>
				                                </div>
			                                </div>
			                            </div>
			                        </apex:outputPanel>
		                    	</apex:repeat>
		                    	</apex:outputPanel>
		                    	</apex:outputPanel>
		                    	</div>      
			        		</td>
			        		<td width="80%">	        			
			        			<apex:outputPanel id="searchResults">
			        				<div class="columnDiv">
				        				<apex:repeat value="{!lstRecordWrapper}" var="objRecordWrapper" rendered="{!(strSelectedValue == 'Properties' || strSelectedValue == 'PropertyAndUnits' || (strSearchTerm == null && strSelectedValue == 'PropertyAndUnits'))}">		        					
				        					<div class="resultDiv">
					        					<img class="img-rounded" style="{!IF(objRecordWrapper.objProperty.Property_Image__c!=null,'float:left;','display:none;')}" src="{!objRecordWrapper.objProperty.Property_Image__c}" width="100" height="100"/>
					        						<div>
							        					<a href="/{!objRecordWrapper.objProperty.Id}" target="_blank" class="recordLink">{!objRecordWrapper.objProperty.Name}</a>
							        					<div>
								        					<span>
									        					<i><label>{!objRecordWrapper.objProperty.DW_Address__c}</label>&nbsp;
									        					<label>{!objRecordWrapper.objProperty.DW_City__c}</label>&nbsp;
									        					<label>{!objRecordWrapper.objProperty.DW_State__c}</label></i>
								        					</span>
								        				</div>
								        				<p class="{!IF(objRecordWrapper.objProperty.Property_Image__c!=null,'descriptionWithImage','descriptionWithoutImage')}"><span>{!objRecordWrapper.objProperty.DW_Business_Unit_Desc__c}</span></p>
						        					</div>
							        				<div class="fieldsInfoDiv">
							        					<p><span style="{!IF(objRecordWrapper.objProperty.DW_Property_Manager__c==null,'display:none;','display:inline;')}"><label>DW Property Manager :</label> {!objRecordWrapper.objProperty.DW_Property_Manager__r.Name}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objProperty.DW_Asset_Manager__c==null,'display:none;','display:inline;')}"><label>DW Asset Manager :</label> {!objRecordWrapper.objProperty.DW_Asset_Manager__r.Name}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objProperty.DW_Property_Type__c==null,'display:none;','display:inline;')}"><label>DW Property Type :</label> {!objRecordWrapper.objProperty.DW_Property_Type__c}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objProperty.DW_Num_of_Units__c==null,'display:none;','display:inline;')}"><label>DW # of Units :</label> {!objRecordWrapper.objProperty.DW_Num_of_Units__c}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objProperty.DW_Total_Financial_Occupancy__c==null,'display:none;','display:inline;')}"><label>DW Total Financial Occupancy :</label> {!objRecordWrapper.objProperty.DW_Total_Financial_Occupancy__c} &nbsp; &nbsp;</span><span style="{!IF(objRecordWrapper.objProperty.DW_Property_Status__c==null,'display:none;','display:inline;')}"><label>DW Property Status :</label> {!objRecordWrapper.objProperty.DW_Property_Status__c}</span> </p>
							        				</div>
							        				<apex:repeat value="{!objRecordWrapper.lstUnit}" var="objUnit">
							        					<div style="padding-left:30px;margin-top:20px;">
							        						<img class="img-rounded" style="{!IF(objUnit.Unit_Image__c!=null,'float:left;','display:none;')}" src="{!objUnit.Unit_Image__c}" width="100" height="100"/>
							        						<a href="/{!objUnit.Id}" target="_blank" class="recordLink">{!objUnit.DW_Unit_Number__c} - {!objRecordWrapper.objProperty.Name}</a>
							        						<div>
							        							<p class="{!IF(objUnit.Unit_Image__c!=null,'descriptionWithImageForUnit','descriptionWithoutImage')}">{!objUnit.Comments__c}</p>
							        						</div>
							        						<div class="fieldsInfoDiv">
									        					<p><span style="{!IF(objUnit.DW_Local_Tenant__c==null,'display:none;','display:inline;')}"><label>DW Local Tenant :</label> {!objUnit.DW_Local_Tenant__c} &nbsp;&nbsp;</span><span style="{!IF(objUnit.Vacancy_Date__c==null,'display:none;','display:inline;')}"><label>Vacancy Date :</label>
									        					<apex:outputText value=" {0,date,MM/dd/yyyy}">
									        						<apex:param value="{!objUnit.Vacancy_Date__c}"/>
									        					</apex:outputText>&nbsp;&nbsp;</span><span style="{!IF(objUnit.DW_Unit_Square_Feet__c==null,'display:none;','display:inline;')}"><label>DW Unit Square Feet :</label> {!objUnit.DW_Unit_Square_Feet__c} &nbsp;&nbsp; </span><span style="{!IF(objUnit.Unit_Status__c==null,'display:none;','display:inline;')}"><label>Unit Status :</label> {!objUnit.Unit_Status__c}&nbsp;&nbsp;</span><span style="{!IF(objUnit.Budgeted_Net_Effective_Rent_NER__c==null,'display:none;','display:inline;')}"><label>Budgeted Internal Rate of Return (IRR) :</label> {!objUnit.Budgeted_Net_Effective_Rent_NER__c}&nbsp;&nbsp;</span><span style="{!IF(objUnit.Budgeted_TI__c==null,'display:none;','display:inline;')}"><label>Budgeted TI :</label> {!objUnit.Budgeted_TI__c}</span></p>
									        				</div>
							        					</div>
							        				</apex:repeat>
					        					</div>			        				
				        				</apex:repeat>
				        				<apex:repeat value="{!lstRecordWrapper}" var="objRecordWrapper" rendered="{!strSelectedValue == 'Units'}">
				        					<div class="resultDiv">
				        						<img class="img-rounded" style="{!IF(objRecordWrapper.objUnit.Unit_Image__c!=null,'float:left;','display:none;')}" src="{!objRecordWrapper.objUnit.Unit_Image__c}" width="100" height="100"/>
				        						<a href="/{!objRecordWrapper.objUnit.Id}" target="_blank" class="recordLink">{!objRecordWrapper.objUnit.DW_Unit_Number__c} - {!objRecordWrapper.objUnit.Property__r.Name}</a>
				        						<div>
				        							<p class="{!IF(objRecordWrapper.objUnit.Unit_Image__c!=null,'descriptionWithImageForUnit','descriptionWithoutImage')}">{!objRecordWrapper.objUnit.Comments__c}</p>
				        						</div>
				        						<div class="fieldsInfoDiv">
							        					<p><span style="{!IF(objRecordWrapper.objUnit.DW_Local_Tenant__c==null,'display:none;','display:inline;')}"><label>DW Local Tenant :</label> {!objRecordWrapper.objUnit.DW_Local_Tenant__c} &nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objUnit.Vacancy_Date__c==null,'display:none;','display:inline;')}"><label>Vacancy Date :</label>
							        					<apex:outputText value=" {0,date,MM/dd/yyyy}">
							        						<apex:param value="{!objRecordWrapper.objUnit.Vacancy_Date__c}"/>
							        					</apex:outputText>&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objUnit.DW_Unit_Square_Feet__c==null,'display:none;','display:inline;')}"><label>DW Unit Square Feet :</label> {!objRecordWrapper.objUnit.DW_Unit_Square_Feet__c} &nbsp;&nbsp; </span><span style="{!IF(objRecordWrapper.objUnit.Unit_Status__c==null,'display:none;','display:inline;')}"><label>Unit Status :</label> {!objRecordWrapper.objUnit.Unit_Status__c}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objUnit.Budgeted_Net_Effective_Rent_NER__c==null,'display:none;','display:inline;')}"><label>Budgeted Internal Rate of Return (IRR) :</label> {!objRecordWrapper.objUnit.Budgeted_Net_Effective_Rent_NER__c}&nbsp;&nbsp;</span><span style="{!IF(objRecordWrapper.objUnit.Budgeted_TI__c==null,'display:none;','display:inline;')}"><label>Budgeted TI :</label> {!objRecordWrapper.objUnit.Budgeted_TI__c}</span></p>
									        	</div>
							        		</div>
				        				</apex:repeat>
			        				</div>
			        			</apex:outputPanel>
			        		</td>
			        	</tr>
			        </table>
				</div>
		     </apex:form>
	     </div>
     </body>
	<script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'sl_jq_213.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'sl_blockui.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'sl_bootstrap_js.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'bootstrap-select.min.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'papaparse.min.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.SL_Bootstrap,'filesaver.min.js')}"></script>
    
    <script>
        function changeFlagStatus(elementId, fieldType)
        {
        	  if(fieldType=='string' || fieldType=='reference')
        	  {
              		$('#'+elementId+'_Checkbox').prop('checked', $('#'+elementId).val()!=null && $('#'+elementId).val()!='' ? true : false);
              }
              else if(fieldType=='number')
              {
              	  if(($('#'+elementId+'__High').val()!=null && $('#'+elementId+'__High').val()!='') || ($('#'+elementId+'__Low').val()!=null && $('#'+elementId+'__Low').val()!=''))
              	  	$('#'+elementId+'_Checkbox').prop('checked', true);
              	  else
              	  	$('#'+elementId+'_Checkbox').prop('checked', false);
              }
              else if(fieldType=='date')
              {
              		if(($('#'+elementId+'__From').val()!=null && $('#'+elementId+'__From').val()!='') || ($('#'+elementId+'__To').val()!=null && $('#'+elementId+'__To').val()!=''))
              	  		$('#'+elementId+'_Checkbox').prop('checked', true);
              	  	else
              	  		$('#'+elementId+'_Checkbox').prop('checked', false);
              }
              else if(fieldType=='picklist')
              {
              		if($('#'+elementId).val()!='--None--')
              	  		$('#'+elementId+'_Checkbox').prop('checked', true);
              	  	else
              	  		$('#'+elementId+'_Checkbox').prop('checked', false);
              }
        }
        
        function search()
        {
        	$.blockUI();
        	var unitWhereClause = '';
        	var propertyWhereClause = '';        	
        	$.each($('.filterElements'),
        		function(i,v){
        			var element = $(v);
                    if(element.attr('fldType') != undefined && element.val()!=null && element.val()!='' && (element.attr('fldType') == 'boolean' || $('#'+v.id.replace('__Low','').replace('__High','').replace('__From','').replace('__To','').trim()+'_Checkbox').is(':checked')))
                    {
                     	if(element.attr('fldType') == 'string')
                     	{
                     		if(element.attr('objectName') == 'Unit__c')
                     		{
                     			unitWhereClause+= unitWhereClause!='' ? ' AND '+v.id+' like '+"'%"+element.val()+"%'" : ' WHERE '+v.id+' like '+"'%"+element.val()+"%'";
                     		}
                     		else
                     		{
                     			propertyWhereClause+= propertyWhereClause!='' ? ' AND '+v.id+' like '+"'%"+element.val()+"%'" : ' WHERE '+v.id+' like '+"'%"+element.val()+"%'";
                     		}
                     	}
                     	else if(element.attr('fldType') == 'number')
                     	{
                     		var elementId = v.id;
                     		if(element.attr('objectName') == 'Unit__c')
                     		{
                     			if(elementId.indexOf('__Low')!=-1)
                     			{
                     				var elementId = elementId.replace('__Low','').trim();
                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' >= '+element.val() : ' WHERE '+elementId+' >= '+element.val();
                     			}
                     			else
                     			{
                     				var elementId = elementId.replace('__High','').trim();
                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' <= '+element.val() : ' WHERE '+elementId+' <= '+element.val();
                     			}
                     		}
                     		else
                     		{
                     			if(elementId.indexOf('__Low')!=-1)
                     			{
                     				var elementId = elementId.replace('__Low','').trim();
                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' >= '+element.val() : ' WHERE '+elementId+' >= '+element.val();
                     			}
                     			else
                     			{
                     				var elementId = elementId.replace('__High','').trim();
                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' <= '+element.val() : ' WHERE '+elementId+' <= '+element.val();
                     			}
                     		}
                     	}
                     	else if(element.attr('fldType') == 'boolean' && element.is(':checked'))
                     	{
                     		if(element.attr('objectName') == 'Unit__c')
                     		{
                     			unitWhereClause+= unitWhereClause!='' ? ' AND '+v.id+' = true': ' WHERE '+v.id+' = true';
                     		}
                     		else
                     		{
                     			propertyWhereClause+= propertyWhereClause!='' ? ' AND '+v.id+' = true' : ' WHERE '+v.id+' = true';
                     		}
                     	}
                     	else if(element.attr('fldType') == 'date' || element.attr('fldType') == 'datetime')
                     	{
                     		var elementId = v.id;
                     		if(element.attr('fldType') == 'datetime')
                     		{
	                     		if(element.attr('objectName') == 'Unit__c')
	                     		{
	                     			if(elementId.indexOf('__From')!=-1)
	                     			{
	                     				var elementId = elementId.replace('__From','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue)+'T00:00:00Z';
	                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' >= '+dateString : ' WHERE '+elementId+' >= '+dateString;
	                     			}
	                     			else
	                     			{
	                     				var elementId = elementId.replace('__To','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue)+'T23:59:59Z';
	                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' <= '+dateString : ' WHERE '+elementId+' <= '+dateString;
	                     			}
	                     		}
	                     		else
	                     		{
	                     			if(elementId.indexOf('__From')!=-1)
	                     			{
	                     				var elementId = elementId.replace('__From','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue)+'T00:00:00Z';
	                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' >= '+dateString : ' WHERE '+elementId+' >= '+dateString;
	                     			}
	                     			else
	                     			{
	                     				var elementId = elementId.replace('__To','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue)+'T23:59:59Z';
	                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' <= '+dateString : ' WHERE '+elementId+' <= '+dateString;
	                     			}
	                     		}
                     		}
                     		else
                     		{
                     			if(element.attr('objectName') == 'Unit__c')
	                     		{
	                     			if(elementId.indexOf('__From')!=-1)
	                     			{
	                     				var elementId = elementId.replace('__From','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue);
	                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' >= '+dateString : ' WHERE '+elementId+' >= '+dateString;
	                     			}
	                     			else
	                     			{
	                     				var elementId = elementId.replace('__To','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue);
	                     				unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' <= '+dateString : ' WHERE '+elementId+' <= '+dateString;
	                     			}
	                     		}
	                     		else
	                     		{
	                     			if(elementId.indexOf('__From')!=-1)
	                     			{
	                     				var elementId = elementId.replace('__From','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue);
	                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' >= '+dateString : ' WHERE '+elementId+' >= '+dateString;
	                     			}
	                     			else
	                     			{
	                     				var elementId = elementId.replace('__To','').trim();
	                     				var dateValue = new Date(element.val());
	                     				var monthValue = dateValue.getMonth()+1;
	                     				var dayValue = dateValue.getDate();
	                     				var dateString = dateValue.getFullYear()+'-'+ (monthValue <= 9 ? '0' + monthValue : monthValue)+'-'+(dayValue <= 9 ? '0' + dayValue : dayValue);
	                     				propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' <= '+dateString : ' WHERE '+elementId+' <= '+dateString;
	                     			}
	                     		}
                     		}
                     	}
                     	else if((element.attr('fldType') == 'picklist' || element.attr('fldType') == 'multiselect') && element.val()!='--None--')
                     	{
                     		if(element.attr('objectName') == 'Unit__c')
                     		{
                     			unitWhereClause+= unitWhereClause!='' ? ' AND '+v.id+' = '+"'"+element.val()+"'" : ' WHERE '+v.id+' = '+"'"+element.val()+"'";
                     		}
                     		else
                     		{
                     			propertyWhereClause+= propertyWhereClause!='' ? ' AND '+v.id+' = '+"'"+element.val()+"'" : ' WHERE '+v.id+' = '+"'"+element.val()+"'";
                     		}
                     	}
                     	else if(element.attr('fldType') == 'reference')
                     	{
                     		var elementId = v.id;
                     		elementId = elementId.replace('__r_Name','__r.Name');
                     		if(element.attr('objectName') == 'Unit__c')
                     		{
                     			unitWhereClause+= unitWhereClause!='' ? ' AND '+elementId+' like '+"'%"+element.val()+"%'" : ' WHERE '+elementId+' like '+"'%"+element.val()+"%'";
                     		}
                     		else
                     		{
                     			propertyWhereClause+= propertyWhereClause!='' ? ' AND '+elementId+' like '+"'%"+element.val()+"%'" : ' WHERE '+elementId+' like '+"'%"+element.val()+"%'";
                     		}
                     	}
                    }
        		}
        	);
        	
        	searchAF($('#searchTerm').val(), $('#choiceType').val(),unitWhereClause,propertyWhereClause);
        	return false;
        }
        
        function unblockUI()
        {
        	$.unblockUI();
        }
        
        function updateFilters()
        {
        	clearFilters();
        	var selectedValue = $('#choiceType').val();
        	$.each($('.filterDiv'),function(index, value)
        	{
        		var element = $(value);
        		if(selectedValue == 'Units')
        		{
        			element.css('display',element.attr('objectName') == 'Property__c' ? 'none' : 'block');
        		}
        		else if(selectedValue == 'Properties')
        		{
        			element.css('display',element.attr('objectName') == 'Unit__c' ? 'none' : 'block');
        		}
        		else
        		{
        			element.css('display','block');
        		}
        	}
        	);
        }
        
        function clearFilters()
        {
        	$.each($('.filterElements'), function(index,value)
        	{
        		var element = $(value);
        		$('#'+value.id.replace('__Low','').replace('__High','').replace('__To','').replace('__From','').trim()+'_Checkbox').attr('checked',false);
        		if(element.is(':checkbox'))
        			element.attr('checked',false);
        		else if(element.is('select'))
        			element.val('--None--');
        		else
        			element.val('');
        	});
        }                                           
    </script>
</apex:page>