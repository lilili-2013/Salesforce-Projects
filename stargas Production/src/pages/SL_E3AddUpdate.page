<apex:page standardController="Opportunity" extensions="SL_E3AddUpdateController">
  <script language="javascript">
  function validateSync() {
	if ({!Opportunity.synced_with_e3__c} == true) {
		if (confirm('This Opportunity has already been synced with E3.  Continue anyway?')) 
		{
		alert('addUpdateE3()');
		JSaddUpdateE3();
		}
	}  else 
	{
		alert('Not synced, addUpdateE3();');
		JSaddUpdateE3(); 
	}
  }

  </script>
  
  <apex:form >
  		
        <apex:pageBlock mode="edit" id="block">
         <apex:pageBlockSection >
         	<apex:pageBlockSectionItem >
         		<apex:outputLabel >Energy Account #</apex:outputLabel>
         		<apex:outputText >{!opportunity.Energy_AccountNum__c}</apex:outputText>
         	</apex:pageBlockSectionItem>
         	<apex:pageBlockSectionItem >
         		<apex:outputLabel >Synced with E3?</apex:outputLabel>
         		<apex:inputCheckbox value="{!opportunity.Synced_with_E3__c}" disabled="true"/>
         	</apex:pageBlockSectionItem>
         	
         	
            <apex:pageBlockSectionItem >
               <apex:outputLabel >Sync</apex:outputLabel>
               <apex:panelGroup id="syncPanelGroup" >
               	  <apex:actionFunction name="JSaddUpdateE3" action="{!AddUpdateE3}" rerender="block, E3SyncLogOutField" status="status"/>
               	  <apex:actionFunction name="JSclearAllSyncData" action="{!ClearAllSyncData}" rerender="block, E3SyncLogOutField" status="status"/>
                  <apex:commandButton value="Add to E3" action="{!AddUpdateE3}" rerender="block, E3SyncLogOutField" status="status" title="Sync this Opportunity and all its related Prospect Service Contracts to E3.  NOTE: if this Opportunity's parent Account does not yet exist in E3, this action will create a new E3 Master Account for this SFDC Account)."/>
                  <apex:commandButton value="Clear Sync Data" action="{!ClearAllSyncData}" rerender="block, E3SyncLogOutField" status="status" title="Clears all E3 data for this Opportunity, its parent Account and any related Prospect Service Contracts."/>
                  	<apex:actionStatus id="status">
						<apex:facet name="start">
							<img src="{!$Resource.iconLoading}"/>
						</apex:facet>
					</apex:actionStatus>
               </apex:panelGroup>
            </apex:pageBlockSectionItem>
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" >
            <apex:pageBlockSectionItem >
            	<apex:outputLabel value="Response"/>
				<apex:outputPanel >
				<div style="overflow: auto;">
				  <pre style="white-space: pre-wrap">{!response}</pre>
				</div>        				
				</apex:outputPanel> 
            </apex:pageBlockSectionItem> 
        </apex:pageBlockSection>
		<apex:pageBlockSection columns="1" >
			<apex:pageBlockSectionItem >
			<apex:outputLabel >E3 Sync Log</apex:outputLabel>
			<apex:outputPanel id="E3SyncLogOutField">
				<div style="overflow: auto; height:140px; width:100%; font-size:10pt;">
				  <pre>{!opportunity.E3_sync_log__c}</pre>
				</div>        
			</apex:outputPanel> 
			</apex:pageBlockSectionItem>
		</apex:pageBlockSection>
      </apex:pageBlock> 
   </apex:form>
 
</apex:page>