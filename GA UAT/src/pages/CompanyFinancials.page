<apex:page standardController="Account" extensions="CompanyFinancialsController" tabStyle="Account">
  <apex:styleSheet value="{!URLFOR($Resource.FinancialsPageCSS)}" />

  <apex:pageBlock title="Company Financials Snapshot">
    <table border="0" width="{!(financialsCount * 150)+200}" class="list">
      <tr class="headerRow">
        <td width="200">&nbsp;</td>
        <apex:repeat value="{!financials}" var="cf" id="yearsRow">
          <td class="financialsHeader">
            <apex:outputText value="{!cf.Year__c}" id="yearCol"/>
            <apex:outputText rendered="{!IF(cf.Type__c=='Estimated',true,false)}">E</apex:outputText>
          </td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td> &nbsp; </td></apex:outputText>
      </tr>
      <tr>
        <td class="financialsHeader">Revenue (MM)</td>
        <apex:repeat value="{!financials}" var="cf" id="revenuesRow">
          <td><apex:outputText value="{! ROUND(cf.Revenue_MM__c,1)}" id="revenueCol"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>        
      </tr>
      <tr>
        <td class="financialsHeader"><span style="padding-left: 20px">Revenue % Growth</span></td>
        <apex:repeat value="{!financials}" var="cf" id="revenueGrowthsRow">
          <td><apex:outputText value="{!ROUND(cf.Revenue_Growth__c*100,1)}%" id="revenueGrowthCol" rendered="{!NOT(ISBLANK(cf.Revenue_Growth__c))}"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>        
      </tr>
      <tr>
        <td class="financialsHeader">EBITDA (MM)</td>
        <apex:repeat value="{!financials}" var="cf" id="ebitdasRow">
          <td><apex:outputText value="{! ROUND(cf.EBITDA_MM__c,1) }" id="ebitdasCol"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>
      </tr>
      <tr>
        <td class="financialsHeader"><span style="padding-left: 20px">EBITDA % Margin</span></td>
        <apex:repeat value="{!financials}" var="cf" id="ebitdamarginsRow">
          <td><apex:outputText value="{!IF (cf.Revenue_MM__c = 0,0, ROUND((cf.EBITDA_MM__c / cf.Revenue_MM__c)*100,1))}%" id="ebitdamarginCol"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>
      </tr>
      <tr>
        <td class="financialsHeader">Net Income</td>
        <apex:repeat value="{!financials}" var="cf" id="pretaxesRow">
          <td><apex:outputText value="{! ROUND(cf.Pre_Tax_MM__c,1)}" id="pretaxCol"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>        
      </tr>       
      <tr>
        <td class="financialsHeader"><span style="padding-left: 20px">Profit % Margin</span></td>
        <apex:repeat value="{!financials}" var="cf" id="profitmarginsRow">
          <td><apex:outputText value="{!IF (cf.Revenue_MM__c = 0, 0, ROUND((cf.Pre_Tax_MM__c / cf.Revenue_MM__c)*100,1))}%" id="profitmarginCol"/></td>
        </apex:repeat>
        <apex:outputText rendered="{!IF(financialsCount==0,true,false)}"><td align="center">n/a</td></apex:outputText>        
      </tr>                  
    </table>
    <apex:form target="_top"><apex:commandButton action="{!manageFinancials}" value="Manage Financials"/></apex:form>
  </apex:pageBlock>
</apex:page>