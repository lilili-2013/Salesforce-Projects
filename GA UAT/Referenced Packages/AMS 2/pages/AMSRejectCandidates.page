<apex:page controller="ts2extams.AMSMassActionController" showHeader="false" sideBar="false" action="{!SetSelectedRecords}">
		<apex:includeScript value="{!URLFOR($Resource.ts2extams__UIRes, 'res/js/jquery-1.6.min.js')}" />
		<apex:includeScript value="{!URLFOR($Resource.ts2__stcode, 'res/js/ui-2.js')}" />
		<apex:stylesheet value="{!URLFOR($Resource.ts2extams__UIRes, 'res/css/std_style.css')}"/>
		<apex:includeScript value="/apexpages/fckeditor/fckeditor.js"/>
		<apex:stylesheet value="{!URLFOR($Resource.ts2__stcode, 'res/css/ui-2.css')}"/>


<style>
	td.pbTitle {width:40% !important;}
</style>
<script>
	FCKeditor_IsCompatibleBrowser = function () {
		var sAgent = navigator.userAgent.toLowerCase() ;

		if (getInternetExplorerVersion() == "11")
			return true;

		if (getInternetExplorerVersion() == "10")
			return true;

		// Internet Explorer 5.5+
		if ( /msie/i.test(sAgent) && !/opera/i.test(sAgent) && sAgent.indexOf("mac") == -1 ) {
			var sBrowserVersion = navigator.appVersion.match(/MSIE (.\..)/)[1] ;
			return ( sBrowserVersion >= 5.5 ) ;
		}

		// Gecko (Opera 9 tries to behave like Gecko at this point).
		if ( navigator.product == "Gecko" && navigator.productSub >= 20030210 && !( typeof(opera) == 'object' && opera.postError ) )
			return true ;

		// Opera 9.50+
		if ( window.opera && window.opera.version && parseFloat( window.opera.version() ) >= 9.5 )
			return true ;

		// Adobe AIR
		// Checked before Safari because AIR have the WebKit rich text editor
		// features from Safari 3.0.4, but the version reported is 420.
		if ( sAgent.indexOf( ' adobeair/' ) != -1 )
			return ( sAgent.match( / adobeair\/(\d+)/ )[1] >= 1 ) ;	// Build must be at least v1

		// Safari 3+
		if ( sAgent.indexOf( ' applewebkit/' ) != -1 )
			return ( sAgent.match( / applewebkit\/(\d+)/ )[1] >= 522 ) ;	// Build must be at least 522 (v3)

		return false ;
	}

	function getInternetExplorerVersion() {
		var rv = -1;
		if (navigator.appName == 'Microsoft Internet Explorer') {
			var ua = navigator.userAgent;
			var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
			if (re.exec(ua) != null) {
				rv = parseFloat( RegExp.$1 );
			}
		}
		else if (navigator.appName == 'Netscape') {
			var ua = navigator.userAgent;
			var re  = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
			if (re.exec(ua) != null) {
				rv = parseFloat( RegExp.$1 );
			}
		}
		return rv;
	}

	function updateHiddenField() {
		var hiddenField = jQuery('[id$=hiddenRejectTypeField]');
		hiddenField[0].value = jQuery('[id$=rejReason1]')[0].value;
	}

</script>

<body width="100%" style="margin:10px;">
<apex:form id="frm">
	<script>
		var refreshUrl = "{!JSENCODE(RefreshUrl)}";
	</script>
	<apex:pageMessages id="pageMessages" />
	<apex:pageBlock title="{!$Label.AMS_LABEL_Reject}" rendered="{!NOT($Setup.ts2__ApplicantManagementSystem__c.Reject_Button__c)}">
		<apex:pageMessage summary="{!$Label.AMS_ERROR_Privileges}" severity="warning" strength="2" />
	</apex:pageBlock>
		<apex:pageBlock title="{!$Label.AMS_LABEL_Reject}" mode="details" rendered="{!NOT(HasFatalMessages) && $Setup.ts2__ApplicantManagementSystem__c.Reject_Button__c}" >

			<apex:pageBlockButtons id="pbbsMainButtons" style="text-align: right;" location="both">
				<span id="pbsMainButtons_spinner" class="spinner_indicator">&nbsp;</span>
				<apex:commandButton id="buttonId" rerender="buttonId" value="{!$Label.AMS_BTN_Reject}" title="{!$Label.AMS_BTN_Reject}" rendered="{!if((NOT(Completed) && !MassButtonError),true,false)}" onclick="setValueFromEditor();jQuery('#pbsMainButtons_spinner').addClass('spinner_on');jQuery('[id*=pbbsMainButtons] input.btn').attr('disabled','disabled').addClass('btnDisabled');" />
				<apex:actionFunction name="RejectCandidatesAction" action="{!RejectCandidatesAction}" rerender="frm"/>
				<apex:actionFunction name="RejectCandidatesActionHtml" action="{!RejectCandidatesAction}" rerender="frm">
					<apex:param name="var1" value="" assignTo="{!eventCC.Description}" />
				</apex:actionFunction>
				<apex:commandButton id="template_button_id" value="{!$Label.ts2__SelectTemplate}" title="{!$Label.ts2__SelectTemplate}" rendered="{!NOT(Completed)}" onclick="openTemplateSelectorWindow();return(false);" style="display:none;"/>
				<apex:commandButton value="{!$Label.AMS_BTN_Cancel}" title="{!$Label.AMS_BTN_Cancel}" rendered="{!NOT(Completed)}" onclick="closeWin(true);return(false);" />
				<apex:commandButton value="{!$Label.AMS_BTN_Close}" title="{!$Label.AMS_BTN_Close}"  rendered="{!Completed}"  onclick="closeWin(true);return(false);" />
			</apex:pageBlockButtons>

			<apex:panelGrid columns="1" rendered="{!NOT(Completed)}">
				<apex:outputText value="{!$Label.AMS_LABEL_Reject_Candidates_List}" rendered="{!IF(ListOpenApplicationForReject.SIZE < 50, true, false)}"/>
				<apex:outputText value="{!$Label.AMS_LABEL_Reject_Candidates_List_Limit}" rendered="{!IF(ListOpenApplicationForReject.SIZE == 50, true, false)}"/>
			</apex:panelGrid>

			<apex:pageBlockSection id="pbsApplications" title="{!$ObjectType.ts2__Application__c.LabelPlural}" columns="1" rendered="{!if((NOT(Completed) && !MassButtonError),true,false)}">
				<script type="text/javascript">
					var block = document.getElementById(jQuery('[id$=pbsApplications]').attr('id'));
					if (block) {
						var div = block.childNodes[0];
						if (div) {
							var listImage = block.getElementsByTagName('img');
							twistSection(listImage[0]);
						}
					}
				</script>
				<apex:pageBlockTable id="ApplicationsListTable" value="{!ListOpenApplicationForReject}" var="app" width="98%" >
					<apex:column headerValue="{!$ObjectType.Contact.Fields.Name.Label}" value="{!app.ts2__Candidate_Contact__r.Name}" />
					<apex:column headerValue="{!$ObjectType.ts2__Job__c.Fields.Name.Label}" value="{!app.ts2__Job__r.Name}" />
					<apex:column headerValue="{!$ObjectType.ts2__Application__c.Fields.ts2__Stage__c.Label}" value="{!app.ts2__Stage__c}" />
					<apex:column headerValue="{!$ObjectType.ts2__Application__c.Fields.ts2extams__Substatus__c.Label}" value="{!app.ts2extams__Substatus__c}" />
				</apex:pageBlockTable>
			</apex:pageBlockSection>

			<apex:pageBlockSection id="pbsMain" columns="1" rendered="{!if((NOT(Completed) && !MassButtonError),true,false)}">
				<apex:panelGrid columns="1" >
					<apex:outputText value="{!$Label.AMS_LABEL_RejectHelpText}" />
				</apex:panelGrid>

				<!-- SINGLE REJECTION -->
				<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!NOT(IsMassAction)}">
					<apex:outputLabel value="{!$Label.AMS_LABEL_RejectReason}" />
					<apex:outputPanel layout="block">
						<apex:inputField rendered="{!supportedApplicationRecord != NULL && supportedPlacementRecord == NULL}" value="{!supportedApplicationRecord.ts2__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedApplicationRecord != NULL && supportedPlacementRecord != NULL}" value="{!supportedApplicationRecord.ts2__Overall_Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedSubmittalRecord != NULL}" value="{!supportedSubmittalRecord.ts2__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedInterviewRecord != NULL}" value="{!supportedInterviewRecord.ts2__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedOfferRecord != NULL}" value="{!supportedOfferRecord.ts2__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedCS1Record != NULL}" value="{!supportedCS1Record.ts2extams__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedCS2Record != NULL}" value="{!supportedCS2Record.ts2extams__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedCS3Record != NULL}" value="{!supportedCS3Record.ts2extams__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedCS4Record != NULL}" value="{!supportedCS4Record.ts2extams__Reject_Reason__c}" />
						<apex:inputField rendered="{!supportedCS5Record != NULL}" value="{!supportedCS5Record.ts2extams__Reject_Reason__c}" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
				<!-- SINGLE REJECTION DETAIL-->
				<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(NOT(IsMassAction), isRejectionDependentPicklistEnabled)}">
					<apex:outputLabel value="{!$Label.AMS_LABEL_RejectDetail}" />
					<apex:outputPanel layout="block">
						<apex:inputField rendered="{!supportedApplicationRecord != NULL && supportedPlacementRecord == NULL}" value="{!supportedApplicationRecord.ts2__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedApplicationRecord != NULL && supportedPlacementRecord != NULL}" value="{!supportedApplicationRecord.ts2__Overall_Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedSubmittalRecord != NULL}" value="{!supportedSubmittalRecord.ts2__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedInterviewRecord != NULL}" value="{!supportedInterviewRecord.ts2__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedOfferRecord != NULL}" value="{!supportedOfferRecord.ts2__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedCS1Record != NULL}" value="{!supportedCS1Record.ts2extams__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedCS2Record != NULL}" value="{!supportedCS2Record.ts2extams__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedCS3Record != NULL}" value="{!supportedCS3Record.ts2extams__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedCS4Record != NULL}" value="{!supportedCS4Record.ts2extams__Reject_Detail__c}" />
						<apex:inputField rendered="{!supportedCS5Record != NULL}" value="{!supportedCS5Record.ts2extams__Reject_Detail__c}" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>


				<!-- MASS REJECTION -->
				<apex:repeat var="obj" value="{!supportedObjects}">
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, objectprefix != 'ts2extams')}">
						<apex:outputText value="{!$Label.AMS_LABEL_RecordType}: {!obj['ts2__Status__c']}"/>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, objectprefix == 'ts2extams')}">
						<apex:outputText value="{!$Label.AMS_LABEL_RecordType}: {!obj['Status__c']}"/>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, objectprefix != 'ts2extams', objectprefix == 'ts2__Appl')}">
						<apex:outputLabel for="massRejectReason" value="{!$Label.AMS_LABEL_RejectReason}" />
						<apex:outputPanel id="massRejectReason">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['ts2__Overall_Reject_Reason__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, objectprefix != 'ts2extams', objectprefix != 'ts2__Appl')}">
						<apex:outputLabel for="massRejectReason" value="{!$Label.AMS_LABEL_RejectReason}" />
						<apex:outputPanel id="massRejectReason">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['ts2__Reject_Reason__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, objectprefix == 'ts2extams')}">
						<apex:outputLabel for="massRejectReason" value="{!$Label.AMS_LABEL_RejectReason}" />
						<apex:outputPanel id="massRejectReason">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['Reject_Reason__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
					<!-- MASS REJECTION DETAIL -->
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, isRejectionDependentPicklistEnabled, objectprefix != 'ts2extams', objectprefix == 'ts2__Appl')}">
						<apex:outputLabel for="massRejectDetail" value="{!$Label.AMS_LABEL_RejectDetail}" />
						<apex:outputPanel id="massRejectDetail">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['ts2__Overall_Reject_Detail__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, isRejectionDependentPicklistEnabled, objectprefix != 'ts2extams', objectprefix != 'ts2__Appl')}">
						<apex:outputLabel for="massRejectDetail" value="{!$Label.AMS_LABEL_RejectDetail}" />
						<apex:outputPanel id="massRejectDetail">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['ts2__Reject_Detail__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
					<apex:pageBlockSectionItem labelStyle="width:24%; padding-top: 10px;" rendered="{!AND(IsMassAction, isRejectionDependentPicklistEnabled, objectprefix == 'ts2extams')}">
						<apex:outputLabel for="massRejectDetail" value="{!$Label.AMS_LABEL_RejectDetail}" />
						<apex:outputPanel id="massRejectDetail">
							<apex:outputPanel rendered="{!IsMassAction}">
									<apex:inputField value="{!obj['Reject_Detail__c']}"/><br/>
							</apex:outputPanel>
						</apex:outputPanel>
					</apex:pageBlockSectionItem>
				</apex:repeat>

				<apex:pageBlockSectionItem rendered="{!if((NOT(Completed) && !MassButtonError && $Setup.ts2__ApplicantManagementSystem__c.Enable_Rejection_Comments__c),true,false)}" labelStyle="width:24%;">
					<apex:outputLabel for="Comments" value="Comments" />
					<apex:outputPanel id="Comments">
						<apex:inputTextArea style="width:350px; height:110px; border:1px solid #666666;" value="{!RejectComment}" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
			</apex:pageBlockSection>

			<apex:inputHidden value="{!isRejectEmailShown}" id="passingRejectEmailParam" />
			<apex:pageBlockSection columns="1" id="RejectEmailSection" onclick="toggleRejectEmailIndicator();" title="{!$Label.AMS_LABEL_Enhanced_Rejection_Process}" rendered="{!if((NOT(Completed) && !MassButtonError && $Setup.ts2__ApplicantManagementSystem__c.Enable_Enhanced_Rejection__c),true,false)}">
				<script>

				</script>
				<!-- VF variables -->
				<apex:variable var="enableEdit" value="{!$Setup.ts2__ApplicantManagementSystem__c.Enable_Rejection_Email_Edits__c}" />

				<apex:pageBlockSectionItem labelStyle="width:24%;" >
					<apex:outputLabel value="" />
					<apex:outputLabel value="{!$Label.AMS_LABEL_REJECT_TXT}" style="font-weight:bold;padding-top:10px;" rendered="{!NOT(isRejectError)}"/>
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:24%;" rendered="{!NOT(isRejectError)}">
					<apex:outputLabel value="Send Email To" />
					<apex:outputPanel layout="block" >
						<apex:outputPanel layout="block" styleClass="requiredBlock" />
						<apex:outputText value="{!candidatesToReject}" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:24%;" rendered="{!NOT(isRejectError)}">
					<apex:outputLabel value="CC" />
					<apex:inputField required="false" value="{!eventCC.OwnerId}" />
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:24%;" rendered="{!NOT(isRejectError)}">
					<apex:outputLabel value="BCC" />
					<apex:inputField required="false" value="{!eventBCC.OwnerId}" />
				</apex:pageBlockSectionItem>

				<apex:pageBlockSectionItem labelStyle="width:24%;" rendered="{!NOT(isRejectError)}">
					<apex:outputLabel for="ecndSubject" value="Subject" />
					<apex:actionStatus id="TemplateLoading">
						<apex:facet name="start">
							<apex:outputText style="font-weight:bold;color:red;" value="Loading..." />
						</apex:facet>
						<apex:facet name="stop">
							<apex:outputPanel id="ecndSubject">
								<apex:inputField value="{!eventCC.Subject}" rendered="{!enableEdit}" id="subjectIdEnabled"/>
								<apex:inputField value="{!eventCC.Subject}" rendered="{!NOT(enableEdit)}" id="subjectIdDisabled"/>
								<script>
									jQuery('[id$=subjectIdDisabled]').attr('disabled', 'disabled');
								</script>
							</apex:outputPanel>
						</apex:facet>
					</apex:actionStatus>
				</apex:pageBlockSectionItem>

				<apex:pageBlockSectionItem rendered="{!isMassAction && NOT(isRejectError)}" labelStyle="width:24%;">
					<apex:outputLabel value="" />
					<apex:outputPanel layout="block" >
						<apex:outputPanel layout="block" />
						<apex:outputText style="font-style:italic;" value="{!$Label.AMS_LABEL_MessageOnRejectApplications}" />
					</apex:outputPanel>
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:24%;" rendered="{!NOT(isRejectError)}">
					<apex:outputLabel for="ecndMessage" value="Message" />
					<apex:outputPanel id="ecndMessage">
						<apex:inputField rendered="{!NOT(isTempplateLoaded) }" style="width:350px;height:110px;" value="{!eventCC.Description}" id="messageDisable"/>
						<apex:inputTextArea readonly="{!NOT(enableEdit)}" rendered="{!isTempplateLoaded}" id="Message_box" style="width:350px; height:110px; background-color:#FFFFFF; border:1px solid #666666;" value="{!eventCC.Description}" />

						<apex:outputPanel layout="none" rendered="{!isTempplateLoaded && HtmlView}">
							<script type="text/javascript">
								RerenderEditor();
							</script>
						</apex:outputPanel>
						<script>
							if (!{!enableEdit}) {
								jQuery('[id$=messageDisable]').attr('disabled', 'disabled');
							}
						</script>
					</apex:outputPanel>

				</apex:pageBlockSectionItem>
				<apex:pageMessage summary="{!RejectErrorMSG}" severity="warning" strength="2"  rendered="{!isRejectError}"/>

				<apex:pageBlockSectionItem >
					<apex:pageBlockTable id="Attachments_block" title="{!$ObjectType.Attachment.LabelPlural}" value="{!AttachmentsList}" var="att" width="98%" rendered="true">
						<apex:column headerValue="{!$Label.AMS_LABEL_Select}" width="30px">
							<apex:inputCheckbox value="{!att.selectedAttachment}" />
						</apex:column>
						<apex:column headerValue="{!$Label.AMS_LABEL_Name}" value="{!att.attachmentName}" />
					</apex:pageBlockTable>
				</apex:pageBlockSectionItem>
			</apex:pageBlockSection>

			<apex:pageBlockSection id="pbsCompleted" columns="1" rendered="{!Completed}" >
				<apex:pageMessage summary="{!$Label.AMS_LABEL_RejectSave}" severity="confirm" strength="2" />
					<apex:pageBlockSectionItem labelStyle="width:50%">
						<apex:outputLabel value="{!$Label.AMS_LABEL_RejectRejected}" for="conRej" />
						<apex:outputText id="conRej" value="{!CandidatesRejectedCount}" />
				</apex:pageBlockSectionItem>
				<apex:pageMessage summary="Email has not been sent to all candidates" severity="warning" strength="2" rendered="{!(EmailsSentCount < TotalContactsCount) && (eventCC.Subject != null || eventCC.Description != null)}" />
				<apex:pageBlockSectionItem labelStyle="width:50%" rendered="{!eventCC.Subject != null || eventCC.Description != null}">
					<apex:outputLabel value="{!$Label.ts2__SelectedContacts}" for="cntCount" />
					<apex:outputText id="cntCount" value="{!TotalContactsCount}" />
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:50%" rendered="{!eventCC.Subject != null || eventCC.Description != null}">
					<apex:outputLabel value="{!$Label.ts2__EmailsSent}" for="cntSent" />
					<apex:outputText id="cntSent" value="{!EmailsSentCount}" />
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:50%" rendered="{!eventCC.Subject != null || eventCC.Description != null}">
					<apex:outputLabel value="{!$Label.ts2__MissingEmailAddress}" for="cntMissing" />
					<apex:outputText id="cntMissing" value="{!EmailsMissingCount}" />
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem labelStyle="width:50%" rendered="{!eventCC.Subject != null || eventCC.Description != null}">
					<apex:outputLabel value="{!$Label.ts2__EmailOptOutSelected}" for="cntOptOut" />
					<apex:outputText id="cntOptOut" value="{!EmailsOptOut}" />
				</apex:pageBlockSectionItem>
			</apex:pageBlockSection>

			<apex:pageBlockSection id="pbsWarning" columns="1" rendered="{!if((NOT(Completed) && MassButtonError),true,false)}" >
				<apex:pageMessage summary="{!ErrorMsg}" severity="warning" strength="2" />
			</apex:pageBlockSection>
		</apex:pageBlock>

		<apex:actionFunction name="SelectTemplateAction" action="{!ChangeEmailTemplateOnSendEmail}" rerender="ecndSubject,ecndMessage,Attachments_block" status="TemplateLoading">
			<apex:param name="var1" value="" assignTo="{!SelectedEmailTemplate}" />
		</apex:actionFunction>

	<script type="text/javascript">
			jQuery.noConflict();

			var section = jQuery('[id$=RejectEmailSection]')[0];
			if (section.childNodes[0]) {
				var listImage = section.getElementsByTagName('img');
				twistSection(listImage[0]);
			}

			jQuery(document).ready(function() {
				gfxInit();
			});
			function gfxInit() {
				a1=new Image; a1.src="{!URLFOR($Resource.UIRes, 'res/img/spinner.gif')}";
				toggleRejectEmailIndicator();
			}

			var theField = jQuery('[id$=passingRejectEmailParam]')[0];
			function toggleRejectEmailIndicator() {
				var isRejectEmailShown = false;
				var section = jQuery('[id$=RejectEmailSection]')[0];
				if (section.childNodes[1].style.display == 'none') {
					isRejectEmailShown = false;
				} else {
					isRejectEmailShown = true
				}
				theField.value = isRejectEmailShown;
			}

			function openTemplateSelectorWindow() {
				var pageURL = '{!$Page.AMS2_s_EmailTemplate}';
				pageURL = (typeof(pageURL)=='string') ? pageURL : "/apex/AMS2_s_EmailTemplate";
				var url = pageURL;
				var features = 'directories=no,menubar=no,titlebar=no,toolbar=no,scrollbars=yes,resizable=yes,width=600,height=300';
				win = window.open(url, 'template', features);
			}

			function setTemplateId(templateId) {
				LoadingElementShow(jQuery("[id$=pbSendEmail]").find("div.pbBody").get(0), '{!$Label.ts2__Candidates_LABEL_Loading}');
				SelectTemplateAction(templateId);
			}

			jQuery('[id$=RejectEmailSection] img:first').bind('click', function(){
				if (jQuery('[id$=template_button_id]').css("display") == 'none') {
					jQuery('[id$=template_button_id]').css("display", "inline");
				}
				else {
					jQuery('[id$=template_button_id]').css("display", "none");
				}
			});

			function RerenderEditor() {
				var nameEditor = jQuery('[id$=Message_box]').attr('name');
				var editor = new FCKeditor(nameEditor, null, 300);
				editor.BasePath = '/apexpages/fckeditor/';
					editor.Config['CustomConfigurationsPath'] = '/apexpages/richtext.config.js';
					editor.ToolbarSet = 'SalesforceBasic';
					editor.Config['SkinPath'] = editor.BasePath + 'editor/skins/sfdc/';
					editor.Config['DefaultLanguage'] = 'en-us';
					editor.Config['EditorAreaStyles'] = ['/sCSS/23.0/sprites/1323209069000/Theme3/default/gc/HtmlDetailElem.css'];
					editor.Config['ImageUpload'] = true;
					editor.Config['SitesPath'] = '';
					editor.ReplaceTextarea();
			}

			function setValueFromEditor() {
				if (jQuery('[id$=Message_box___Frame]') == null || jQuery('[id$=Message_box___Frame]').attr('src') == null) {
					RejectCandidatesAction();
					return true;
				}
				var NameEditor = jQuery('[id$=Message_box___Frame]');
				EditorValue = NameEditor.contents().find("iframe").contents().find("body").html();
				EditorValue = jQuery.trim(EditorValue);
				RejectCandidatesActionHtml(EditorValue);
				return true;
			}

			function closeWin(refresh) {
				if (refresh) {
					if (parent.window.name != 'Reject') {
						if (refreshUrl != 'no') {
							parent.opener.top.location = refreshUrl;
						}
					}
				}
				parent.window.close();
			}
	</script>
</apex:form>
</body>


</apex:page>