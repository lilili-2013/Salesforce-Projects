<apex:page standardController="Contact" extensions="ts2.ShowResumeController" action="{!InitResumeAction}" showHeader="false" sidebar="false" >

<apex:outputPanel layout="none" rendered="{!DisplayTextVersion}" >
<apex:includeScript value="{!URLFOR($Resource.ts2__ResumeAddUpdateBackend, 'res/js/text_resume_popup.js')}" />
<style>
#resumeBody {
	font-size: 1.2em;
}
#resumeBody pre {
	white-space: pre-line; word-wrap: break-word;
}
</style>
<script type="text/javascript">
	function init() {
		highlightSearchTerms(document.getElementById('resumeBody'), '{!JSENCODE(HighlightKey)}', null, null);
	}
</script>
</apex:outputPanel>

<body onload="init()" width="100%" style="margin:10px;">

<apex:form id="frm">

	<apex:pageMessages id="pageMessages" />

	<apex:pageBlock title="Show Resume" mode="edit" rendered="{!NOT(HasFatalMessages)}" >

		<apex:pageBlockButtons id="pbbsMainButtons" style="text-align: right;" location="bottom">
			<apex:commandButton value="Close" title="Close" onclick="window.close();" />
		</apex:pageBlockButtons>

		<apex:pageBlockSection id="pbsMainPDF" columns="1" rendered="{!NOT(DisplayTextVersion)}" >

			<apex:outputpanel layout="none" rendered="{!ResumeTypePDF}">
				<script type='text/javascript'>
					function embedPDF() {
						var Height = document.documentElement.clientHeight;
						var Pdf = document.getElementById("PdfView");
						Pdf.height = (Height-4)+'px;'
					}
					window.onload = embedPDF;
				</script>
				<apex:outputPanel layout="none" rendered="{!ShowAttachedResume}">
					<object id="PdfView" data="/servlet/servlet.FileDownload?file={!URLENCODE(ResumeAttachmentId)}#view=FitV&scrollbars=1&toolbar=1&statusbar=1&messages=1&navpanes=1" type="application/pdf" width="100%" height="100%">
						<p><apex:outputText value="{!$Label.ResumeViewerPluginNotInstalled1}" />&nbsp;<apex:outputLink value="/servlet/servlet.FileDownload?file={!URLENCODE(ResumeAttachmentId)}"><apex:outputText value="{!$Label.ResumeViewerPluginNotInstalled2}" /></apex:outputLink></p>
					</object>
				</apex:outputPanel>
			</apex:outputpanel>

			<apex:outputpanel layout="none" rendered="{!ResumeTypePNG}">
				<script>
					function RenderImage(Id,countPages,documentURL){
						var ImgItems = document.getElementById(Id);
						ImgItems.innerHTML = '';
						var Width = document.documentElement.clientWidth;
						for (i=1; i<=countPages; i++) {
							var image = document.createElement('img');
							ImgItems.innerHTML += '<a name='+i+'></a>';
							image.setAttribute('src', 'https://{!serverName}/mobile/getimageforced.aspx?document=' + documentURL + '&pageNumber=' + i);
							image.setAttribute('width', (Width > 1600) ? '80%' : '100%');
							ImgItems.appendChild(image);
							ImgItems.innerHTML +='<br>';
						}
					}
				</script>
				<div id="Images" style="text-align: center;"></div>
				<script>RenderImage('Images',{!JSENCODE(PageCounter)},'{!URLENCODE(FlashDocumentUrl)}')</script>
			</apex:outputpanel>

		</apex:pageBlockSection>

		<apex:pageBlockSection id="pbsMainText" columns="1" rendered="{!DisplayTextVersion}">
			<apex:outputPanel layout="none" >
			<div id="ResumePopup" class="bd" style="color:black;" >
				<div style="overflow:auto; height:600px; padding-right:10px;">
					<div id="resumeBody">
						<pre><apex:outputText value="{!CurrentContact.ts2__Text_Resume__c}" rendered="{!$ObjectType.Contact.Fields.ts2__Text_Resume__c.Accessible}" /></pre>
					</div>
				</div>
			</div>
			</apex:outputPanel>
		</apex:pageBlockSection>
	</apex:pageBlock>

</apex:form>

</body>

</apex:page>